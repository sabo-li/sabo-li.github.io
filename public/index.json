
[{"content":"","date":"2025å¹´07æœˆ05æ—¥","externalUrl":null,"permalink":"/tags/hugo/","section":"Tags","summary":"","title":"HUGO","type":"tags"},{"content":"","date":"2025å¹´07æœˆ05æ—¥","externalUrl":null,"permalink":"/posts/","section":"Posts","summary":"","title":"Posts","type":"posts"},{"content":"","date":"2025å¹´07æœˆ05æ—¥","externalUrl":null,"permalink":"/","section":"Sabo LI","summary":"","title":"Sabo LI","type":"page"},{"content":"","date":"2025å¹´07æœˆ05æ—¥","externalUrl":null,"permalink":"/tags/","section":"Tags","summary":"","title":"Tags","type":"tags"},{"content":"","date":"2025å¹´07æœˆ05æ—¥","externalUrl":null,"permalink":"/tags/%E5%8D%9A%E5%AE%A2/","section":"Tags","summary":"","title":"åšå®¢","type":"tags"},{"content":" å¿«é€Ÿå…¥é—¨ # Hugo æ˜¯ä¸€ä¸ªç”¨ Go ç¼–å†™çš„é™æ€ç«™ç‚¹ç”Ÿæˆå™¨ï¼Œé’ˆå¯¹é€Ÿåº¦è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¹¶ä¸ºçµæ´»æ€§è€Œè®¾è®¡ã€‚ å‡­å€Ÿå…¶å…ˆè¿›çš„æ¨¡æ¿ç³»ç»Ÿå’Œå¿«é€Ÿçš„èµ„æºç®¡é“ï¼ŒHugo å¯ä»¥åœ¨å‡ ç§’é’Ÿå†…ï¼ˆé€šå¸¸æ›´çŸ­ï¼‰æ¸²æŸ“å®Œæˆä¸€ä¸ªå®Œæ•´çš„ç«™ç‚¹ã€‚\nå®‰è£…Hugo # ä»æºä»£ç æ„å»ºå®‰è£…æ‰©å±•/éƒ¨ç½²ç‰ˆ # å‰ç½®ä¾èµ–ï¼š\nGit Dart Sass Golang CGO_ENABLED=1 go install -tags extended,withdeploy github.com/gohugoio/hugo@latest å®‰è£…æˆåŠŸåæ‰§è¡Œhugo versionæœ‰ç‰ˆæœ¬è¾“å‡ºå°±æ˜¯å®‰è£…æˆåŠŸäº†ï¼ŒæˆåŠŸç¤ºä¾‹\n$ hugo version hugo v0.147.8 darwin/amd64 BuildDate=unknown å¦‚æœç¼–è¯‘æˆåŠŸï¼Œä½†æ˜¯hugoå‘½ä»¤æ‰¾ä¸åˆ°ï¼Œéœ€è¦å°†GOBINç¯å¢ƒå˜é‡æ·»åŠ ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­\nå®‰è£…ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶ç‰ˆ # å‚è€ƒå®˜æ–¹å®‰è£…æ•™ç¨‹ æ ¹æ®è‡ªå·±çš„ç³»ç»Ÿç±»å‹å®‰è£…äºŒè¿›åˆ¶ç‰ˆ\nåˆ›å»ºä¸€ä¸ªç«™ç‚¹ # åˆ›å»ºé¡¹ç›®ã€‚\nhugo new site mywebsite è¿›å…¥é¡¹ç›®ç›®å½•\ncd mywebsite æŠŠå½“å‰ç›®å½•åˆå§‹åŒ–ä¸ºä¸€ä¸ªç©ºçš„ Git å­˜å‚¨åº“ã€‚\ngit init æœ¬æ¬¡é€‰æ‹©ä½¿ç”¨çš„æ˜¯ Blowfish ä¸»é¢˜ï¼Œå…¶ä»–ä¸»é¢˜å¯ä»¥å‚è€ƒå¯¹åº”çš„æ–‡æ¡£å³å¯\nå°† Blowfish ä¸»é¢˜å…‹éš†åˆ° themes ç›®å½•ä¸­ï¼Œå¹¶å°†å…¶ä½œä¸º Git å­æ¨¡å—æ·»åŠ åˆ°é¡¹ç›®ä¸­ã€‚\ngit submodule add -b main https://github.com/nunocoracao/blowfish.git themes/blowfish å°†.gitignoreå¤åˆ¶åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼Œæœ¬æ¬¡åªæ˜¯ä½œä¸ºå‚è€ƒï¼Œåç»­å¯æŒ‰éœ€è‡ªè¡Œæ›´æ”¹ã€‚\ncp themes/blowfish/.gitignore . å¤åˆ¶ Blowfish ä¸»é¢˜çš„é…ç½®æ–‡ä»¶åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼Œå…¶ä»–ä¸»é¢˜å¯å‚è€ƒå„è‡ªçš„æ–‡æ¡£æ“ä½œ\ncp themes/blowfish/config ./ åœ¨ç«™ç‚¹é…ç½®æ–‡ä»¶ä¸­è¿½åŠ ä¸€è¡Œï¼ŒæŒ‡ç¤ºå½“å‰ä¸»é¢˜ã€‚\necho \u0026#34;theme = \u0026#39;blowfish\u0026#39;\u0026#34; \u0026gt;\u0026gt; hugo.toml å¯åŠ¨ Hugo çš„å¼€å‘æœåŠ¡å™¨ä»¥æŸ¥çœ‹ç«™ç‚¹ã€‚\nhugo server ","date":"2025å¹´07æœˆ05æ—¥","externalUrl":null,"permalink":"/posts/%E4%BD%BF%E7%94%A8hugo%E6%9E%84%E5%BB%BA%E5%8D%9A%E5%AE%A2%E7%BD%91%E7%AB%99/","section":"Posts","summary":"","title":"ä½¿ç”¨Hugoæ„å»ºåšå®¢ç½‘ç«™","type":"posts"},{"content":"","date":"2022å¹´04æœˆ10æ—¥","externalUrl":null,"permalink":"/tags/jekyll/","section":"Tags","summary":"","title":"Jekyll","type":"tags"},{"content":" è¦æ±‚ # è¿è¡Œ Jekyll éœ€è¦ä»¥ä¸‹æ¡ä»¶\n1.éœ€è¦ Ruby ç‰ˆæœ¬ \u0026gt; 2.5.0\n2.RubyGems\n3.GCC å’Œ Make\nå¯ä»¥å‚è€ƒ Jekyll-Installation-Guides æ ¹æ®è‡ªå·±ç¯å¢ƒé€‰æ‹©å®‰è£…\nå®‰è£… # 1.æ»¡è¶³ä»¥ä¸Šè¦æ±‚ 2.å®‰è£… jekyll å’Œ bundler gemsï¼Œå¦‚æœåœ¨å›½å†…å‡ºç°ç½‘ç»œé”™è¯¯æˆ–è€…ä¸‹è½½æ…¢ï¼Œå¯ä»¥ä½¿ç”¨ RubyGems é•œåƒ ã€‚\ngem install jekyll bundler æˆ‘åœ¨MacOSä¸Šå®é™…æ‰§è¡Œæ—¶ï¼Œå‡ºç°äº†é”™è¯¯ fatal error: 'openssl/ssl.h' file not found\nå¯ä½¿ç”¨ ä»¥ä¸‹å‘½ä»¤è§£å†³\nbrew install openssl brew link --force openssl gem install eventmachine -- --with-cppflags=-I/usr/local/opt/openssl/include # ç„¶åå†æ‰§è¡Œ gem install jekyll 3.åˆ›å»ºä¸€ä¸ªæ–°çš„ Jekyll ç«™ç‚¹åœ¨ ./myblog\njekyll new myblog 4.åˆ‡æ¢åˆ°æ–°ç›®å½•ã€‚\ncd myblog 5.æ„å»ºç«™ç‚¹å¹¶ä½¿å…¶åœ¨æœ¬åœ°æœåŠ¡å™¨ä¸Šå¯ç”¨ã€‚\nbundle exec jekyll serve å¦‚æœç”¨çš„ Ruby \u0026gt;= 3.0.0ï¼Œå¯èƒ½ä¼šå‡ºç°é”™è¯¯ require': cannot load such file -- webrick (LoadError)ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è§£å†³\nbundle add webrick 6.åœ¨æµè§ˆå™¨è®¿é—® http://localhost:4000\nå†™æ–‡ç«  # å‘è¡¨ä¸€ç¯‡æ–°æ–‡ç« ï¼Œä½ æ‰€éœ€è¦åšçš„å°±æ˜¯åœ¨ /_posts æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹æ ¼å¼æŸ¥çœ‹ Markdown åŸºæœ¬æ’°å†™å’Œæ ¼å¼è¯­æ³• ã€‚æ–‡ä»¶åçš„å‘½åéå¸¸é‡è¦ã€‚Jekyll è¦æ±‚ä¸€ç¯‡æ–‡ç« çš„æ–‡ä»¶åéµå¾ªä¸‹é¢çš„æ ¼å¼ï¼š\nå¹´-æœˆ-æ—¥-æ ‡é¢˜.MARKUP\nä¸‹é¢æ˜¯ä¸€äº›åˆæ³•çš„æ–‡ä»¶åçš„ä¾‹å­ï¼š\n2011-12-31-new-years-eve-is-awesome.md\n2012-09-12-how-to-write-a-blog.markdown\nä¹‹å‰ä¸€ç›´æƒ³ä» Hexo åˆ‡æ¢åˆ° Jekyllï¼Œä½†æ˜¯ä¸€çœ‹åˆ°è¿™ä¸ªæ ¼å¼å°±å¾ˆåˆ«æ‰­ï¼Œæ¯æ¬¡åˆ›å»ºæ–‡ä»¶éƒ½å¾—æ•²ä¸€ä¸ªæ—¥æœŸè¿›å»ï¼Œåæ¥åœ¨Awesome (Gem-Packaged) Jekyll Plugins å‘ç°ä¸€ä¸ªå¾ˆå¥½ç”¨çš„æ’ä»¶Jekyll::Compose ï¼Œæ‰©å±•äº† jekyll å‘½ä»¤ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åˆ›å»ºæ–°çš„æ–‡ä»¶\næ·»åŠ å’Œä½¿ç”¨ Jekyll::Compose # åœ¨ Gemfile ä¸­æ·»åŠ ï¼š\ngem \u0026#39;jekyll-compose\u0026#39;, group: [:jekyll_plugins] ç„¶åæ‰§è¡Œ bundleï¼Œç­‰å¾…æ‰§è¡ŒæˆåŠŸåå°±å¯ä»¥ä½¿ç”¨äº†\nä¾‹å¦‚åˆ›å»ºä¸€ä¸ª _posts æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ç« ï¼Œå¯ä»¥ä½¿ç”¨\njekyll post æ–‡ç« åå­— å…¶ä»–ç”¨æ³•è¯¦è§ jekyll help æˆ–è€…æŸ¥çœ‹ Jekyll::Compose ä½¿ç”¨è¯´æ˜ ä½¿ç”¨ä¸»é¢˜ # å†™å¥½æ–‡ç« åå¦‚æœè§‰çš„é¡µé¢ä¸å¥½çœ‹ï¼Œå¯ä»¥åˆ‡æ¢åˆ°è‡ªå·±å–œæ¬¢çš„ä¸»é¢˜ï¼Œæ¯”å¦‚æˆ‘é¦–æ¬¡ç”¨çš„å°±æ˜¯TeXt Theme ç¼–è¯‘å’Œå‘å¸ƒ # éƒ¨ç½²åˆ° Github # ä½¿ç”¨çš„æ˜¯ Github Pagesï¼Œæ–°å»ºä¸€ä¸ª USERNAME.github.io æºç ä»“åº“ï¼ŒGitHub ä¼šè‡ªåŠ¨çš„ç¼–è¯‘ï¼Œå‡ åˆ†é’Ÿåä½ å°±å¯ä»¥é€šè¿‡https://USERNAME.github.ioè®¿é—®åˆ°ä½ çš„ç½‘ç«™äº†ã€‚\nä½¿ç”¨é™æ€èµ„æºæ–‡ä»¶ # ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç¼–è¯‘ç”Ÿæˆé™æ€æ–‡ä»¶ï¼Œç¼–è¯‘å¥½çš„æ–‡ä»¶ä½äº _site æ–‡ä»¶å¤¹\nJEKYLL_ENV=production bundle exec jekyll build ","date":"2022å¹´04æœˆ10æ—¥","externalUrl":null,"permalink":"/posts/%E4%BD%BF%E7%94%A8jekyll/","section":"Posts","summary":"","title":"åŸºäº Ruby 3.0.0 ä»¥ä¸Šç‰ˆæœ¬ ä½¿ç”¨ Jekyll 4.2","type":"posts"},{"content":"","date":"2020å¹´07æœˆ19æ—¥","externalUrl":null,"permalink":"/tags/nfs/","section":"Tags","summary":"","title":"NFS","type":"tags"},{"content":"åº”ç”¨ç¨‹åºåœ¨è¯»å– Linux ç¯å¢ƒä½¿ç”¨NFSæŒ‚è½½çš„æ–‡ä»¶æ—¶ï¼Œå‘ç°å‡ Kbçš„æ–‡ä»¶è¯»å–æ—¶å¾ˆæ­£å¸¸ï¼Œä½†æ˜¯è¯»å–ä¸ŠMbçš„æ–‡ä»¶æ—¶ç‰¹åˆ«æ…¢ã€‚å¤šæ–¹æœç´¢å’Œè¯¢é—®ï¼Œæ˜¯å› ä¸ºå‡çº§å†…æ ¸åï¼Œéœ€è¦ä¿®æ”¹åŒæ—¶å‘èµ·çš„NFSè¯·æ±‚æ•°é‡å³å¯è§£å†³é—®é¢˜\nåŸæ–‡åœ°å€ # é˜¿é‡Œäº‘-å¦‚ä½•ä¿®æ”¹åŒæ—¶å‘èµ·çš„NFSè¯·æ±‚ å¦‚ä½•ä¿®æ”¹åŒæ—¶å‘èµ·çš„NFSè¯·æ±‚æ•°é‡ # NFSå®¢æˆ·ç«¯å¯¹äºåŒæ—¶å‘èµ·çš„NFSè¯·æ±‚æ•°é‡è¿›è¡Œäº†æ§åˆ¶ï¼Œé»˜è®¤ç¼–è¯‘çš„å†…æ ¸ä¸­æ­¤å‚æ•°å€¼ä¸º2ï¼Œä¸¥é‡å½±å“æ€§èƒ½ï¼Œå»ºè®®ä¿®æ”¹ä¸º128ã€‚æœ¬æ–‡ä»‹ç»å¦‚ä½•ä¿®æ”¹åŒæ—¶å‘èµ·çš„NFSè¯·æ±‚æ•°é‡ã€‚\næ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ä¿®æ”¹åŒæ—¶å‘èµ·çš„NFSè¯·æ±‚æ•°é‡ã€‚\nè¯´æ˜ ä½¿ç”¨æ–¹æ³•ä¸€ä¿®æ”¹å®Œæˆåï¼Œéœ€è¦é‡å¯æœåŠ¡å™¨ECSï¼Œé‡å¯æœåŠ¡å™¨å¯èƒ½å½±å“æ‚¨çš„ä¸šåŠ¡ä½¿ç”¨ã€‚å¦‚æœæ‚¨ä¸æƒ³é‡å¯æœåŠ¡å™¨ï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ³•äºŒä¿®æ”¹åŒæ—¶å‘èµ·çš„NFSè¯·æ±‚æ•°é‡ã€‚\næ–¹æ³•ä¸€ # å®‰è£…NFSå®¢æˆ·ç«¯ï¼Œè¯¦æƒ…è¯·å‚è§å®‰è£…NFSå®¢æˆ·ç«¯ ã€‚\næ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†åŒæ—¶å‘èµ·çš„NFSè¯·æ±‚æ•°é‡ä¿®æ”¹ä¸º128ã€‚\necho \u0026#34;options sunrpc tcp_slot_table_entries=128\u0026#34; \u0026gt;\u0026gt; /etc/modprobe.d/sunrpc.conf echo \u0026#34;options sunrpc tcp_max_slot_table_entries=128\u0026#34; \u0026gt;\u0026gt; /etc/modprobe.d/sunrpc.conf è¯´æ˜ æ‚¨åªéœ€åœ¨é¦–æ¬¡å®‰è£…NFSå®¢æˆ·ç«¯åæ‰§è¡Œä¸€æ¬¡æ­¤æ“ä½œï¼ˆå¿…é¡»é€šè¿‡rootç”¨æˆ·æ“ä½œï¼‰ï¼Œä¹‹åæ— éœ€é‡å¤æ‰§è¡Œã€‚\né‡å¯äº‘æœåŠ¡å™¨ECSã€‚\nreboot æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼Œè¯¦æƒ…è¯·å‚è§æŒ‚è½½NFSæ–‡ä»¶ç³»ç»Ÿ ã€‚\næ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ä¿®æ”¹ç»“æœã€‚\nå¦‚æœè¿”å›å€¼ä¸º128ï¼Œåˆ™è¯´æ˜ä¿®æ”¹æˆåŠŸã€‚\ncat /proc/sys/sunrpc/tcp_slot_table_entries æ–¹æ³•äºŒ # å®‰è£…NFSå®¢æˆ·ç«¯ï¼Œè¯¦æƒ…è¯·å‚è§å®‰è£…NFSå®¢æˆ·ç«¯ ã€‚\næ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†åŒæ—¶å‘èµ·çš„NFSè¯·æ±‚æ•°é‡ä¿®æ”¹ä¸º128ã€‚\necho \u0026#34;options sunrpc tcp_slot_table_entries=128\u0026#34; \u0026gt;\u0026gt; /etc/modprobe.d/sunrpc.conf echo \u0026#34;options sunrpc tcp_max_slot_table_entries=128\u0026#34; \u0026gt;\u0026gt; /etc/modprobe.d/sunrpc.conf è¯´æ˜ æ‚¨åªéœ€åœ¨é¦–æ¬¡å®‰è£…NFSå®¢æˆ·ç«¯åæ‰§è¡Œä¸€æ¬¡æ­¤æ“ä½œï¼ˆå¿…é¡»é€šè¿‡rootç”¨æˆ·æ“ä½œï¼‰ï¼Œä¹‹åæ— éœ€é‡å¤æ‰§è¡Œã€‚\næŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼Œè¯¦æƒ…è¯·å‚è§æŒ‚è½½NFSæ–‡ä»¶ç³»ç»Ÿ ã€‚\næ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå†æ¬¡å°†åŒæ—¶å‘èµ·çš„NFSè¯·æ±‚æ•°é‡ä¿®æ”¹ä¸º128ã€‚\nsysctl -w sunrpc.tcp_slot_table_entries=128 å¸è½½æ–‡ä»¶ç³»ç»Ÿï¼Œè¯¦æƒ…è¯·å‚è§åœ¨Linuxç³»ç»Ÿä¸­å¸è½½æ–‡ä»¶ç³»ç»Ÿ ã€‚\né‡æ–°æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼Œè¯¦æƒ…è¯·å‚è§æŒ‚è½½NFSæ–‡ä»¶ç³»ç»Ÿ ã€‚\næ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ä¿®æ”¹ç»“æœã€‚\nå¦‚æœè¿”å›å€¼ä¸º128ï¼Œåˆ™è¯´æ˜ä¿®æ”¹æˆåŠŸã€‚\ncat /proc/sys/sunrpc/tcp_slot_table_entries ","date":"2020å¹´07æœˆ19æ—¥","externalUrl":null,"permalink":"/posts/%E8%A7%A3%E5%86%B3nfs%E8%AF%BB%E5%86%99%E6%96%87%E4%BB%B6%E5%BC%82%E5%B8%B8/","section":"Posts","summary":"","title":"è§£å†³NFSè¯»å†™æ–‡ä»¶å¼‚å¸¸","type":"posts"},{"content":"","date":"2020å¹´07æœˆ12æ—¥","externalUrl":null,"permalink":"/tags/acme.sh/","section":"Tags","summary":"","title":"Acme.sh","type":"tags"},{"content":"","date":"2020å¹´07æœˆ12æ—¥","externalUrl":null,"permalink":"/tags/dns/","section":"Tags","summary":"","title":"DNS","type":"tags"},{"content":"","date":"2020å¹´07æœˆ12æ—¥","externalUrl":null,"permalink":"/tags/https/","section":"Tags","summary":"","title":"HTTPS","type":"tags"},{"content":"","date":"2020å¹´07æœˆ12æ—¥","externalUrl":null,"permalink":"/tags/nginx/","section":"Tags","summary":"","title":"Nginx","type":"tags"},{"content":"","date":"2020å¹´07æœˆ12æ—¥","externalUrl":null,"permalink":"/tags/%E9%85%8D%E7%BD%AE/","section":"Tags","summary":"","title":"é…ç½®","type":"tags"},{"content":" å‚è€ƒåœ°å€ # acme.sh DNS API è¯´æ˜ DNS API é…ç½® # æˆ‘ç”¨çš„ä½¿ç”¨é˜¿é‡Œäº‘ åŸŸåæœåŠ¡ï¼Œå…¶ä»–å¯ä»¥æŸ¥çœ‹ä½¿ç”¨è¯´æ˜ é¦–å…ˆï¼Œéœ€è¦ç™»å½•åˆ°Aliyunå¸æˆ·ä»¥è·å–APIå¯†é’¥ ã€‚\nç„¶åå°†ä»¥ä¸‹é…ç½®å†™å…¥åˆ°~/.bashrcæ–‡ä»¶ä¸­ï¼Œç„¶åæ‰§è¡Œsource ~/.bashrc\nexport Ali_Key=\u0026#34;è·å–åˆ°çš„é˜¿é‡Œäº‘DNS API Key\u0026#34; export Ali_Secret=\u0026#34;è·å–åˆ°çš„é˜¿é‡Œäº‘DNS API Secret\u0026#34; å®‰è£… acme.sh # å·²ç»å®‰è£…å¥½çš„è¯·è·³è¿‡\ncurl https://get.acme.sh | sh æ‰§è¡Œé¢å‘è¯ä¹¦å‘½ä»¤ # acme.sh --issue --force -d example.com -d *.example.com --dns dns_ali å°†è¯ä¹¦å®‰è£…åˆ°æŒ‡å®šä½ç½® # acme.sh --installcert -d example.com --key-file example.com.keyçš„è·¯å¾„ --fullchain-file fullchain.cerçš„è·¯å¾„ --reloadcmd \u0026#34;systemctl force-reload nginx\u0026#34; Nginx é…ç½® # ç„¶åå‚è€ƒä¿®æ”¹-Nginx-é…ç½® ç°åœ¨æƒ³è¦è·å¾— A+ è¯„çº§ï¼Œéœ€è¦è®¾ç½® nginx ä¸­çš„ssl_protocolsåªæä¾› TLSv1.2 æˆ–è€…æ›´é«˜çš„åè®®ï¼Œç¦ç”¨ä¸å®‰å…¨æˆ–ä¸åœ¨å—æ”¯æŒçš„åè®®ï¼Œæˆ‘å°†åŸå…ˆçš„ssl_protocolsæ›´æ”¹ä¸ºï¼š\nssl_protocols TLSv1.2 TLSv1.3; HTTPSè¯„çº§ https://myssl.com/ ","date":"2020å¹´07æœˆ12æ—¥","externalUrl":null,"permalink":"/posts/%E4%BD%BF%E7%94%A8acme.sh%E7%9A%84dns-api%E9%85%8D%E7%BD%AE%E7%94%9F%E6%88%90%E9%80%9A%E9%85%8D%E5%9F%9F%E5%90%8D%E8%AF%81%E4%B9%A6/","section":"Posts","summary":"","title":"ä½¿ç”¨acme.shçš„DNS APIé…ç½®ç”Ÿæˆé€šé…åŸŸåè¯ä¹¦","type":"posts"},{"content":"","date":"2020å¹´07æœˆ11æ—¥","externalUrl":null,"permalink":"/tags/gitlab/","section":"Tags","summary":"","title":"GitLab","type":"tags"},{"content":"è¯¥æ–‡æ¡£å¤åˆ¶è‡ªDocker+k8s+GitLab+Jenkins(ç”Ÿäº§ç¯å¢ƒå¯CI/CDæ¨¡æ‹Ÿ) è¿™ä¸ªç¯å¢ƒä»…åšå‚è€ƒ\né€šè¿‡Docker+k8sæ¥éƒ¨ç½²webé›†ç¾¤ï¼ŒGitLab+Jenkinså®ç°ä»£ç è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œåœ¨Jenkinsä¸­é€šè¿‡æ„å»ºè„šæœ¬ï¼Œå®ç°k8så¯¹å®¹å™¨webé›†ç¾¤ä»£ç è‡ªåŠ¨æ›´æ–°\nè¿è¡Œç¯å¢ƒ # ip æœåŠ¡ å¤‡æ³¨ 192.168.1.1 GitLab å†…å­˜4Gï¼ŒåŒæ ¸CPUï¼ˆCentOS7.8ï¼‰ 192.168.1.4 Jenkins å†…æ ¸2Gï¼ŒåŒæ ¸CPUï¼ˆCentOS7.8ï¼‰ 192.168.1.11 Docker+k8s-master å†…æ ¸2Gï¼ŒåŒæ ¸CPUï¼ˆCentOS7.8ï¼‰ 192.168.1.12 Docker+k8s-node1 å†…æ ¸2Gï¼ŒåŒæ ¸CPUï¼ˆCentOS7.8ï¼‰ 192.168.1.13 Docker+k8s-node2 å†…æ ¸2Gï¼ŒåŒæ ¸CPUï¼ˆCentOS7.8ï¼‰ éƒ¨ç½²ç›®çš„ # åœ¨å¼€å‘è¿›è¡Œä»£ç çš„æ›´æ–°åï¼Œä¸Šä¼ åˆ°GitLabï¼ŒJenkinsæ ¹æ®webhookå‘ç°ä»£ç çš„æ›´æ–°åï¼Œè¿›è¡Œä»£ç æ„å»ºå’Œk8sä¸­çš„è‡ªåŠ¨éƒ¨ç½²ï¼Œå±•ç°åˆ°webç•Œé¢ä¸­\næ­å»ºGitLab # å‚è€ƒæ–‡æ¡£Gitæ­å»º å’ŒGitLabæ­å»º é™¤äº†ç¨‹åºæ˜¯é€šè¿‡yumå®‰è£…çš„æ²¡æœ‰ä»€ä¹ˆä¸åŒ\n192.168.1.1 # [root@localhost ~]# hostnamectl set-hostname gitlab [root@localhost ~]# bash [root@gitlab ~]# vim /etc/hosts 192.168.1.1 gitlab 192.168.1.4 jenkins å¼€å¯è·¯ç”±è½¬å‘\n[root@gitlab ~]# echo \u0026#34;net.ipv4.ip_forward = 1\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf [root@gitlab ~]# sysctl -p net.ipv4.ip_forward = 1 å®‰è£…Git\n[root@gitlab ~]# yum -y install git é…ç½®GitLabçš„repoæº\nä½¿ç”¨æ¸…åå¤§å­¦çš„repoæº\n[root@gitlab ~]# cat \u0026lt;\u0026lt;EOF\u0026gt; /etc/yum.repos.d/gitlab-ce.repo [gitlab-ce] name=Gitlab CE Repository baseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/ gpgcheck=0 enabled=1 EOF å®‰è£…GitLab\nä½¿ç”¨yumå®‰è£…çš„æœ€æ–°ç‰ˆæœ¬å‘ç°å¯¹å¯†é’¥é—®é¢˜è¿˜æœ‰ç‚¹ä¸ç¨³å®š\n[root@gitlab ~]# yum -y install gitlab-ce å°† SELinux è®¾ç½®ä¸ºç¦ç”¨ï¼Œå¯è§£å†³è®¾ç½®gitlabå…¬é’¥åä¸ç”Ÿæ•ˆï¼Œè€Œä¸”è¿˜éœ€è¦è¾“å…¥è´¦å·å¯†ç ï¼ˆè¿™ä¸ªé—®é¢˜æˆ‘æ‰¾äº†åå¤šä¸ªå°æ—¶ğŸ˜“ï¼‰\n[root@gitlab ~]# setenforce 0 [root@gitlab ~]# sed -i \u0026#39;s/^SELINUX=enforcing$/SELINUX=disabled/\u0026#39; /etc/selinux/config ç”Ÿäº§ç¯å¢ƒä¸­éœ€è¦ä¿®æ”¹è®¿é—®GitLabçš„åŸŸåæˆ–è€…ip\n[root@localhost ~]# vim /etc/gitlab/gitlab.rb # å°†external_url \u0026#39;http://gitlab.example.com\u0026#39; # ä¿®æ”¹ä¸ºexternal_url \u0026#39;http://192.168.1.1\u0026#39;ï¼Œæœ¬æœºåŸŸåæˆ–è€…ip åˆå§‹åŒ–GitLab\n[root@gitlab ~]# gitlab-ctl reconfigure # ç¬¬ä¸€æ¬¡éœ€è¦å¾ˆé•¿æ—¶é—´ å¯åŠ¨GitLab\n[root@gitlab ~]# gitlab-ctl start æ”¾è¡Œç«¯å£\n[root@gitlab ~]# firewall-cmd --permanent --add-service=http success [root@gitlab ~]# firewall-cmd --reload success ç™»é™†åˆ°Webç®¡ç†ç•Œé¢è®¾ç½®çš„ç™»å½•å¯†ç \nhttp://192.168.1.1 é»˜è®¤ç”¨æˆ·ä¸ºroot\nç™»å½•æˆåŠŸ\næ­å»ºJenkins # å‚è€ƒæ–‡æ¡£Jenkinsæ­å»º é™¤äº†ç¨‹åºæ˜¯é€šè¿‡yumå®‰è£…çš„æ²¡æœ‰ä»€ä¹ˆä¸åŒ\n192.168.1.4 # [root@localhost ~]# hostnamectl set-hostname jenkins [root@localhost ~]# bash [root@jenkins ~]# vim /etc/hosts 192.168.1.1 gitlab 192.168.1.4 jenkins 192.168.1.11 k8s-master 192.168.1.12 k8s-node1 192.168.1.13 k8s-node2 å‡†å¤‡Javaç¯å¢ƒ\nä½¿ç”¨1.8çš„Javaç¯å¢ƒ\n[root@jenkins ~]# yum -y install java-1.8.0-openjdk* ç¼–å†™Jenkinsçš„repoæº\n[root@jenkins ~]# cat \u0026lt;\u0026lt;EOF\u0026gt; /etc/yum.repos.d/jenkins.repo [jenkins] name=Jenkins-stable baseurl=https://mirrors.tuna.tsinghua.edu.cn/jenkins/redhat-stable/ gpgcheck=1 EOF # å¯¼å…¥rpmå¯†é’¥ [root@jenkins ~]# rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key å®‰è£…Jenkins\n[root@jenkins ~]# yum -y install https://mirrors.tuna.tsinghua.edu.cn/jenkins/redhat-stable/jenkins-2.235.1-1.1.noarch.rpm [root@jenkins ~]# yum -y install git å®‰è£…åŠ é€Ÿç¥å¥‡ï¼ŒJenkinsé»˜è®¤ä½¿ç”¨googleæ¥æœç´¢æ’ä»¶çš„ä¸‹è½½ï¼Œè€Œä¸”æ’ä»¶ä¹Ÿåœ¨å›½å¤–ç½‘ç«™ï¼Œè¿™é‡Œå°†updatesç›®å½•ä¸­çš„default.jsonå†…çš„urlæ¢ä¸ºç™¾åº¦ï¼ˆæœç´¢å¼•æ“ï¼‰å’Œæ¸…åï¼ˆä¸‹è½½æ’ä»¶åœ°å€ï¼‰ï¼Œå‰æå¿…é¡»å‡ºç°è¿‡ä»¥ä¸Šç•Œé¢æ‰ä¼šæœ‰updatesç›®å½•\n[root@jenkins ~]# sed -i \u0026#39;s/http:\\/\\/www.google.com/https:\\/\\/www.baidu.com/g\u0026#39; /var/lib/jenkins/updates/default.json [root@jenkins ~]# sed -i \u0026#39;s/http:\\/\\/updates.jenkins-ci.org\\/download/https:\\/\\/mirrors.tuna.tsinghua.edu.cn\\/jenkins/g\u0026#39; /var/lib/jenkins/updates/default.json å¯åŠ¨Jenkinsï¼Œå¹¶æ”¾è¡Œ8080ç«¯å£\n[root@jenkins ~]# systemctl start jenkins [root@jenkins ~]# systemctl enable jenkins [root@jenkins ~]# firewall-cmd --permanent --add-port=8080/tcp success [root@jenkins ~]# firewall-cmd --reload success è¿›å…¥Jenkinsçš„webå®‰è£…ç•Œ\nè®¿é—®http://192.168.1.4:8080\nåœ¨Linuxæœ¬åœ°æŸ¥çœ‹ç®¡ç†å‘˜å¯†ç \nè¾“å…¥å¯†ç åï¼Œå¦‚æœå‡ºç°æ­¤ç•Œé¢\nå¦‚æœå‡ºç°ä»¥ä¸‹\nè§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š\nç¬¬ä¸€æ­¥ æ‰“å¼€æ’ä»¶ç®¡ç†çš„é«˜çº§è®¾ç½®é¡µé¢ http://192.168.1.4:8080/pluginManager/advanced ç¬¬äºŒæ­¥ ä¿®æ”¹æ›´æ–°ç«™ç‚¹åœ°å€ å°†httpsæ”¹ä¸ºhttp å¦‚æœä¸è¡Œ å¯ä»¥ç”¨æ¸…åçš„åŠ é€Ÿç«™ç‚¹ å¦‚ä¸‹ https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json å®‰è£…æ¨èæ’ä»¶\nç„¶åé‡å¯æœåŠ¡ï¼Œå¹¶é‡æ–°è®¿é—®Jenkinsçš„webç•Œé¢\n[root@jenkins ~]# systemctl restart jenkins å®‰è£…å®Œæˆåï¼Œåˆ›å»ºç®¡ç†ç”¨æˆ·\nåœ¨æ’ä»¶ç®¡ç†ä¸­å®‰è£…ä¸‰ä¸ªå…³äºGitLabçš„æ’ä»¶ï¼Œç”¨äºæŒç»­é›†æˆ\nGitlab Authentication\nGitlab\nGitlab Hook\né€‰æ‹©å®‰è£…åè‡ªåŠ¨é‡å¯Jenkins\næ­å»ºKubernetesé›†ç¾¤ # å‚è€ƒæœ¬ç«™æ–‡æ¡£Dockerå®‰è£… å’ŒKubernetesé›†ç¾¤æ­å»º ç¯å¢ƒå‡†å¤‡ # æŒ‰ç…§è¿è¡Œç¯å¢ƒä¸­çš„ç³»ç»Ÿç‰ˆæœ¬å’Œç¡¬ä»¶è¦æ±‚\nè¿™é‡Œä½¿ç”¨çš„ç°æˆçš„Dockerç¯å¢ƒï¼Œæ²¡æœ‰çš„å¯ä»¥å‚è€ƒä»¥ä¸Šé“¾æ¥éƒ¨ç½²\næ›´æ”¹ä¸»æœºå # 192.168.1.11\næ›´æ”¹ä¸»æœºåï¼Œå¹¶è®¾ç½®å¯¹å…¶ä»–ä¸¤å°èŠ‚ç‚¹çš„å…å¯†ç™»å½•\n[root@localhost ~]# hostnamectl set-hostname k8s-master [root@localhost ~]# bash [root@k8s-master ~]# vim /etc/hosts 192.168.1.11 k8s-master 192.168.1.12 k8s-node1 192.168.1.13 k8s-node2 [root@k8s-master ~]# ssh-keygen Generating public/private rsa key pair. Enter file in which to save the key (/root/.ssh/id_rsa): Created directory \u0026#39;/root/.ssh\u0026#39;. Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /root/.ssh/id_rsa. Your public key has been saved in /root/.ssh/id_rsa.pub. The key fingerprint is: SHA256:y0cMv9gJDShPYbfH/+WUbwtLJivwGTNv4EVT6TpxXHQ root@k8s-master The key\u0026#39;s randomart image is: +---[RSA 2048]----+ | o . o.E| | . + o o ..| | . o + o + . | | + B = + .| | . S * * .o| | o @ * . +.| | B \u0026amp;..+. +| | * o= o..| | o. . . | +----[SHA256]-----+ [root@k8s-master ~]# ssh-copy-id -i root@k8s-node1 [root@k8s-master ~]# ssh-copy-id -i root@k8s-node2 å°†hostsæ–‡ä»¶ä¼ è¾“åˆ°å…¶ä»–ä¸¤å°èŠ‚ç‚¹\n[root@k8s-master ~]# scp /etc/hosts root@k8s-node1:/etc [root@k8s-master ~]# scp /etc/hosts root@k8s-node2:/etc 192.168.1.12\n[root@localhost ~]# hostnamectl set-hostname k8s-node1 [root@localhost ~]# bash [root@k8s-node1 ~]# 192.168.1.13\n[root@localhost ~]# hostnamectl set-hostname k8s-node2 [root@localhost ~]# bash [root@k8s-node2 ~]# å…³é—­æ²™ç›’ # k8s-master/node1/node2\nå°† SELinux è®¾ç½®ä¸ºç¦ç”¨ï¼ˆä¹Ÿå¯ä»¥è®¾ç½®ä¸º permissive æ¨¡å¼ï¼‰\n[root@k8s-master ~]# setenforce 0 [root@k8s-master ~]# sed -i \u0026#39;s/^SELINUX=enforcing$/SELINUX=disabled/\u0026#39; /etc/selinux/config å¼€æ”¾æ‰€éœ€ç«¯å£ # é˜²ç«å¢™æ”¾è¡Œç«¯å£ï¼Œå› ä¸ºæ¯”è¾ƒå¤šï¼Œçœäº‹å¯ä»¥ç›´æ¥systemctl stop firewalld\nmasterèŠ‚ç‚¹\nåè®® æ–¹å‘ ç«¯å£èŒƒå›´ ä½œç”¨ ä½¿ç”¨è€… TCP å…¥ç«™ 6443* Kubernetes API æœåŠ¡å™¨ æ‰€æœ‰ç»„ä»¶ TCP å…¥ç«™ 2379-2380 etcd server client API kube-apiserver, etcd TCP å…¥ç«™ 10250 Kubelet API kubelet è‡ªèº«ã€æ§åˆ¶å¹³é¢ç»„ä»¶ TCP å…¥ç«™ 10251 kube-scheduler kube-scheduler è‡ªèº« TCP å…¥ç«™ 10252 kube-controller-manager kube-controller-manager è‡ªèº« [root@k8s-master ~]# firewall-cmd --permanent --add-port=6443/tcp [root@k8s-master ~]# firewall-cmd --permanent --add-port=64430-64439/tcp [root@k8s-master ~]# firewall-cmd --permanent --add-port=2379-2380/tcp [root@k8s-master ~]# firewall-cmd --permanent --add-port=10250-10252/tcp [root@k8s-master ~]# firewall-cmd --reload æ‰€æœ‰nodeå·¥ä½œèŠ‚ç‚¹\nåè®® æ–¹å‘ ç«¯å£èŒƒå›´ ä½œç”¨ ä½¿ç”¨è€… TCP å…¥ç«™ 10250 Kubelet API kubelet è‡ªèº«ã€æ§åˆ¶å¹³é¢ç»„ä»¶ TCP å…¥ç«™ 30000-32767 NodePort æœåŠ¡** æ‰€æœ‰ç»„ä»¶ [root@k8s-node1 ~]# firewall-cmd --permanent --add-port=10250/tcp [root@k8s-node1 ~]# firewall-cmd --permanent --add-port=30000-32767/tcp [root@k8s-node1 ~]# firewall-cmd --reload éªŒè¯èŠ‚ç‚¹UUID # æŸ¥çœ‹æ¯ä¸ªæœåŠ¡å™¨çš„uuidï¼Œå¿…é¡»ä¸èƒ½é‡å¤\nk8s-master\n[root@k8s-master ~]# cat /sys/class/dmi/id/product_uuid E2B74D56-23A9-4E8B-620C-555387355616 å…³é—­swapåˆ†åŒº # ä¸‰å°èŠ‚ç‚¹åŒæ ·çš„æ“ä½œ\n[root@k8s-master ~]# swapoff -a [root@k8s-master ~]# vim /etc/fstab # å°†åˆ†åŒºç±»å‹ä¸ºswapçš„ä¸€è¡Œæ³¨é‡Šæ‰ /dev/mapper/centos-swap swap # è¿˜æ˜¯éœ€è¦è°ƒæ•´å†…æ ¸å‚æ•° [root@k8s-master ~]# vim /etc/sysctl.conf # æœ«å°¾æ·»åŠ  vm.swappiness = 0 [root@k8s-master ~]# sysctl -p è®¾ç½®å†…æ ¸å‚æ•° # è°ƒæ•´iptablesæ¡¥æ¥æµé‡ï¼Œä¾èµ–äºdockerçš„å¯åŠ¨ï¼Œæ‰€ä»¥éœ€è¦ç¡®ä¿dockerå·²ç»å¯åŠ¨\nk8s-master\n[root@k8s-master ~]# vim /etc/sysctl.conf # æœ«å°¾æ·»åŠ  net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 [root@k8s-master ~]# sysctl -p # ä¸ºç¡®ä¿æ¡¥æ¥æµé‡ä¸æŠ¥é”™ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ [root@k8s-master ~]# modprobe ip_vs_rr [root@k8s-master ~]# modprobe br_netfilter # å°†ä¿®æ”¹å¥½çš„æ–‡ä»¶ä¼ è¾“åˆ°node1å’Œnode2 [root@k8s-master ~]# scp /etc/sysctl.conf root@k8s-node1:/etc [root@k8s-master ~]# scp /etc/sysctl.conf root@k8s-node2:/etc k8s-node1\n[root@k8s-node1 ~]# sysctl -p [root@k8s-node1 ~]# modprobe ip_vs_rr [root@k8s-node1 ~]# modprobe br_netfilter k8s-node2\n[root@k8s-node2 ~]# sysctl -p [root@k8s-node2 ~]# modprobe ip_vs_rr [root@k8s-node2 ~]# modprobe br_netfilter å®‰è£…Kubernetes # ç¼–å†™yumæº # k8s-master\n[root@k8s-master ~]# vim /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/ enabled=1 gpgcheck=1 repo_gpgcheck=1 gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg å°†yumæºä¼ ç»™æ¯å°èŠ‚ç‚¹\n[root@k8s-master ~]# scp /etc/yum.repos.d/kubernetes.repo root@k8s-node1:/etc/yum.repos.d/ [root@k8s-master ~]# scp /etc/yum.repos.d/kubernetes.repo root@k8s-node2:/etc/yum.repos.d/ å®‰è£…k8s # k8s-master/node1/node2\n[root@k8s-master ~]# yum -y install kubelet kubeadm kubectl å¦‚æœæœ‰çš„èŠ‚ç‚¹åœ¨yumå®‰è£…æ—¶ï¼ŒæŠ¥é”™404ï¼Œå°è¯•æ‰§è¡Œrm -rf /var/cache/yum/*åï¼Œé‡æ–°å®‰è£…\næŸ¥çœ‹k8sç‰ˆæœ¬\n[root@k8s-master ~]# kubeadm version kubeadm version: \u0026amp;version.Info{Major:\u0026#34;1\u0026#34;, Minor:\u0026#34;18\u0026#34;, GitVersion:\u0026#34;v1.18.2\u0026#34;, GitCommit:\u0026#34;52c56ce7a8272c798dbc29846288d7cd9fbae032\u0026#34;, GitTreeState:\u0026#34;clean\u0026#34;, BuildDate:\u0026#34;2020-04-16T11:54:15Z\u0026#34;, GoVersion:\u0026#34;go1.13.9\u0026#34;, Compiler:\u0026#34;gc\u0026#34;, Platform:\u0026#34;linux/amd64\u0026#34;} k8s-master\nå®‰è£…kubernetesçš„tabå¿«æ·é”®ï¼Œåªéœ€è¦åœ¨masterå®‰è£…å³å¯\n[root@k8s-master ~]# yum -y install bash-completion [root@k8s-master ~]# echo \u0026#34;source \u0026lt;(kubectl completion bash)\u0026#34; \u0026gt;\u0026gt; ~/.bashrc \u0026amp;\u0026amp; bash å¯åŠ¨k8s # k8s-master/node1/node2\n[root@k8s-master ~]# systemctl enable --now kubelet Kubernetesé›†ç¾¤æ­å»º # k8s-master\nåˆå§‹åŒ–é›†ç¾¤ï¼Œå®Œæˆåè·å–tokenå€¼\n[root@k8s-master ~]# kubeadm init --apiserver-advertise-address 192.168.1.11 \\ --image-repository registry.aliyuncs.com/google_containers \\ --kubernetes-version v1.18.2 --pod-network-cidr=10.244.0.0/16 ä½¿ç”¨ç®¡ç†ç”¨æˆ·ï¼ˆérootï¼‰æ‰§è¡Œä»¥ä¸‹æ“ä½œ\n[root@k8s-master ~]# mkdir -p $HOME/.kube [admin@k8s-master ~]$ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config [admin@k8s-master ~]$ sudo chown $(id -u):$(id -g) $HOME/.kube/config ä½¿ç”¨rootç”¨æˆ·æ‰§è¡Œä»¥ä¸‹æ“ä½œ\n[root@k8s-master ~]# echo \u0026#34;export KUBECONFIG=/etc/kubernetes/admin.conf\u0026#34; \u0026gt;\u0026gt; ~/.bashrc \u0026amp;\u0026amp; source ~/.bashrc éƒ¨ç½²é›†ç¾¤ç½‘ç»œ # ä¸‹è½½flannelç½‘ç»œé…ç½®æ–‡ä»¶ï¼Œæœ‰æ—¶å€™ä¼šä¸‹è½½å¤±è´¥ï¼Œå‰å¾€coreos/flannel é¡¹ç›® æ‰‹åŠ¨å°†å†…å®¹å¤åˆ¶åˆ°kube-flannel.ymlæ–‡ä»¶ä¸­\n[root@k8s-master ~]# curl -LO https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml # å°†quay.ioæ”¹ä¸ºå›½å†…quay-mirror.qiniu.com [root@k8s-master ~]# sed -i s/quay.io/quay-mirror.qiniu.com/g kube-flannel.yml ç„¶åæ‰§è¡Œä»¥ä¸‹æ“ä½œ\n[root@k8s-master ~]# kubectl apply -f kube-flannel.yml èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ # å¦‚æœä¹‹å‰ç”Ÿæˆçš„tokenå€¼å¿˜äº†ï¼ŒæŸ¥çœ‹kubeadm token listï¼Œè¿˜èƒ½å¾€ä¸Šç¿»çœ‹åˆ°tokenå€¼å°±è·³è¿‡è¿™æ­¥\nk8s-master\n[root@k8s-master ~]# kubeadm token list TOKEN TTL EXPIRES USAGES jppmrh.1hovp0cyt4xu2w1l 23h 2020-05-11T02:05:53+08:00 authentication,signing # å°†å®ƒåˆ é™¤é‡æ–°ç”Ÿæˆ [root@k8s-master ~]# kubeadm token delete jppmrh.1hovp0cyt4xu2w1l å¦‚æœæ‰¾ä¸åˆ°äº†ï¼Œé‡æ–°ç”Ÿæˆ\n[root@k8s-master ~]# kubeadm token create --print-join-command k8s-node1/node2\n[root@k8s-node1 ~]# kubeadm join 192.168.1.11:6443 --token bdsiop.8ptt7ky6t088xyl8 \\ --discovery-token-ca-cert-hash sha256:1b61fd611bd12f46c7c065995f304ad232f2a598cb99127ccc547612ea57eac0 è¾“å‡ºä¿¡æ¯ä¸ºä»¥ä¸‹åˆ™æˆåŠŸ\nRun \u0026#39;kubectl get nodes\u0026#39; on the control-plane to see this node join the cluster. éªŒè¯é›†ç¾¤èŠ‚ç‚¹ # k8s-master\nç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç›´è‡³çŠ¶æ€å…¨éƒ¨ä¸ºReady\n[root@k8s-master ~]# kubectl get nodes NAME STATUS ROLES AGE VERSION k8s-master Ready master 10m v1.18.2 k8s-node1 Ready \u0026lt;none\u0026gt; 3m56s v1.18.2 k8s-node2 Ready \u0026lt;none\u0026gt; 3m56s v1.18.2 é›†ç¾¤æ­å»ºæˆåŠŸ\nè¿è¡ŒDockerç§åº“â€”Registry # ä¸ºäº†åœ¨ç¯å¢ƒä¸­æ›´å¥½çš„ç®¡ç†Dockeré•œåƒï¼Œå†³å®šä½¿ç”¨Registryæ¥è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œç”¨æ¥å­˜æ”¾dockeré•œåƒï¼Œä¹Ÿå‡å°‘äº†é•œåƒå­˜å‚¨åœ¨å›½å¤–æºæˆ–è€…å›½å†…æºçš„ä¼ è¾“æ•ˆç‡ï¼Œå½“ç„¶ä¹Ÿèƒ½ä½¿ç”¨harborç§åº“ä»£æ›¿Registry\nk8s-master\nåˆ›å»ºé•œåƒå­˜æ”¾ç›®å½•\n[root@k8s-master ~]# mkdir -p /data/docker/registry ä¸‹è½½é•œåƒ\n[root@k8s-master ~]# docker pull registry:2 è¿è¡Œç§åº“å®¹å™¨\n[root@k8s-master ~]# docker run -itd -p 5000:5000 --restart always \\ --volume /data/docker/registry/:/var/lib/registry registry:2 æŸ¥çœ‹ç«¯å£æ˜¯å¦æ˜ å°„æˆåŠŸ\n[root@k8s-master ~]# netstat -anput | grep 5000 æ£€æŸ¥èƒ½å¦è®¿é—®åˆ°ç§åº“\n[root@k8s-master ~]# firewall-cmd --permanent --add-port=5000/tcp [root@k8s-master ~]# firewall-cmd --reload [root@k8s-master ~]# curl 192.168.1.11:5000/v2/_catalog {\u0026#34;repositories\u0026#34;:[]} è®¾ç½®ä¸‰å°dockeréƒ½èƒ½è¯†åˆ«ç§åº“åœ°å€\n[root@k8s-master ~]# vim /usr/lib/systemd/system/docker.service # ä»¥ExecStartå¼€å¤´çš„ä¸€è¡Œçš„æœ«å°¾æ·»åŠ --insecure-registry 192.168.1.11:5000 [root@k8s-master ~]# scp /usr/lib/systemd/system/docker.service root@k8s-node1:/usr/lib/systemd/system/ [root@k8s-master ~]# scp /usr/lib/systemd/system/docker.service root@k8s-node2:/usr/lib/systemd/system/ å…¨éƒ¨é‡å¯docker\n[root@k8s-master ~]# systemctl daemon-reload \u0026amp;\u0026amp; systemctl restart docker åˆ¶ä½œä¸€ä¸ªé•œåƒä¸Šä¼ åˆ°ç§åº“æµ‹è¯•\n[root@k8s-master ~]# wget http://nginx.org/download/nginx-1.11.1.tar.gz [root@k8s-master ~]# vim Dockerfile FROM centos MAINTAINER FeiYi RUN yum -y install net-tools iproute pcre-devel openssl-devel gcc gcc-c++ make zlib-devel elinks ADD nginx-1.11.1.tar.gz /usr/src ENV NGINX_DIR /usr/src/nginx-1.11.1 WORKDIR $NGINX_DIR RUN ./configure --prefix=/usr/local/nginx --user=nginx --group=nginx \u0026amp;\u0026amp; make \u0026amp;\u0026amp; make install WORKDIR / RUN useradd nginx RUN ln -s /usr/local/nginx/sbin/nginx /usr/sbin/nginx EXPOSE 80 CMD [\u0026#34;nginx\u0026#34;, \u0026#34;-g\u0026#34;, \u0026#34;daemon off;\u0026#34;] æ„å»ºé•œåƒ\n[root@k8s-master ~]# docker build -t 192.168.1.11:5000/bin-nginx:latest /root ä¸Šä¼ é•œåƒ\n[root@k8s-master ~]# docker push 192.168.1.11:5000/bin-nginx [root@k8s-master ~]# curl 192.168.1.11:5000/v2/_catalog {\u0026#34;repositories\u0026#34;:[\u0026#34;bin-nginx\u0026#34;]} ç§åº“æˆåŠŸ\nä½¿ç”¨k8så¯åŠ¨nginxå®¹å™¨ # k8s-master\nç¼–å†™Deploymentçš„æ¨¡æ¿æ–‡ä»¶ # [root@node1 ~]# vim nginx-deployment.yml apiVersion: apps/v1 kind: Deployment metadata: name: nginx spec: selector: matchLabels: app: nginx replicas: 2 template: metadata: labels: app: nginx spec: containers: - name: nginx image: 192.168.1.11:5000/bin-nginx ports: - containerPort: 80 è¿è¡Œæ¨¡æ¿æ–‡ä»¶\n[root@node1 ~]# kubectl apply -f nginx-deployment.yml deployment.apps/nginx created æŸ¥çœ‹æ˜¯å¦è¿è¡ŒæˆåŠŸ\n[root@node1 ~]# kubectl get pod -o wide NAME READY STATUS RESTARTS AGE IP NODE nginx-66fb94d868-h2fkk 1/1 Running 0 2m5s 10.244.2.2 node2 nginx-66fb94d868-zhkf8 1/1 Running 0 2m5s 10.244.1.2 node3 å¯ä»¥çœ‹åˆ°å®¹å™¨çš„ipï¼Œç°åœ¨åªèƒ½åœ¨è¿è¡Œå®¹å™¨çš„èŠ‚ç‚¹æ‰èƒ½å¤Ÿè®¿é—®åˆ°é¡µé¢å†…å®¹ï¼Œå¦‚æœæƒ³è®©å¤–éƒ¨ä¸»æœºè®¿é—®åˆ°ï¼Œéœ€è¦åšä¸€ä¸ªserviceæ¨¡æ¿ï¼Œç”¨æ¥æ˜ å°„ç«¯å£\nç¼–å†™Serviceæ¨¡æ¿ # å°†é›†ç¾¤ä¸­æ ‡ç­¾ä¸ºapp: nginxçš„å®¹å™¨çš„80ç«¯å£æ˜ å°„ä¸ºæœåŠ¡å™¨çš„30001\n[root@node1 ~]# vim nginx-service.yml apiVersion: v1 kind: Service metadata: name: nginx labels: app: nginx spec: type: NodePort ports: - port: 80 targetPort: 80 nodePort: 30001 selector: app: nginx è¿è¡ŒServiceæ¨¡æ¿\n[root@node1 ~]# kubectl apply -f nginx-service.yml service/nginx created è®¿é—®å®¿ä¸»æœºçš„30001ç«¯å£\nhttp://192.168.1.12:30001`å’Œ`http://192.168.1.13:30001 å®¹å™¨éƒ¨ç½²æˆåŠŸ\næ•´åˆGitLabå’ŒJenkins # Jenkins\nåœ¨Jenkinsç”Ÿæˆå¯†é’¥å¯¹\n[root@jenkins ~]# ssh-keygen Generating public/private rsa key pair. Enter file in which to save the key (/root/.ssh/id_rsa): Created directory \u0026#39;/root/.ssh\u0026#39;. Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /root/.ssh/id_rsa. Your public key has been saved in /root/.ssh/id_rsa.pub. The key fingerprint is: SHA256:IITvkptc3nJrgxCxA0R0+ExWm5y/PfSIdKaQpD0NhUc root@jenkins The key\u0026#39;s randomart image is: +---[RSA 2048]----+ |++.oo.oE | |..++..=. | | .=+.Bo | | +o=.=. | | * = +S+ | | + o + O o | | . B o + + . | | + + = . | | +.o | +----[SHA256]-----+ GitLab\nç™»å½•GitLab\nhttp://192.168.1.1 åˆ›å»ºé¡¹ç›®ä»“åº“\nåœ¨GitLabä¸­æ·»åŠ Jenkinsçš„å…¬é’¥å€¼\nå¤åˆ¶JenkinsæœåŠ¡å™¨çš„å…¬é’¥åˆ°ä¸‹å›¾ä½ç½®ï¼ŒæŸ¥çœ‹å…¬é’¥cat .ssh/id_rsa.pub\nåœ¨GitLabçš„é¡¹ç›®ä»“åº“ï¼Œåˆ›å»ºä¸€ä¸ªæµ‹è¯•ä»£ç æ–‡ä»¶\nå› ä¸ºå¯†é’¥ä¸Šä¼ çš„æ˜¯Jenkinsçš„ï¼Œæ‰€ä»¥åœ¨Jenkinsä¸Šä¸‹è½½æŸ¥çœ‹\n[root@jenkins ~]# git clone http://192.168.1.1/root/nginx-test.git [root@jenkins ~]# cd nginx-test/ [root@jenkins nginx-test]# cat index.html ChaiYanjiang æˆåŠŸ\nJenkins\nhttp://192.168.1.4:8080/ åˆ›å»ºä»»åŠ¡nginx-test\nè®¾ç½®æºç ç®¡ç†æ—¶åœ¨Gitlabçš„åœ°å€ï¼Œå‡ºç°çº¢è‰²è¯´æ˜è¿æ¥ä¸åˆ°ï¼Œå› ä¸ºGitLabå·²ç»æœ‰äº†Jenkinsçš„å…¬é’¥ï¼Œè¿™é‡Œåªéœ€è¦å¡«å†™Jenkinsçš„ç§é’¥å³å¯\nçº¢è‰²æŠ¥é”™æ¶ˆå¤±äº†\nè®¾ç½®æ„å»ºè§¦å‘å™¨\nå½“gitlabå‘ç”Ÿä»£ç å˜åŒ–æ—¶ï¼Œå¼€å§‹è¿›è¡Œæ„å»ºä»»åŠ¡\nç”Ÿæˆä¸€ä¸²tokenå€¼ï¼Œç”¨æ¥å¯¹GitLabä¸­çš„é¡¹ç›®ä»£ç è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥è¿™ä¸ªå€¼è¦æ”¾åˆ°GitLabä¸­ï¼Œç”¨äºéªŒè¯å…è®¸Jenkinsæ¥æ‹¿å–ä»£ç ï¼Œç¨åä¼šå°†\nè®¾ç½®æ„å»ºçš„å‘½ä»¤ï¼ˆCI/CDï¼‰\n#!/bin/bash backupcode=/data/backupcode/$JOB_NAME/ mkdir -p $backupcode chmod 644 $JENKINS_HOME/workspace/$JOB_NAME/* rsync -acP $JENKINS_HOME/workspace/$JOB_NAME/* $backupcode echo From 192.168.1.11:5000/bin-nginx \u0026gt; $JENKINS_HOME/workspace/Dockerfile echo COPY ./nginx-test/* /usr/local/nginx/html/ \u0026gt;\u0026gt; $JENKINS_HOME/workspace/Dockerfile docker rmi 192.168.1.11:5000/bin-nginx:latest docker build -t 192.168.1.11:5000/bin-nginx:latest $JENKINS_HOME/workspace/ docker push 192.168.1.11:5000/bin-nginx:latest ssh root@k8s-master kubectl delete deployment nginx ssh root@k8s-master kubectl apply -f nginx-deployment.yml ä¿å­˜å³å¯\nGitLab\n192.168.1.1ä¸­è®¾ç½®Jenkinsä¸­çš„tokenå€¼ï¼Œç”¨æ¥è§¦å‘Jenkinsæ„å»º\nGitLabé»˜è®¤æƒ…å†µä¸‹ä¸å…è®¸é€šè¿‡æœ¬åœ°ç½‘ç»œè§¦å‘æ„å»ºï¼Œä»¥ä¸‹è¿™æ­¥æ˜¯ä¸ºäº†è®¾ç½®å…è®¸æœ¬åœ°ç½‘ç»œæ„å»ºï¼Œå¦‚æœä¸è®¾ç½®å…è®¸ä¼šåœ¨æ·»åŠ tokenæ—¶æŠ¥é”™\nä¿å­˜\nè®¾ç½®å…è®¸ä¹‹åï¼Œå°±å¯ä»¥è®¾ç½®GitLabé¡¹ç›®ä¸Jenkinsçš„æ„å»ºè§¦å‘å™¨è¿æ¥äº†\nè¿›å…¥é¡¹ç›®ä¸­é€‰æ‹©è®¾ç½®\nå›¾ä¸­çš„URLæ˜¯åœ¨Jenkinsä¸­çš„é¡¹ç›®è·¯å¾„ï¼Œè¿™ä¸ªè·¯å¾„åœ¨æ„å»ºè§¦å‘å™¨çš„é‚£é‡Œå¯ä»¥çœ‹åˆ°ï¼Œå¤åˆ¶å³å¯ï¼Œtokenåˆ™æ˜¯åˆšæ‰åœ¨Jenkinsçš„ç®¡ç†ç•Œé¢ä¸­ç”Ÿæˆçš„tokenå€¼ï¼Œä¹Ÿæ˜¯åŒæ ·çš„ä½ç½®ï¼Œç„¶åç‚¹å‡»ä¸‹æ–¹add webhook\naddæˆåŠŸåï¼Œå¾€ä¸‹ç¿»åˆ°å¦‚å›¾æ‰€ç¤ºä½ç½®å¯ä»¥çœ‹æ·»åŠ æˆåŠŸçš„URLï¼Œç„¶åè¿›è¡Œè¿æ¥æµ‹è¯•ï¼Œå‡ºç°200å³æˆåŠŸ\næ•´åˆJenkinså’ŒDocker # Jenkins\nåœ¨Jenkinsä¸­åšå¯¹k8s-masterçš„å…å¯†ç™»å½•ï¼Œå¾—å…ˆä¿®æ”¹Jenkinsçš„è¿è¡Œç”¨æˆ·ï¼Œè¿™é‡Œæˆ‘ç›´æ¥ç”¨rootä»£æ›¿ï¼Œç”Ÿäº§ç¯å¢ƒè¯·å‚è€ƒè¿™é‡Œçš„scpæŠ¥é”™éƒ¨åˆ† [root@jenkins ~]# vim /etc/sysconfig/jenkins ä¿®æ”¹jenkinsç”¨æˆ· JENKINS_USER=\u0026#34;jenkins\u0026#34; # ä¿®æ”¹ä¸ºroot é‡å¯Jenkinså¹¶ä¼ è¾“å¯†é’¥\n[root@jenkins ~]# systemctl restart jenkins [root@jenkins ~]# ssh-copy-id -i root@k8s-master å®‰è£…Dockerï¼Œå‚è€ƒæ–‡æ¡£Dockerå®‰è£… ï¼Œå¹¶è®¾ç½®é•œåƒåŠ é€Ÿï¼Œå’ŒæŒ‡å®šç§åº“åœ°å€\næµ‹è¯• # ä¿®æ”¹GitLabçš„æµ‹è¯•æ–‡ä»¶æµ‹è¯•Jenkinsçš„è‡ªåŠ¨åŒ–éƒ¨ç½²æ˜¯å¦æˆåŠŸ\nä¿å­˜åä¼šå¼€å§‹è‡ªåŠ¨æ„å»ºéƒ¨ç½²ï¼Œè®¿é—®192.168.1.13:30001ï¼Œå¦‚æœæ˜¯ä»¥ä¸‹åˆ™æˆåŠŸï¼Œå¦‚æœæ„å»ºå¤±è´¥ï¼Œåˆ™æ£€æŸ¥æ„å»ºè„šæœ¬ï¼Œæ…¢æ…¢æ’é”™\n","date":"2020å¹´07æœˆ11æ—¥","externalUrl":null,"permalink":"/posts/gitlab-jenkins-k8s-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E5%8F%AFci-cd%E6%A8%A1%E6%8B%9F/","section":"Posts","summary":"","title":"GitLab+Jenkins+K8S(ç”Ÿäº§ç¯å¢ƒå¯CI/CDæ¨¡æ‹Ÿ)","type":"posts"},{"content":"","date":"2020å¹´07æœˆ11æ—¥","externalUrl":null,"permalink":"/tags/jenkins/","section":"Tags","summary":"","title":"Jenkins","type":"tags"},{"content":"","date":"2020å¹´07æœˆ11æ—¥","externalUrl":null,"permalink":"/tags/k8s/","section":"Tags","summary":"","title":"K8S","type":"tags"},{"content":" å‚è€ƒåœ°å€ # ä½¿ç”¨ acme.sh ç»™ Nginx å®‰è£… Letâ€™s Encrypt æä¾›çš„å…è´¹ SSL è¯ä¹¦ acme.sh è¯´æ˜ åˆ†äº«ä¸€ä¸ª HTTPS A+ çš„ nginx é…ç½® HTTPS # è¶…æ–‡æœ¬ä¼ è¾“å®‰å…¨åè®®ï¼ˆè‹±è¯­ï¼šHypertext Transfer Protocol Secureï¼Œç¼©å†™ï¼šHTTPSï¼Œå¸¸ç§°ä¸ºHTTP over TLSï¼ŒHTTP over SSLæˆ–HTTP Secureï¼‰æ˜¯ä¸€ç§é€è¿‡è®¡ç®—å™¨ç½‘ä¸Šè¿›è¡Œå®‰å…¨é€šä¿¡çš„ä¼ è¾“åè®®ã€‚HTTPSç»ç”±HTTPè¿›è¡Œé€šä¿¡ï¼Œä½†åˆ©ç”¨SSL/TLSæ¥åŠ å¯†æ•°æ®åŒ…ã€‚HTTPSå¼€å‘çš„ä¸»è¦ç›®çš„ï¼Œæ˜¯æä¾›å¯¹ç½‘ç«™æœåŠ¡å™¨çš„èº«ä»½è®¤è¯ï¼Œä¿æŠ¤äº¤æ¢æ•°æ®çš„éšç§ä¸å®Œæ•´æ€§ã€‚è¿™ä¸ªåè®®ç”±ç½‘æ™¯å…¬å¸ï¼ˆNetscapeï¼‰åœ¨1994å¹´é¦–æ¬¡æå‡ºï¼Œéšåæ‰©å±•åˆ°äº’è”ç½‘ä¸Šã€‚\nå®‰è£… acme.sh # curl https://get.acme.sh | sh # é‡æ–°è½½å…¥ source ~/.bashrc å®‰è£…è¿‡ç¨‹ä¸ä¼šæ±¡æŸ“å·²æœ‰çš„ç³»ç»Ÿä»»ä½•åŠŸèƒ½å’Œæ–‡ä»¶, æ‰€æœ‰çš„ä¿®æ”¹éƒ½é™åˆ¶åœ¨å®‰è£…ç›®å½•ä¸­: ~/.acme.sh/\nç”Ÿæˆè¯ä¹¦ # acme.shå®ç°äº†acmeåè®®æ”¯æŒçš„æ‰€æœ‰éªŒè¯åè®®ã€‚ ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼éªŒè¯ï¼šhttpå’ŒdnséªŒè¯ã€‚æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯ httpæ–¹å¼ï¼Œhttpæ–¹å¼éœ€è¦åœ¨ä½ çš„ç½‘ç«™æ ¹ç›®å½•ä¸‹æ”¾ç½®ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªç›®å½•éœ€è¦è¯»å†™æƒé™ï¼Œæ¥éªŒè¯ä½ çš„åŸŸåæ‰€æœ‰æƒï¼Œå®ŒæˆéªŒè¯ã€‚å…¶ä»–æ–¹å¼å¯ä»¥å‚è€ƒacme.sh ç”Ÿæˆè¯ä¹¦ ã€‚\nacme.sh --issue -d mydomain.com -w /home/user/www/mydomain.com/ copy / å®‰è£…è¯ä¹¦ # æ³¨æ„ï¼Œé»˜è®¤ç”Ÿæˆçš„è¯ä¹¦éƒ½æ”¾åœ¨å®‰è£…ç›®å½•ä¸‹ï¼š~/.acme.sh/ï¼Œè¯·ä¸è¦ç›´æ¥ä½¿ç”¨æ­¤ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š ä¸è¦ç›´æ¥è®© nginx/apacheçš„é…ç½®æ–‡ä»¶ä½¿ç”¨è¿™ä¸‹é¢çš„æ–‡ä»¶. è¿™é‡Œé¢çš„æ–‡ä»¶éƒ½æ˜¯å†…éƒ¨ä½¿ç”¨ï¼Œè€Œä¸”ç›®å½•ç»“æ„å¯èƒ½ä¼šå˜åŒ–ã€‚\næ­£ç¡®çš„ä½¿ç”¨æ–¹æ³•æ˜¯ä½¿ç”¨--installcertå‘½ä»¤ï¼Œå¹¶æŒ‡å®šç›®æ ‡ä½ç½®ï¼Œç„¶åè¯ä¹¦æ–‡ä»¶ä¼šè¢«copyåˆ°ç›¸åº”çš„ä½ç½®ã€‚\n# key-file æœåŠ¡å™¨ç«¯çš„ acme.sh --installcert -d mydomain.com \\ --key-file /home/user/.nginx/ssl/mydomain.com.key \\ --fullchain-file /home/user/.nginx/ssl/fullchain.cer \\ --reloadcmd \u0026#34;sudo service nginx force-reload\u0026#34; è¿™é‡Œç”¨çš„æ˜¯service nginx force-reloadï¼Œä¸æ˜¯service nginx reloadï¼Œæ®æµ‹è¯•ï¼Œreloadå¹¶ä¸ä¼šé‡æ–°åŠ è½½è¯ä¹¦ï¼Œæ‰€ä»¥ç”¨çš„force-reload\n--installcertå‘½ä»¤å¯ä»¥æºå¸¦å¾ˆå¤šå‚æ•°ï¼Œæ¥æŒ‡å®šç›®æ ‡æ–‡ä»¶ã€‚å¹¶ä¸”å¯ä»¥æŒ‡å®šreloadcmdï¼Œå½“è¯ä¹¦æ›´æ–°ä»¥åï¼Œreloadcmdä¼šè¢«è‡ªåŠ¨è°ƒç”¨ï¼Œè®©æœåŠ¡å™¨ç”Ÿæ•ˆï¼Œè¯¦ç»†å‚æ•°è¯·å‚è€ƒ: https://github.com/Neilpang/acme.sh#3-install-the-issued-cert-to-apachenginx-etc Nginxçš„é…ç½®ssl_certificateä½¿ç”¨/home/user/.nginx/ssl/fullchain.cerï¼Œè€Œé /home/user/.nginx/ssl/mydomain.com.cerï¼Œå¦åˆ™SSL Labs çš„æµ‹è¯•ä¼šæŠ¥Chain issues Incompleteé”™è¯¯\nä¿®æ”¹ visudo # ä¿®æ”¹ä¸€ä¸‹sudoeræ–‡ä»¶ï¼Œè®©sudo service nginx force-reloadä¸éœ€è¦è¾“å…¥å¯†ç \nsudo visudo æ–‡ä»¶å†…æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œuseræ˜¯acme.shå®‰è£…æ‰€ç”¨çš„è´¦å·\nuser ALL=(ALL) NOPASSWD: /usr/sbin/service nginx force-reload nanoç¼–è¾‘å™¨çš„ç®€å•ä½¿ç”¨ # ç§»åŠ¨å…‰æ ‡ ç”¨Ctrl+bç§»åŠ¨åˆ°ä¸Šä¸€å­—ç¬¦ï¼ŒCtrl+fç§»åŠ¨åˆ°ä¸‹ä¸€å­—ç¬¦ ç”¨Ctrl+pç§»åŠ¨åˆ°ä¸Šä¸€è¡Œï¼ŒCtrl+nç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œ ç”¨Ctrl+yç§»åŠ¨åˆ°ä¸Šä¸€é¡µï¼ŒCtrl+vç§»åŠ¨åˆ°ä¸‹ä¸€é¡µ\nä¿å­˜ ä½¿ç”¨Ctrl+oæ¥ä¿å­˜æ‰€åšçš„ä¿®æ”¹ï¼Œå›è½¦å³å¯\né€€å‡º æŒ‰Ctrl+x\nå…¶ä»– å…¶ä¸­^è¡¨ç¤ºCtrlé”®ï¼ŒMè¡¨ç¤ºAlté”®\nä½¿ç”¨å…¶ä»–ç¼–è¾‘å™¨ # å¦‚æœè§‰å¾—nanoä¸å¥½ç”¨ï¼Œå¯ä»¥è®¾ç½®ä½¿ç”¨å…¶ä»–ç¼–è¾‘å™¨ï¼Œè¾“å…¥ä»¥ä¸‹åï¼ŒæŒ‰ç…§æç¤ºé€‰æ‹©å³å¯\nsudo update-alternatives --config editor ç”Ÿæˆ dhparam.pem æ–‡ä»¶ # openssl dhparam -out /home/user/.nginx/ssl/dhparam.pem 2048 ä¿®æ”¹ Nginx é…ç½® # server { listen 80; listen 443 ssl; server_name mydomain.com; # è¯ä¹¦æ–‡ä»¶ ssl_certificate /home/user/.nginx/ssl/fullchain.cer; # è¯ä¹¦ç§é’¥ ssl_certificate_key /home/user/.nginx/ssl/mydomain.com.key; # ä¸ºDHEå¯†ç æŒ‡å®šå…·æœ‰DHå‚æ•°çš„æ–‡ä»¶ ssl_dhparam /home/user/.nginx/ssl/dhparam.pem; # å¼€å¯ç¼“å­˜ï¼Œæœ‰åˆ©äºå‡å°‘SSLæ¡æ‰‹å¼€é”€ ssl_session_cache shared:SSL:10m; # SSLä¼šè¯è¿‡æœŸæ—¶é—´ï¼Œæœ‰åˆ©äºå‡å°‘æœåŠ¡å™¨å¼€é”€ ssl_session_timeout 10m; # æŒ‡å®šå¯ç”¨çš„SSLåè®® ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # å±è”½ä¸å®‰å…¨çš„åŠ å¯†æ–¹å¼ ssl_ciphers \u0026#34;ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA\u0026#34;; # æŒ‡å®šåœ¨ä½¿ç”¨SSLv3å’ŒTLSåè®®æ—¶ï¼ŒæœåŠ¡å™¨å¯†ç åº”ä¼˜å…ˆäºå®¢æˆ·ç«¯å¯†ç  ssl_prefer_server_ciphers on; # å¼€å¯HSTSï¼Œå¼ºåˆ¶å…¨ç«™åŠ å¯†ï¼Œå¦‚æœä½ çš„ç½‘ç«™è¦å¼•ç”¨ä¸åŠ å¯†çš„èµ„æºï¼Œæˆ–è€…è€ƒè™‘å°†æ¥å–æ¶ˆåŠ å¯†ï¼Œå°±ä¸è¦å¼€è¿™ä¸ª add_header Strict-Transport-Security \u0026#34;max-age=63072000; includeSubdomains; preload\u0026#34;; # ... å…¶ä»–é…ç½® } é…ç½®å¥½åï¼Œæ‰§è¡Œ\n# æµ‹è¯•é…ç½®æ˜¯å¦æœ‰é—®é¢˜ sudo service nginx configtest # é‡å¯nginxæœåŠ¡ sudo service nginx restart æµ‹è¯•SSLæœåŠ¡ # æŒ‰ç…§ä»¥ä¸Šæ­¥éª¤å®Œæ•´é…å¥½åï¼Œåº”è¯¥æ˜¯ A+ æµ‹è¯•åœ°å€ï¼šhttps://www.ssllabs.com/ssltest/\nåç»­ç»´æŠ¤ # ç›®å‰ç”±äºacmeåè®®å’Œletsencrypt CAéƒ½åœ¨é¢‘ç¹çš„æ›´æ–°, å› æ­¤acme.shä¹Ÿç»å¸¸æ›´æ–°ä»¥ä¿æŒåŒæ­¥.\nacme.sh --upgrade # å¼€å¯è‡ªåŠ¨æ›´æ–° acme.sh --upgrade --auto-upgrade # å…³é—­è‡ªåŠ¨æ›´æ–° acme.sh --upgrade --auto-upgrade 0 ç›®å‰è¯ä¹¦åœ¨ 60 å¤©ä»¥åä¼šè‡ªåŠ¨æ›´æ–°, éœ€è¦å®šæœŸé‡æ–°ç”³è¯·ï¼Œè¿™éƒ¨åˆ†acme.shå·²ç»å¸®ä½ åšäº†ï¼Œåœ¨å®‰è£…çš„æ—¶å€™å¾€ crontabå¢åŠ äº†ä¸€è¡Œæ¯å¤©æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ‰§è¡Œcrontab -lï¼Œä¼šçœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯\n49 0 * * * \u0026#34;/home/user/.acme.sh\u0026#34;/acme.sh --cron --home \u0026#34;/home/user/.acme.sh\u0026#34; \u0026gt; /dev/null ä½ å¯ä»¥å°è¯•æ‰§è¡Œä¸€ä¸‹ï¼Œçœ‹çœ‹æ˜¯å¦æ­£ç¡®è¿è¡Œ\n\u0026#34;/home/user/.acme.sh\u0026#34;/acme.sh --cron --home \u0026#34;/home/user/.acme.sh\u0026#34; æœ€åèµ°ä¸€ä¸‹acme.sh --cronçš„æµç¨‹çœ‹çœ‹èƒ½å¦æ­£ç¡®æ‰§è¡Œ\nacme.sh --cron -f ","date":"2018å¹´10æœˆ06æ—¥","externalUrl":null,"permalink":"/posts/%E5%85%8D%E8%B4%B9%E7%BB%99%E8%87%AA%E5%B7%B1%E7%9A%84%E7%BD%91%E7%AB%99%E6%B7%BB%E5%8A%A0https%E5%AE%89%E5%85%A8%E5%8A%A0%E5%AF%86/","section":"Posts","summary":"","title":"å…è´¹ç»™è‡ªå·±çš„ç½‘ç«™æ·»åŠ HTTPSå®‰å…¨åŠ å¯†","type":"posts"},{"content":"","date":"2018å¹´10æœˆ01æ—¥","externalUrl":null,"permalink":"/tags/ruby/","section":"Tags","summary":"","title":"Ruby","type":"tags"},{"content":" å‚è€ƒåœ°å€ï¼šRuby ä¸­ require,load,autoload,extend,include,prepend çš„åŒºåˆ« load(filename, wrap=false) # =\u0026gt; true # æ¯æ¬¡è°ƒç”¨éƒ½ä¼šåŠ è½½å¹¶æ‰§è¡Œæ–‡ä»¶æ–‡ä»¶åä¸­çš„Rubyç¨‹åºã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸åœ¨ç»å¯¹è·¯å¾„ä¸­ï¼Œåˆ™åœ¨$:ä¸­æŸ¥æ‰¾è¯¥æ–‡ä»¶ã€‚å¦‚æœwrapå‚æ•°ä¸ºtrueï¼Œåˆ™åŠ è½½è„šæœ¬åœ¨åŒ¿åæ¨¡å—ä¸‹æ‰§è¡Œï¼Œä»è€Œä¿æŠ¤è°ƒç”¨ç¨‹åºçš„å…¨å±€åç§°ç©ºé—´ã€‚ä»»ä½•æƒ…å†µä¸‹ï¼ŒåŠ è½½æ–‡ä»¶ä¸­çš„ä»»ä½•å±€éƒ¨å˜é‡éƒ½ä¸ä¼šåŠ è½½åˆ°è°ƒç”¨ç¨‹åºçš„ç¯å¢ƒä¸­\nrequire(name) # =\u0026gt; true or false # åŠ è½½æŒ‡å®šåç§°çš„æ–‡ä»¶ï¼Œå¦‚æœåŠ è½½æˆåŠŸè¿”å›true, å¦‚æœå·²ç»åŠ è½½è¿”å›false å¦‚æœæ–‡ä»¶ä¸åœ¨ç»å¯¹è·¯å¾„ä¸­ï¼Œåˆ™å°†åœ¨$LOAD_PATH ($:)ä¸­æŸ¥æ‰¾ å¦‚æœæ–‡ä»¶ååç¼€ä¸º.rbï¼Œåˆ™åŠ è½½æºæ–‡ä»¶ã€‚å¦‚æœæ‰©å±•åæ˜¯å½“å‰ç³»ç»Ÿå¹³å°ä¸Šçš„äºŒè¿›åˆ¶åº“æ–‡ä»¶ï¼Œå¦‚.soï¼Œ.oæˆ–è€….dllï¼Œåˆ™Rubyä¼šäºŒè¿›åˆ¶åº“åŠ è½½ä¸ºRubyæ‰©å±•ã€‚å¦åˆ™ï¼ŒRubyä¼šå°è¯•æ·»åŠ .rbï¼Œ.soç­‰ç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ã€‚å¦åˆ™ï¼Œå°±ä¼šè§¦å‘LoadErrorå¼‚å¸¸ Rubyæ‰©å±•åç»™å‡ºçš„æ–‡ä»¶åå¯ä»¥ä½¿ç”¨ä»»ä½•å…±äº«åº“æ‰©å±•, ä¾‹å¦‚ï¼Œåœ¨Linuxä¸Šï¼Œå¥—æ¥å­—æ‰©å±•åä¸ºsocket.soï¼Œrequire \u0026quot;socket.dll\u0026quot; å°†åŠ è½½å¥—æ¥å­—æ‰©å±•å åŠ è½½æ–‡ä»¶çš„è·¯å¾„å°†è¢«æ·»åŠ åˆ°$LOADED_FEATURES ($\u0026quot;)ä¸­ åŠ è½½çš„æºæ–‡ä»¶ä¸­çš„ä»»ä½•å¸¸é‡æˆ–å…¨å±€å˜é‡éƒ½å°†åœ¨è°ƒç”¨ç¨‹åºçš„å…¨å±€å‘½åç©ºé—´ä¸­å¯ç”¨\nautoload(module, filename) # =\u0026gt; nil # moduleé€šå¸¸æ˜¯æ¨¡å—åæˆ–è€…ç±»åï¼Œåªæœ‰åœ¨è°ƒç”¨æ¨¡å—æˆ–è€…ç±»æ—¶æ‰ä¼šåŠ è½½æ–‡ä»¶\n# m.rb module M puts \u0026#39;Load M module\u0026#39; class A def self.hello puts \u0026#39;Hello\u0026#39; end end end ## require ï¼šåªåŠ è½½ä¸€æ¬¡ puts \u0026#34;first load: #{(require \u0026#39;./m.rb\u0026#39;)}\u0026#34; #= \u0026gt; load M module #= \u0026gt; first load: true puts \u0026#34;load again: #{(require \u0026#39;./m.rb\u0026#39;)}\u0026#34; #= \u0026gt; load again: false # load ï¼šå¤šæ¬¡åŠ è½½ puts \u0026#34;first load: #{(load \u0026#39;./m.rb\u0026#39;)}\u0026#34; #= \u0026gt; load M module #= \u0026gt; first load: true puts \u0026#34;load again: #{(load \u0026#39;./m.rb\u0026#39;)}\u0026#34; #= \u0026gt; load M module #= \u0026gt; load again: true # autoload ï¼šè°ƒç”¨æ—¶æ‰åŠ è½½ puts \u0026#34;first load: #{autoload(:M,\u0026#39;./m.rb\u0026#39;)}\u0026#34; #= \u0026gt; first load: puts \u0026#34;load again: #{autoload(:M,\u0026#39;./m.rb\u0026#39;)}\u0026#34; #= \u0026gt; load again: M::A.hello # =\u0026gt; Load M module #= \u0026gt; Hello ","date":"2018å¹´10æœˆ01æ—¥","externalUrl":null,"permalink":"/posts/ruby%E7%9A%84loadrequire-autoload/","section":"Posts","summary":"","title":"Rubyçš„loadï¼Œrequire, autoload","type":"posts"},{"content":" include, extend, prepend # å‚è€ƒåœ°å€ï¼šruby include extend prepend ä½¿ç”¨æ–¹æ³• module A def a_method puts \u0026#39;a method\u0026#39; end def self.aa_method puts \u0026#39;aa method\u0026#39; end end module B extend A end module C include A end class AA extend A end class BB include A end class CC prepend A def a_method puts \u0026#39;a method in CC\u0026#39; end end B.ancestors # =\u0026gt; [B] C.ancestors # =\u0026gt; [C, A] AA.ancestors # =\u0026gt; [AA, Object, Kernel, BasicObject] BB.ancestors # =\u0026gt; [BB, A, Object, Kernel, BasicObject] CC.ancestors # =\u0026gt; [A, CC, Object, Kernel, BasicObject] BBå°†æ–°å¢ä¸€ä¸ªç±»æ–¹æ³•ï¼ŒAAçš„ç¥–å…ˆé“¾ä¸­æ²¡æœ‰A CCå°†æ–°å¢ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼ŒBBçš„ç¥–å…ˆé“¾ä¸­æœ‰A\nRuby prependä¸includeç±»ä¼¼ï¼Œé¦–å…ˆéƒ½æ˜¯æ·»åŠ å®ä¾‹æ–¹æ³•çš„ï¼Œä¸åŒçš„æ˜¯æ‰©å±•moduleåœ¨ç¥–å…ˆé“¾ä¸Šçš„æ”¾ç½®ä½ç½®ä¸åŒ\nå½“è°ƒç”¨æ–¹æ³•æ—¶ï¼Œ Rubyæ˜¯å¦‚ä½•æ‰¾åˆ°æ–¹æ³•å®šä¹‰çš„ # å®ä¾‹æ–¹æ³•ï¼Œé¦–å…ˆåœ¨å®ä¾‹ä¸­æŸ¥æ‰¾ï¼Œç„¶åå†å®ä¾‹å¯¹è±¡çš„å•ä»¶ç±»ä¸­æŸ¥æ‰¾ï¼Œä¹‹åæ²¿ç¥–å…ˆé“¾ä¾æ¬¡å‘ä¸Šæ‰¾ ç±»æ–¹æ³•ï¼Œé¦–å…ˆåœ¨ç±»çš„å•ä»¶ç±»ä¸­æŸ¥æ‰¾ï¼Œç„¶åæ²¿ç€ç±»çš„å•ä»¶ç±»çš„ç¥–å…ˆé“¾ä¸€æ¬¡å‘ä¸Šæ‰¾ï¼ˆç±»çš„å•ä»¶ç±»çš„ç¥–å…ˆé“¾ = ç±»çš„ç¥–å…ˆé“¾çš„å„ä¸ªèŠ‚ç‚¹çš„å•ä»¶ç±»ç»„æˆçš„é“¾ï¼‰ ","date":"2018å¹´09æœˆ30æ—¥","externalUrl":null,"permalink":"/posts/ruby%E4%B8%AD%E7%9A%84includeextend%E4%B8%8Eprepend/","section":"Posts","summary":"","title":"Rubyä¸­çš„includeï¼Œextendä¸prepend","type":"posts"},{"content":" é’©å­æ–¹æ³•æä¾›äº†ä¸€ç§æ–¹å¼ç”¨äºåœ¨ç¨‹åºè¿è¡Œæ—¶æ‰©å±•ç¨‹åºçš„è¡Œä¸º\nå‚è€ƒåœ°å€ï¼šRuby ä¸­ä¸€äº›é‡è¦çš„é’©å­æ–¹æ³• included # includedæ–¹æ³•æ˜¯åŸºäºincludeçš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨ä¸€äº›moduleæˆ–è€…classä¸­includeäº†ä¸€ä¸ªmoduleæ—¶å®ƒä¼šè¢«è°ƒç”¨ã€‚å®é™…åœ¨æ‰§è¡Œincludedä¹‹å‰ï¼Œæ¨¡å—ä¸­çš„append_featuresè¢«è°ƒç”¨å¹¶æ‰§è¡Œå…·ä½“çš„includeæ“ä½œï¼Œæ³¨æ„ä½¿ç”¨æ—¶ä¸è¦éšæ„è¦†ç›–Rubyçš„append_featuresæ–¹æ³•\nmodule M def self.included(base) puts \u0026#34;#{base} included #{self}\u0026#34; end def a_method puts \u0026#34;a_method in M\u0026#34; end end class C include M end # =\u0026gt; \u0026#34;C included M\u0026#34; module O include M end # =\u0026gt; å½“æ‰§è¡Œinclude Mæ—¶ï¼ŒMä¸­çš„includedæ–¹æ³•å°†ä¼šè¢«è°ƒç”¨ï¼Œbaseæ—¢æ˜¯æ‰§è¡Œincludeæ—¶åŒ…å«è¯¥moduleçš„ç±»å\nextended # æ‰©å±•(extend) ä¸€ä¸ªæ¨¡å—ï¼Œè¿™ä¸ åŒ…å«(include) æœ‰ç‚¹ä¸åŒã€‚ extendæ˜¯å°†å®šä¹‰åœ¨ æ¨¡å—(module) å†…çš„æ–¹æ³•åº”ç”¨ä¸ºç±»çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯å®ä¾‹çš„æ–¹æ³•, extendedå°±æ˜¯extendç›¸å¯¹åº”çš„é’©å­æ–¹æ³•ï¼Œæ³¨æ„ä½¿ç”¨æ—¶ä¸è¦éšæ„è¦†ç›–Rubyçš„extend_objectæ–¹æ³•\nmodule M def self.extended(base) puts \u0026#34;#{base} extended #{self}\u0026#34; end def a_method puts \u0026#34;a_method in M\u0026#34; end end class C extend M end # =\u0026gt; \u0026#34;C extended M\u0026#34; module O extend M end # =\u0026gt; \u0026#34;O extended M\u0026#34; prepended # prependæ˜¯åœ¨Ruby 2.0ä¸­å¼•å…¥çš„ï¼Œå¹¶ä¸”ä¸includeå’Œextendå¾ˆä¸ä¸€æ ·ã€‚ ä½¿ç”¨ includeå’Œextendå¼•å…¥çš„æ–¹æ³•å¯ä»¥è¢«ç›®æ ‡æ¨¡å—/ç±»é‡æ–°å®šä¹‰è¦†ç›–,è€Œprependæ˜¯ä¸ä¸€æ ·çš„ï¼Œå®ƒä¼šå°†prependå¼•å…¥çš„æ¨¡å— ä¸­çš„æ–¹æ³•è¦†ç›–æ‰æˆ‘ä»¬æ¨¡å—/ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œprependedå°±æ˜¯prependçš„é’©å­æ–¹æ³•ï¼Œæ³¨æ„ä½¿ç”¨æ—¶ä¸è¦éšæ„è¦†ç›–Rubyçš„prepend_featuresæ–¹æ³•\nmodule M def self.prepended(base) puts \u0026#34;#{base} prepended to #{self}\u0026#34; end def a_method puts \u0026#34;a_method in M\u0026#34; end end class C prepend M end # =\u0026gt; \u0026#34;C prepended to M\u0026#34; module O prepend M end # =\u0026gt; \u0026#34;O prepended to M\u0026#34; inherited # ç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡ä¸­ä¸€ä¸ªæœ€é‡è¦çš„æ¦‚å¿µã€‚Rubyæ˜¯ä¸€é—¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ï¼Œå¹¶ä¸”æä¾›äº†ä»åŸº/çˆ¶ç±»ç»§æ‰¿ä¸€ä¸ªå­ç±»çš„åŠŸèƒ½ï¼Œinheritedå°±æ˜¯ç»§æ‰¿çš„é’©å­æ–¹æ³•\nclass M def self.inherited(base) puts \u0026#34;#{base} inherits #{self}\u0026#34; end def a_method puts \u0026#34;a_method in M\u0026#34; end end class C \u0026lt; M; end # =\u0026gt; \u0026#34;C inherits M\u0026#34; methodçš„é’©å­æ–¹æ³• # å®šä¹‰ï¼Œåˆ é™¤ï¼Œå–æ¶ˆå½“å‰ç±»ä¸­å®šä¹‰çš„æ–¹æ³•æ—¶ä¼šè§¦å‘ç±»æˆ–è€…å•ä¾‹ç±»çš„ç›¸å¯¹åº”çš„é’©å­æ–¹æ³•\nclass C def self.method_added(method_name) puts \u0026#34;Adding #{method_name.inspect}\u0026#34; end def self.method_removed(method_name) puts \u0026#34;Removing #{method_name.inspect}\u0026#34; end def self.method_undefined(method_name) puts \u0026#34;Undefined #{method_name.inspect}\u0026#34; end # è§¦å‘singleton_method_addedé’©å­æ–¹æ³• def self.singleton_method_added(method_name) puts \u0026#34;Adding singleton #{method_name.inspect}\u0026#34; end # è§¦å‘singleton_method_addedé’©å­æ–¹æ³• def self.singleton_method_removed(method_name) puts \u0026#34;Removing singleton #{method_name.inspect}\u0026#34; end # è§¦å‘singleton_method_addedé’©å­æ–¹æ³• def self.singleton_method_undefined(method_name) puts \u0026#34;Undefined singleton #{method_name.inspect}\u0026#34; end # è§¦å‘singleton_method_addedé’©å­æ–¹æ³• def self.singleton_class_method_added(); end # è§¦å‘method_addedé’©å­æ–¹æ³• def class_method_added(); end # è§¦å‘singleton_method_addedé’©å­æ–¹æ³• def self.singleton_class_method_removed(); end # è§¦å‘method_addedé’©å­æ–¹æ³• def class_method_removed(); end # è§¦å‘singleton_method_addedé’©å­æ–¹æ³• def self.singleton_class_method_undefined(); end # è§¦å‘method_addedé’©å­æ–¹æ³• def class_method_undefined(); end class \u0026lt;\u0026lt; self # è§¦å‘singleton_method_removedé’©å­æ–¹æ³• remove_method :singleton_class_method_removed # è§¦å‘singleton_method_undefinedé’©å­æ–¹æ³• undef_method :singleton_class_method_undefined end # è§¦å‘method_removedé’©å­æ–¹æ³• remove_method :class_method_removed # è§¦å‘method_undefinedé’©å­æ–¹æ³• undef_method :class_method_undefined end # Adding singleton :singleton_method_added # Adding singleton :singleton_method_removed # Adding singleton :singleton_method_undefined # Adding singleton :singleton_class_method_added # Adding :class_method_added # Adding singleton :singleton_class_method_removed # Adding :class_method_removed # Adding singleton :singleton_class_method_undefined # Adding :class_method_undefined # Removing singleton :singleton_class_method_removed # Undefined singleton :singleton_class_method_undefined # Removing :class_method_removed # Undefined :class_method_undefined ","date":"2018å¹´09æœˆ29æ—¥","externalUrl":null,"permalink":"/posts/ruby%E4%B8%AD%E7%9A%84%E9%92%A9%E5%AD%90%E6%96%B9%E6%B3%95/","section":"Posts","summary":"","title":"Rubyä¸­çš„é’©å­æ–¹æ³•","type":"posts"},{"content":"","date":"2018å¹´09æœˆ28æ—¥","externalUrl":null,"permalink":"/tags/rails/","section":"Tags","summary":"","title":"Rails","type":"tags"},{"content":" æ™®é€šçš„mixin # module M # self.includedæ˜¯includeæ—¶çš„é’©å­æ–¹æ³• def self.included(base) # baseæ‰©å±• base.extend ClassMethods # æ‰“å¼€baseï¼Œåœ¨baseä¸­æ‰§è¡Œä»£ç  base.class_eval do # è¿™é‡Œå†™ä¸€ä¸ªç±»includeæ—¶åœ¨ç±»éœ€è¦æ‰§è¡Œä»€ä¹ˆåŠ¨ä½œ end end module ClassMethods # è¿™é‡Œå†™ä¸€ä¸ªç±»includeè¯¥moduleåç”Ÿæˆçš„ç±»æ–¹æ³• end # è¿™é‡Œå†™ä¸€ä¸ªç±»includeè¯¥moduleåç”Ÿæˆçš„å®ä¾‹ç±»æ–¹æ³• end ä½¿ç”¨ ActiveSupport::Concern # require \u0026#39;active_support/concern\u0026#39; module M # æ‰©å±•å½“å‰module extend ActiveSupport::Concern # è°ƒç”¨Concernä¸­å®šä¹‰çš„includedæ–¹æ³• included do # è¿™é‡Œå†™ä¸€ä¸ªç±»includeæ—¶åœ¨ç±»éœ€è¦æ‰§è¡Œä»€ä¹ˆåŠ¨ä½œ end # è°ƒç”¨Concernä¸­å®šä¹‰çš„class_methodsæ–¹æ³• class_methods do # è¿™é‡Œå†™ä¸€ä¸ªç±»includeè¯¥moduleåç”Ÿæˆçš„ç±»æ–¹æ³• end # è¿™é‡Œå†™ä¸€ä¸ªç±»includeè¯¥moduleåç”Ÿæˆçš„å®ä¾‹ç±»æ–¹æ³• end è§£è¯» ActiveSupport::Concern # module ActiveSupport module Concern # å®šä¹‰äº†ä¸€ä¸ªå¼‚å¸¸ç±»ï¼Œä¸èƒ½å¤šæ¬¡include class MultipleIncludedBlocks \u0026lt; StandardError def initialize super \u0026#34;Cannot define multiple \u0026#39;included\u0026#39; blocks for a Concern\u0026#34; end end # self.extendedæ˜¯extendæ—¶çš„é’©å­æ–¹æ³• def self.extended(base) # å®šä¹‰baseä¸­çš„@_dependencies base.instance_variable_set(:@_dependencies, []) end # rubyåœ¨includeä¸€ä¸ªmoduleæ—¶ä¼šè°ƒç”¨append_featuresæ–¹æ³•ï¼Œè¿›è¡Œå®é™…çš„mixinæ“ä½œï¼ŒåŒ…æ‹¬å¢åŠ å¸¸é‡ï¼Œæ–¹æ³•å’Œå˜é‡åˆ°æ¨¡å—ä¸­ def append_features(base) if base.instance_variable_defined?(:@_dependencies) # å¦‚æœæœ‰å¼•å…¥å·²ç»å®šä¹‰@_dependenciesæ—¶ï¼Œä¸€èˆ¬æ˜¯å¼•å…¥ä¸€ä¸ªå·²ç»extendè¿™ä¸ªConcernçš„moduleï¼Œæ‰ä¼šå®šä¹‰@_dependencies # å°†åextendè¿™ä¸ªConcernçš„moduleæ”¾å…¥åˆ°@_dependenciesä¸­ base.instance_variable_get(:@_dependencies) \u0026lt;\u0026lt; self false else return false if base \u0026lt; self # @_dependenciesæ˜¯è¯¦è§ä¸Šé¢å®šä¹‰çš„self.extended # å…ˆå¼•å…¥åŒ…å«åœ¨@_dependenciesä¸­module @_dependencies.each { |dep| base.include(dep) } super # ClassMethodsæ˜¯è¯¦è§ä¸‹é¢å®šä¹‰çš„class_methods # å¦‚æœå®šä¹‰ClassMethods,å°†ClassMethodsä¸­çš„æ–¹æ³•extendåˆ°baseä¸­ base.extend const_get(:ClassMethods) if const_defined?(:ClassMethods) # @_included_blockæ˜¯è¯¦è§ä¸‹é¢å®šä¹‰çš„includedæ–¹æ³• # å¦‚æœå®šä¹‰@_included_block,åœ¨baseä¸­æ‰§è¡Œ@_included_blockä¸­çš„ä»£ç  base.class_eval(\u0026amp;@_included_block) if instance_variable_defined?(:@_included_block) end end # extendåï¼Œå°†å¯ä»¥ä½¿ç”¨includedè¿™ä¸ªæ–¹æ³• def included(base = nil, \u0026amp;block) if base.nil? # åˆ¤æ–­æ˜¯å¦å¤šæ¬¡include raise MultipleIncludedBlocks if instance_variable_defined?(:@_included_block) # å®šä¹‰ç±»å®ä¾‹ç±»å˜é‡ @_included_block = block else super end end # extendåï¼Œå°†å¯ä»¥ä½¿ç”¨class_methodsè¿™ä¸ªæ–¹æ³• def class_methods(\u0026amp;class_methods_module_definition) # extendæ—¶åˆ¤æ–­å½“å‰moduleæ˜¯å¦å®šä¹‰äº†ClassMethodsè¿™ä¸ªå¸¸é‡ï¼Œä¸åŒ…æ‹¬çˆ¶çº§ # æœ‰çš„è¯å°±ä½¿ç”¨å·²ç»å®šä¹‰å¥½çš„ï¼Œæ²¡æœ‰å°±Module.newä¸€ä¸ª mod = const_defined?(:ClassMethods, false) ? const_get(:ClassMethods) : const_set(:ClassMethods, Module.new) # extendåï¼Œè°ƒç”¨class_methodsæ–¹æ—¶å°†å—é‡Œçš„å®šå†™å…¥åˆ°ClassMethodsé‡Œ mod.module_eval(\u0026amp;class_methods_module_definition) end end end ","date":"2018å¹´09æœˆ28æ—¥","externalUrl":null,"permalink":"/posts/rails%E4%B8%AD%E7%9A%84activesupport-concern/","section":"Posts","summary":"","title":"Railsä¸­çš„ActiveSupport::Concern","type":"posts"},{"content":"åŸæ–‡åœ°å€ å¯¹æ¡ä»¶ GET è¯·æ±‚çš„æ”¯æŒ # æ¡ä»¶ GET è¯·æ±‚æ˜¯ HTTP è§„èŒƒçš„ä¸€ä¸ªç‰¹æ€§ï¼Œä»¥æ­¤å‘Šè¯‰ Web æµè§ˆå™¨ï¼ŒGET è¯·æ±‚çš„å“åº”è‡ªä¸Šæ¬¡è¯·æ±‚ä¹‹åæ²¡æœ‰å˜åŒ–ï¼Œå¯ä»¥æ”¾å¿ƒä»æµè§ˆå™¨çš„ç¼“å­˜ä¸­è¯»å–ã€‚\nä¸ºæ­¤ï¼Œè¦ä¼ é€’HTTP_IF_NONE_MATCHå’Œ HTTP_IF_MODIFIED_SINCEé¦–éƒ¨ï¼Œå…¶å€¼åˆ†åˆ«ä¸ºå”¯ä¸€çš„å†…å®¹æ ‡è¯†ç¬¦å’Œä¸Šä¸€æ¬¡æ”¹åŠ¨æ—¶çš„æ—¶é—´æˆ³ã€‚æµè§ˆå™¨å‘é€çš„è¯·æ±‚ï¼Œå¦‚æœå†…å®¹æ ‡è¯†ç¬¦ï¼ˆetagï¼‰æˆ–ä¸Šä¸€æ¬¡ä¿®æ”¹çš„æ—¶é—´æˆ³ä¸æœåŠ¡å™¨ä¸­çš„ç‰ˆæœ¬åŒ¹é…ï¼Œé‚£ä¹ˆæœåŠ¡å™¨åªéœ€è¿”å›ä¸€ä¸ªç©ºå“åº”ï¼ŒæŠŠçŠ¶æ€è®¾ä¸ºæœªä¿®æ”¹ã€‚\næœåŠ¡å™¨ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬è‡ªå·±ï¼‰è¦è´Ÿè´£æŸ¥çœ‹æœ€åä¿®æ”¹æ—¶é—´æˆ³å’ŒHTTP_IF_NONE_MATCHé¦–éƒ¨ï¼Œåˆ¤æ–­è¦ä¸è¦è¿”å›å®Œæ•´çš„å“åº”ã€‚æ—¢ç„¶ Rails æ”¯æŒæ¡ä»¶ GET è¯·æ±‚ï¼Œé‚£ä¹ˆè¿™ä¸ªä»»åŠ¡å°±éå¸¸ç®€å•ï¼š\nclass ProductsController \u0026lt; ApplicationController def show @product = Product.find(params[:id]) # å¦‚æœæ ¹æ®æŒ‡å®šçš„æ—¶é—´æˆ³å’Œ etag å€¼åˆ¤æ–­è¯·æ±‚çš„å†…å®¹è¿‡æœŸäº† # ï¼ˆå³éœ€è¦é‡æ–°å¤„ç†ï¼‰æ‰§è¡Œè¿™ä¸ªå— if stale?(last_modified: @product.updated_at.utc, etag: @product.cache_key) respond_to do |wants| # ... æ­£å¸¸å¤„ç†å“åº” end end # å¦‚æœè¯·æ±‚çš„å†…å®¹è¿˜æ–°é²œï¼ˆå³æœªä¿®æ”¹ï¼‰ï¼Œæ— éœ€åšä»»ä½•äº‹ # render é»˜è®¤ä½¿ç”¨å‰é¢ stale? ä¸­çš„å‚æ•°åšæ£€æŸ¥ï¼Œä¼šè‡ªåŠ¨å‘é€ :not_modified å“åº” # å°±è¿™æ ·ï¼Œå·¥ä½œç»“æŸ end end é™¤äº†æ•£åˆ—ï¼Œè¿˜å¯ä»¥ä¼ å…¥æ¨¡å‹ã€‚Rails ä¼šä½¿ç”¨updated_atå’Œ cache_keyæ–¹æ³•è®¾å®šlast_modifiedå’Œetagï¼š\nclass ProductsController \u0026lt; ApplicationController def show @product = Product.find(params[:id]) if stale?(@product) respond_to do |wants| # ... æ­£å¸¸å¤„ç†å“åº” end end end end å¦‚æœæ— éœ€ç‰¹æ®Šå¤„ç†å“åº”ï¼Œè€Œä¸”ä½¿ç”¨é»˜è®¤çš„æ¸²æŸ“æœºåˆ¶ï¼ˆå³ä¸ä½¿ç”¨respond_toï¼Œæˆ–è€…ä¸è‡ªå·±è°ƒç”¨renderï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ fresh_whenç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼š\nclass ProductsController \u0026lt; ApplicationController # å¦‚æœè¯·æ±‚çš„å†…å®¹æ˜¯æ–°é²œçš„ï¼Œè‡ªåŠ¨è¿”å› :not_modified # å¦åˆ™æ¸²æŸ“é»˜è®¤çš„æ¨¡æ¿ï¼ˆproduct.*ï¼‰ def show @product = Product.find(params[:id]) fresh_when last_modified: @product.published_at.utc, etag: @product end end æœ‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç¼“å­˜å“åº”ï¼Œä¾‹å¦‚æ°¸ä¸è¿‡æœŸçš„é™æ€é¡µé¢ã€‚ä¸ºæ­¤ï¼Œå¯ä»¥ä½¿ç”¨ http_cache_foreverè¾…åŠ©æ–¹æ³•ï¼Œè®©æµè§ˆå™¨å’Œä»£ç†æ— é™æœŸç¼“å­˜ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œç¼“å­˜çš„å“åº”æ˜¯ç§æœ‰çš„ï¼Œåªåœ¨ç”¨æˆ·çš„ Web æµè§ˆå™¨ä¸­ç¼“å­˜ã€‚å¦‚æœæƒ³è®©ä»£ç†ç¼“å­˜å“åº”ï¼Œè®¾å®špublic: trueï¼Œè®©ä»£ç†æŠŠç¼“å­˜çš„å“åº”æä¾›ç»™æ‰€æœ‰ç”¨æˆ·ã€‚\nä½¿ç”¨è¿™ä¸ªè¾…åŠ©æ–¹æ³•æ—¶ï¼Œlast_modifiedé¦–éƒ¨çš„å€¼è¢«è®¾ä¸ºTime.new(2011, 1, 1).utcï¼Œexpiresé¦–éƒ¨çš„å€¼è¢«è®¾ä¸º 100 å¹´ã€‚\nä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ—¶è¦å°å¿ƒï¼Œå› ä¸ºæµè§ˆå™¨å’Œä»£ç†ä¸ä¼šä½œåºŸç¼“å­˜çš„å“åº”ï¼Œé™¤éå¼ºåˆ¶æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ã€‚\nclass HomeController \u0026lt; ApplicationController def index http_cache_forever(public: true) do render end end end å¼º Etag ä¸å¼± Etag # Rails é»˜è®¤ç”Ÿæˆå¼± ETagã€‚è¿™ç§ Etag å…è®¸è¯­ä¹‰ç­‰æ•ˆä½†ä¸»ä½“ä¸å®Œå…¨åŒ¹é…çš„å“åº”å…·æœ‰ç›¸åŒçš„ Etagã€‚å¦‚æœå“åº”ä¸»ä½“æœ‰å¾®å°æ”¹åŠ¨ï¼Œè€Œä¸æƒ³é‡æ–°æ¸²æŸ“é¡µé¢ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§ Etagã€‚\nä¸ºäº†ä¸å¼º Etag åŒºåˆ«ï¼Œå¼± Etag å‰é¢æœ‰W/ã€‚\nW/\u0026#34;618bbc92e2d35ea1945008b42799b0e7\u0026#34; # =\u0026gt; å¼± ETag \u0026#34;618bbc92e2d35ea1945008b42799b0e7\u0026#34; # =\u0026gt; å¼º ETag ä¸å¼± Etag ä¸åŒï¼Œå¼º Etag è¦æ±‚å“åº”å®Œå…¨ä¸€æ ·ï¼Œä¸èƒ½æœ‰ä¸€ä¸ªå­—èŠ‚çš„å·®å¼‚ã€‚åœ¨å¤§å‹è§†é¢‘æˆ– PDF æ–‡ä»¶å†…éƒ¨åš Range æŸ¥è¯¢æ—¶ç”¨å¾—åˆ°ã€‚æœ‰äº› CDNï¼Œå¦‚ Akamaiï¼Œåªæ”¯æŒå¼º Etagã€‚å¦‚æœç¡®å®æƒ³ç”Ÿæˆå¼º Etagï¼Œå¯ä»¥è¿™ä¹ˆåšï¼š\nclass ProductsController \u0026lt; ApplicationController def show @product = Product.find(params[:id]) fresh_when last_modified: @product.published_at.utc, strong_etag: @product end end ä¹Ÿå¯ä»¥ç›´æ¥åœ¨å“åº”ä¸Šè®¾å®šå¼º Etagï¼š\nresponse.strong_etag = response.body # =\u0026gt; \u0026#34;618bbc92e2d35ea1945008b42799b0e7\u0026#34; ","date":"2018å¹´09æœˆ27æ—¥","externalUrl":null,"permalink":"/posts/rails%E5%AF%B9http%E6%9D%A1%E4%BB%B6get%E8%AF%B7%E6%B1%82%E7%9A%84%E6%94%AF%E6%8C%81/","section":"Posts","summary":"","title":"Railså¯¹HTTPæ¡ä»¶GETè¯·æ±‚çš„æ”¯æŒ","type":"posts"},{"content":" Rails ä¸ºå­˜å‚¨ç¼“å­˜æ•°æ®ï¼ˆSQL ç¼“å­˜å’Œé¡µé¢ç¼“å­˜é™¤å¤–ï¼‰æä¾›äº†ä¸åŒçš„å­˜å‚¨å™¨ã€‚\nåŸæ–‡åœ°å€ é…ç½® # config.cache_store é…ç½®é€‰é¡¹ç”¨äºè®¾å®šåº”ç”¨çš„é»˜è®¤ç¼“å­˜å­˜å‚¨å™¨ã€‚å¯ä»¥è®¾å®šå…¶ä»–å‚æ•°ï¼Œä¼ ç»™ç¼“å­˜å­˜å‚¨å™¨çš„æ„é€ æ–¹æ³•\nconfig.cache_store = :memory_store, { size: 64.megabytes } æ­¤å¤–ï¼Œè¿˜å¯ä»¥åœ¨é…ç½®å—å¤–éƒ¨è°ƒç”¨ ActionController::Base.cache_storeã€‚\nç¼“å­˜å­˜å‚¨å™¨é€šè¿‡ Rails.cache è®¿é—®ã€‚\nActiveSupport::Cache::Store # è¿™ä¸ªç±»æ˜¯åœ¨ Rails ä¸­ä¸ç¼“å­˜äº¤äº’çš„åŸºç¡€ã€‚è¿™æ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ã€‚ä½ å¿…é¡»æ ¹æ®å­˜å‚¨å™¨å¼•æ“å…·ä½“å®ç°è¿™ä¸ªç±»ã€‚Rails æä¾›äº†å‡ ä¸ªå®ç°ï¼Œè¯´æ˜å¦‚ä¸‹ã€‚\nä¸»è¦è°ƒç”¨çš„æ–¹æ³•æœ‰readã€writeã€deleteã€exist?å’Œfetchã€‚fetchæ–¹æ³•æ¥å—ä¸€ä¸ªå—ï¼Œè¿”å›ç¼“å­˜ä¸­ç°æœ‰çš„å€¼ï¼Œæˆ–è€…æŠŠæ–°å€¼å†™å…¥ç¼“å­˜ã€‚\næ‰€æœ‰ç¼“å­˜å®ç°æœ‰äº›å…±ç”¨çš„é€‰é¡¹ï¼Œå¯ä»¥ä¼ ç»™æ„é€ æ–¹æ³•ï¼Œæˆ–è€…ä¼ ç»™ä¸ç¼“å­˜æ¡ç›®äº¤äº’çš„å„ä¸ªæ–¹æ³•ã€‚\n:namespaceï¼šåœ¨ç¼“å­˜å­˜å‚¨å™¨ä¸­åˆ›å»ºå‘½åç©ºé—´ã€‚å¦‚æœä¸å…¶ä»–åº”ç”¨å…±ç”¨åŒä¸€ä¸ªç¼“å­˜å­˜å‚¨å™¨ï¼Œè¿™ä¸ªé€‰é¡¹ç‰¹åˆ«æœ‰ç”¨ã€‚ :compressï¼šæŒ‡å®šå‹ç¼©ç¼“å­˜ã€‚é€šè¿‡ç¼“æ…¢çš„ç½‘ç»œä¼ è¾“å¤§é‡ç¼“å­˜æ—¶ç”¨å¾—ç€ã€‚ :compress_thresholdï¼šä¸ :compressé€‰é¡¹æ­é…ä½¿ç”¨ï¼ŒæŒ‡å®šä¸€ä¸ªé˜ˆå€¼ï¼Œæœªè¾¾åˆ°æ—¶ä¸å‹ç¼©ç¼“å­˜ã€‚é»˜è®¤ä¸º16åƒå­—èŠ‚ã€‚ :expires_inï¼šä¸ºç¼“å­˜æ¡ç›®è®¾å®šå¤±æ•ˆæ—¶é—´ï¼ˆç§’æ•°ï¼‰ï¼Œå¤±æ•ˆåè‡ªåŠ¨ä»ç¼“å­˜ä¸­åˆ é™¤ã€‚ :race_condition_ttlï¼šä¸ :expires_iné€‰é¡¹æ­é…ä½¿ç”¨ã€‚é¿å…å¤šä¸ªè¿›ç¨‹åŒæ—¶é‡æ–°ç”Ÿæˆç›¸åŒçš„ç¼“å­˜æ¡ç›®ï¼ˆä¹Ÿå« dog pile effectï¼‰ï¼Œé˜²æ­¢è®©ç¼“å­˜æ¡ç›®è¿‡æœŸæ—¶å‡ºç°æ¡ä»¶ç«äº‰ã€‚è¿™ä¸ªé€‰é¡¹è®¾å®šåœ¨é‡æ–°ç”Ÿæˆæ–°å€¼æ—¶å¤±æ•ˆçš„æ¡ç›®è¿˜å¯ä»¥ç»§ç»­ä½¿ç”¨å¤šä¹…ï¼ˆç§’æ•°ï¼‰ã€‚å¦‚æœä½¿ç”¨ :expires_in é€‰é¡¹ï¼Œæœ€å¥½ä¹Ÿè®¾å®šè¿™ä¸ªé€‰é¡¹ã€‚ è‡ªå®šä¹‰ç¼“å­˜å­˜å‚¨å™¨ # ç¼“å­˜å­˜å‚¨å™¨å¯ä»¥è‡ªå·±å®šä¹‰ï¼Œåªéœ€æ‰©å±•ActiveSupport::Cache::Storeç±»ï¼Œå®ç°ç›¸åº”çš„æ–¹æ³•ã€‚è¿™æ ·ï¼Œä½ å¯ä»¥æŠŠä»»ä½•ç¼“å­˜æŠ€æœ¯å¸¦åˆ°ä½ çš„ Rails åº”ç”¨ä¸­ã€‚\nè‹¥æƒ³ä½¿ç”¨è‡ªå®šä¹‰çš„ç¼“å­˜å­˜å‚¨å™¨ï¼Œåªéœ€æŠŠcache_storeè®¾ä¸ºè‡ªå®šä¹‰ç±»çš„å®ä¾‹ï¼š\nconfig.cache_store = MyCacheStore.new ActiveSupport::Cache::MemoryStore # è¿™ä¸ªç¼“å­˜å­˜å‚¨å™¨æŠŠç¼“å­˜æ¡ç›®æ”¾åœ¨å†…å­˜ä¸­ï¼Œä¸ Ruby è¿›ç¨‹æ”¾åœ¨ä¸€èµ·ã€‚å¯ä»¥æŠŠ:sizeé€‰é¡¹ä¼ ç»™æ„é€ æ–¹æ³•ï¼ŒæŒ‡å®šç¼“å­˜çš„å¤§å°é™åˆ¶ï¼ˆé»˜è®¤ä¸º32Mbï¼‰ã€‚è¶…è¿‡åˆ†é…çš„å¤§å°åï¼Œä¼šæ¸…ç†ç¼“å­˜ï¼ŒæŠŠæœ€ä¸å¸¸ç”¨çš„æ¡ç›®åˆ é™¤ã€‚\nconfig.cache_store = :memory_store, { size: 64.megabytes } å¦‚æœè¿è¡Œå¤šä¸ª Ruby on Rails æœåŠ¡å™¨è¿›ç¨‹ï¼ˆä¾‹å¦‚ä½¿ç”¨ Phusion Passenger æˆ– Puma é›†ç¾¤æ¨¡å¼ï¼‰ï¼Œå„ä¸ªå®ä¾‹ä¹‹é—´æ— æ³•å…±äº«ç¼“å­˜æ•°æ®ã€‚è¿™ä¸ªç¼“å­˜å­˜å‚¨å™¨ä¸é€‚åˆå¤§å‹åº”ç”¨ä½¿ç”¨ã€‚ä¸è¿‡ï¼Œé€‚åˆåªæœ‰å‡ ä¸ªæœåŠ¡å™¨è¿›ç¨‹çš„ä½æµé‡å°å‹åº”ç”¨ä½¿ç”¨ï¼Œä¹Ÿé€‚åˆåœ¨å¼€å‘ç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨\nActiveSupport::Cache::FileStore # è¿™ä¸ªç¼“å­˜å­˜å‚¨å™¨ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨ç¼“å­˜æ¡ç›®ã€‚åˆå§‹åŒ–è¿™ä¸ªå­˜å‚¨å™¨æ—¶ï¼Œå¿…é¡»æŒ‡å®šå­˜å‚¨æ–‡ä»¶çš„ç›®å½•ï¼š\nconfig.cache_store = :file_store, \u0026#34;/path/to/cache/directory\u0026#34; ä½¿ç”¨è¿™ä¸ªç¼“å­˜å­˜å‚¨å™¨æ—¶ï¼Œåœ¨åŒä¸€å°ä¸»æœºä¸­è¿è¡Œçš„å¤šä¸ªæœåŠ¡å™¨è¿›ç¨‹å¯ä»¥å…±äº«ç¼“å­˜ã€‚è¿™ä¸ªç¼“å­˜å­˜å‚¨å™¨é€‚åˆä¸€åˆ°ä¸¤ä¸ªä¸»æœºçš„ä¸­ä½æµé‡ç½‘ç«™ä½¿ç”¨ã€‚è¿è¡Œåœ¨ä¸åŒä¸»æœºä¸­çš„å¤šä¸ªæœåŠ¡å™¨è¿›ç¨‹è‹¥æƒ³å…±äº«ç¼“å­˜ï¼Œå¯ä»¥ä½¿ç”¨å…±äº«çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä½†æ˜¯ä¸å»ºè®®è¿™ä¹ˆåšã€‚\nç¼“å­˜é‡ä¸€ç›´å¢åŠ ï¼Œç›´åˆ°å¡«æ»¡ç£ç›˜ï¼Œæ‰€ä»¥å»ºè®®ä½ å®šæœŸæ¸…ç†æ—§ç¼“å­˜æ¡ç›®ã€‚\nè¿™æ˜¯é»˜è®¤çš„ç¼“å­˜å­˜å‚¨å™¨\nActiveSupport::Cache::MemCacheStore # è¿™ä¸ªç¼“å­˜å­˜å‚¨å™¨ä½¿ç”¨ Danga çš„memcachedæœåŠ¡å™¨ä¸ºåº”ç”¨æä¾›ä¸­å¿ƒåŒ–ç¼“å­˜ã€‚Rails é»˜è®¤ä½¿ç”¨è‡ªå¸¦çš„dalli gemã€‚è¿™æ˜¯ç”Ÿäº§ç¯å¢ƒçš„ç½‘ç«™ç›®å‰æœ€å¸¸ä½¿ç”¨çš„ç¼“å­˜å­˜å‚¨å™¨ã€‚é€šè¿‡å®ƒå¯ä»¥å®ç°å•ä¸ªå…±äº«çš„ç¼“å­˜é›†ç¾¤ï¼Œæ•ˆç‡å¾ˆé«˜ï¼Œæœ‰è¾ƒå¥½çš„å†—ä½™ã€‚\nåˆå§‹åŒ–è¿™ä¸ªç¼“å­˜å­˜å‚¨å™¨æ—¶ï¼Œè¦æŒ‡å®šé›†ç¾¤ä¸­æ‰€æœ‰memcachedæœåŠ¡å™¨çš„åœ°å€ã€‚å¦‚æœä¸æŒ‡å®šï¼Œå‡å®š memcachedè¿è¡Œåœ¨æœ¬åœ°çš„é»˜è®¤ç«¯å£ä¸Šï¼Œä½†æ˜¯å¯¹å¤§å‹ç½‘ç«™æ¥è¯´ï¼Œè¿™æ ·åšå¹¶ä¸å¥½ã€‚\nè¿™ä¸ªç¼“å­˜å­˜å‚¨å™¨çš„writeå’Œfetchæ–¹æ³•æ¥å—ä¸¤ä¸ªé¢å¤–çš„é€‰é¡¹ï¼Œä»¥ä¾¿åˆ©ç”¨memcachedçš„ç‹¬æœ‰ç‰¹æ€§ã€‚æŒ‡å®š:rawæ—¶ï¼Œç›´æ¥æŠŠå€¼å‘ç»™æœåŠ¡å™¨ï¼Œä¸åšåºåˆ—åŒ–ã€‚å€¼å¿…é¡»æ˜¯å­—ç¬¦ä¸²æˆ–æ•°å­—ã€‚memcachedçš„ç›´æ¥æ“ä½œï¼Œå¦‚incrementå’Œdecrementï¼Œåªèƒ½ç”¨äºåŸå§‹å€¼ã€‚è¿˜å¯ä»¥æŒ‡å®š:unless_existé€‰é¡¹ï¼Œä¸è®©memcachedè¦†ç›–ç°æœ‰æ¡ç›®ã€‚\nconfig.cache_store = :mem_cache_store, \u0026#34;cache-1.example.com\u0026#34;, \u0026#34;cache-2.example.com\u0026#34; ActiveSupport::Cache::NullStore # è¿™ä¸ªç¼“å­˜å­˜å‚¨å™¨åªåº”è¯¥åœ¨å¼€å‘æˆ–æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå®ƒå¹¶ä¸å­˜å‚¨ä»»ä½•ä¿¡æ¯ã€‚åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œå¦‚æœä»£ç ç›´æ¥ä¸Rails.cache äº¤äº’ï¼Œä½†æ˜¯ç¼“å­˜å¯èƒ½å¯¹ä»£ç çš„ç»“æœæœ‰å½±å“ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªç¼“å­˜å­˜å‚¨å™¨ã€‚åœ¨è¿™ä¸ªç¼“å­˜å­˜å‚¨å™¨ä¸Šè°ƒç”¨fetchå’Œreadæ–¹æ³•ä¸è¿”å›ä»»ä½•å€¼ã€‚\nconfig.cache_store = :null_store ç¼“å­˜é”® # ç¼“å­˜ä¸­ä½¿ç”¨çš„é”®å¯ä»¥æ˜¯èƒ½å“åº”cache_keyæˆ– to_paramæ–¹æ³•çš„ä»»ä½•å¯¹è±¡ã€‚å¦‚æœæƒ³å®šåˆ¶ç”Ÿæˆé”®çš„æ–¹å¼ï¼Œå¯ä»¥è¦†ç›–cache_keyæ–¹æ³•ã€‚Active Record æ ¹æ®ç±»åå’Œè®°å½• ID ç”Ÿæˆç¼“å­˜é”®ã€‚\nç¼“å­˜é”®çš„å€¼å¯ä»¥æ˜¯æ•£åˆ—æˆ–æ•°ç»„ï¼š\n# è¿™æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ç¼“å­˜é”® Rails.cache.read(site: \u0026#34;mysite\u0026#34;, owners: [owner_1, owner_2]) Rails.cacheä½¿ç”¨çš„é”®ä¸å­˜å‚¨å¼•æ“ä½¿ç”¨çš„å¹¶ä¸ç›¸åŒï¼Œå­˜å‚¨å¼•æ“ä½¿ç”¨çš„é”®å¯èƒ½å«æœ‰å‘½åç©ºé—´ï¼Œæˆ–è€…æ ¹æ®åç«¯çš„é™åˆ¶åšè°ƒæ•´ã€‚è¿™æ„å‘³ç€ï¼Œä½¿ç”¨Rails.cacheå­˜å‚¨å€¼æ—¶ä½¿ç”¨çš„é”®å¯èƒ½æ— æ³•ç”¨äºä¾› dalli gem è·å–ç¼“å­˜æ¡ç›®ã€‚ç„¶è€Œï¼Œä½ ä¹Ÿæ— éœ€æ‹…å¿ƒä¼šè¶…å‡ºmemcachedçš„å¤§å°é™åˆ¶ï¼Œæˆ–è€…è¿èƒŒå¥æ³•è§„åˆ™\n","date":"2018å¹´09æœˆ26æ—¥","externalUrl":null,"permalink":"/posts/rails%E7%BC%93%E5%AD%98%E5%AD%98%E5%82%A8%E5%99%A8/","section":"Posts","summary":"","title":"Railsç¼“å­˜å­˜å‚¨å™¨","type":"posts"},{"content":"æ›´å¤šè¯¦ç»†æŸ¥çœ‹åŸæ–‡åœ°å€ ç‰‡æ®µç¼“å­˜ # åŠ¨æ€ Web åº”ç”¨ä¸€èˆ¬ä½¿ç”¨ä¸åŒçš„ç»„ä»¶æ„å»ºé¡µé¢ï¼Œä¸æ˜¯æ‰€æœ‰ç»„ä»¶éƒ½èƒ½ä½¿ç”¨åŒä¸€ç§ç¼“å­˜æœºåˆ¶ã€‚å¦‚æœé¡µé¢çš„ä¸åŒéƒ¨åˆ†éœ€è¦ä½¿ç”¨ä¸åŒçš„ç¼“å­˜æœºåˆ¶ï¼Œåœ¨ä¸åŒçš„æ¡ä»¶ä¸‹å¤±æ•ˆï¼Œå¯ä»¥ä½¿ç”¨ç‰‡æ®µç¼“å­˜ï¼ˆActionView::Helpers::CacheHelper#cacheï¼‰ã€‚ç‰‡æ®µç¼“å­˜æŠŠè§†å›¾é€»è¾‘çš„ä¸€éƒ¨åˆ†æ”¾åœ¨ cache å—ä¸­ï¼Œä¸‹æ¬¡è¯·æ±‚ä½¿ç”¨ç¼“å­˜å­˜å‚¨å™¨ä¸­çš„å‰¯æœ¬ä¼ºæœ\nä½¿ç”¨ # å¦‚æœæƒ³ç¼“å­˜é¡µé¢ä¸­çš„å„ä¸ªå•†å“ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹è¿°ä»£ç ï¼š\n\u0026lt;% @products.each do |product| %\u0026gt; \u0026lt;% cache product do %\u0026gt; \u0026lt;%= render product %\u0026gt; \u0026lt;% end %\u0026gt; \u0026lt;% end %\u0026gt; é¦–æ¬¡è®¿é—®è¿™ä¸ªé¡µé¢æ—¶ï¼ŒRails ä¼šåˆ›å»ºä¸€ä¸ªå…·æœ‰å”¯ä¸€é”®çš„ç¼“å­˜æ¡ç›®ã€‚ç¼“å­˜é”®ç±»ä¼¼ä¸‹é¢è¿™ç§\nviews/products/1-201505056193031061005000/bea67108094918eeba42cd4a6e786901 ä¸­é—´çš„æ•°å­—æ˜¯ product_id åŠ ä¸Šå•†å“è®°å½•çš„ updated_at å±æ€§ä¸­å­˜å‚¨çš„æ—¶é—´æˆ³ã€‚Rails ä½¿ç”¨æ—¶é—´æˆ³ç¡®ä¿ä¸ä¼ºæœè¿‡æœŸçš„æ•°æ®ã€‚å¦‚æœ updated_at çš„å€¼å˜äº†ï¼ŒRails ä¼šç”Ÿæˆä¸€ä¸ªæ–°é”®ï¼Œç„¶ååœ¨é‚£ä¸ªé”®ä¸Šå†™å…¥ä¸€ä¸ªæ–°ç¼“å­˜ï¼Œæ—§é”®ä¸Šçš„æ—§ç¼“å­˜ä¸å†ä½¿ç”¨ã€‚è¿™å«åŸºäºé”®çš„å¤±æ•ˆæ–¹å¼\nè§†å›¾ç‰‡æ®µæœ‰å˜åŒ–æ—¶ï¼ˆä¾‹å¦‚è§†å›¾çš„ HTML æœ‰å˜ï¼‰ï¼Œç¼“å­˜çš„ç‰‡æ®µä¹Ÿå¤±æ•ˆã€‚ç¼“å­˜é”®æœ«å°¾é‚£ä¸ªå­—ç¬¦ä¸²æ˜¯æ¨¡æ¿æ ‘æ‘˜è¦ï¼Œæ˜¯åŸºäºç¼“å­˜çš„è§†å›¾ç‰‡æ®µçš„å†…å®¹è®¡ç®—çš„ MD5 å“ˆå¸Œå€¼ã€‚å¦‚æœè§†å›¾ç‰‡æ®µæœ‰å˜åŒ–ï¼ŒMD5 å“ˆå¸Œå€¼å°±å˜äº†ï¼Œå› æ­¤ç°æœ‰æ–‡ä»¶å¤±æ•ˆ\nMemcached ç­‰ç¼“å­˜å­˜å‚¨å™¨ä¼šè‡ªåŠ¨åˆ é™¤æ—§çš„ç¼“å­˜æ–‡ä»¶\nç‰¹å®šæ¡ä»¶ä¸‹ç¼“å­˜ä¸€ä¸ªç‰‡æ®µï¼Œå¯ä»¥ä½¿ç”¨ cache_if æˆ– cache_unless\n\u0026lt;% cache_if admin?, product do %\u0026gt; \u0026lt;%= render product %\u0026gt; \u0026lt;% end %\u0026gt; render è¾…åŠ©æ–¹æ³•è¿˜èƒ½ç¼“å­˜æ¸²æŸ“é›†åˆçš„å•ä¸ªæ¨¡æ¿ã€‚è¿™ç”šè‡³æ¯”ä½¿ç”¨ each çš„å‰è¿°ç¤ºä¾‹æ›´å¥½ï¼Œå› ä¸ºæ˜¯ä¸€æ¬¡æ€§è¯»å–æ‰€æœ‰ç¼“å­˜æ¨¡æ¿çš„ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡è¯»å–ä¸€ä¸ªã€‚è‹¥æƒ³ç¼“å­˜é›†åˆï¼Œæ¸²æŸ“é›†åˆæ—¶ä¼ å…¥ cached: true é€‰é¡¹\n\u0026lt;%= render partial: \u0026#39;products/product\u0026#39;, collection: @products, cached: true %\u0026gt; ä¸Šè¿°ä»£ç ä¸­æ‰€æœ‰çš„ç¼“å­˜æ¨¡æ¿ä¸€æ¬¡æ€§è·å–ï¼Œé€Ÿåº¦æ›´å¿«ã€‚æ­¤å¤–ï¼Œå°šæœªç¼“å­˜çš„æ¨¡æ¿ä¹Ÿä¼šå†™å…¥ç¼“å­˜ï¼Œåœ¨ä¸‹æ¬¡æ¸²æŸ“æ—¶è·å–\nä¿„ç½—æ–¯å¥—å¨ƒç¼“å­˜ # æœ‰æ—¶ï¼Œå¯èƒ½æƒ³æŠŠç¼“å­˜çš„ç‰‡æ®µåµŒå¥—åœ¨å…¶ä»–ç¼“å­˜çš„ç‰‡æ®µé‡Œã€‚è¿™å«ä¿„ç½—æ–¯å¥—å¨ƒç¼“å­˜ï¼ˆRussian doll cachingï¼‰ ä¿„ç½—æ–¯å¥—å¨ƒç¼“å­˜çš„ä¼˜ç‚¹æ˜¯ï¼Œæ›´æ–°å•ä¸ªå•†å“åï¼Œé‡æ–°ç”Ÿæˆå¤–å±‚ç‰‡æ®µæ—¶ï¼Œå…¶ä»–å†…å­˜ç‰‡æ®µå¯ä»¥å¤ç”¨ å‰ä¸€èŠ‚è¯´è¿‡ï¼Œå¦‚æœç¼“å­˜çš„æ–‡ä»¶å¯¹åº”çš„è®°å½•çš„ updated_at å±æ€§å€¼å˜äº†ï¼Œç¼“å­˜çš„æ–‡ä»¶å¤±æ•ˆã€‚ä½†æ˜¯ï¼Œå†…å±‚åµŒå¥—çš„ç‰‡æ®µä¸å¤±æ•ˆ\n\u0026lt;% cache product do %\u0026gt; \u0026lt;%= render product.games %\u0026gt; \u0026lt;% end %\u0026gt; ä¸Šé¢è¿™ä¸ªä¼šæ¸²æŸ“ä¸‹é¢è¿™ä¸ª\n\u0026lt;% cache game do %\u0026gt; \u0026lt;%= render game %\u0026gt; \u0026lt;% end %\u0026gt; å¦‚æœæ¸¸æˆçš„ä»»ä½•ä¸€ä¸ªå±æ€§å˜äº†ï¼Œupdated_at çš„å€¼ä¼šè®¾ä¸ºå½“å‰æ—¶é—´ï¼Œå› æ­¤ç¼“å­˜å¤±æ•ˆã€‚ç„¶è€Œï¼Œå•†å“å¯¹è±¡çš„ updated_at å±æ€§ä¸å˜ï¼Œå› æ­¤å®ƒçš„ç¼“å­˜ä¸å¤±æ•ˆï¼Œä»è€Œå¯¼è‡´åº”ç”¨ä¼ºæœè¿‡æœŸçš„æ•°æ®ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ touch æ–¹æ³•æŠŠæ¨¡å‹ç»‘åœ¨ä¸€èµ·\nclass Product \u0026lt; ApplicationRecord has_many :games end class Game \u0026lt; ApplicationRecord belongs_to :product, touch: true end ç®¡ç†ä¾èµ– # ä¸ºäº†æ­£ç¡®åœ°è®©ç¼“å­˜å¤±æ•ˆï¼Œè¦æ­£ç¡®åœ°å®šä¹‰ç¼“å­˜ä¾èµ–ã€‚Rails è¶³å¤Ÿæ™ºèƒ½ï¼Œèƒ½å¤„ç†å¸¸è§çš„æƒ…å†µï¼Œæ— éœ€è‡ªå·±æŒ‡å®šã€‚ä½†æ˜¯æœ‰æ—¶éœ€è¦å¤„ç†è‡ªå®šä¹‰çš„è¾…åŠ©æ–¹æ³•ï¼ˆä»¥æ­¤ä¸ºä¾‹ï¼‰ï¼Œå› æ­¤è¦è‡ªè¡Œå®šä¹‰\néšå¼ä¾èµ– # å¤šæ•°æ¨¡æ¿ä¾èµ–å¯ä»¥ä»æ¨¡æ¿ä¸­çš„ render è°ƒç”¨ä¸­æ¨å¯¼å‡ºæ¥ã€‚ä¸‹é¢ä¸¾ä¾‹è¯´æ˜ ActionView::Digestor çŸ¥é“å¦‚ä½•è§£ç çš„ render è°ƒç”¨\nrender partial: \u0026#34;comments/comment\u0026#34;, collection: commentable.comments render \u0026#34;comments/comments\u0026#34; render \u0026#39;comments/comments\u0026#39; render(\u0026#39;comments/comments\u0026#39;) render \u0026#34;header\u0026#34; =\u0026gt; render(\u0026#34;comments/header\u0026#34;) render(@topic) # =\u0026gt; render(\u0026#34;topics/topic\u0026#34;) render(topics) # =\u0026gt; render(\u0026#34;topics/topic\u0026#34;) render(message.topics) # =\u0026gt; render(\u0026#34;topics/topic\u0026#34;) è€Œå¦ä¸€æ–¹é¢ï¼Œæœ‰äº›è°ƒç”¨è¦åšä¿®æ”¹æ–¹èƒ½è®©ç¼“å­˜æ­£ç¡®å·¥ä½œã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¼ å…¥è‡ªå®šä¹‰çš„é›†åˆï¼Œè¦æŠŠä¸‹è¿°ä»£ç ï¼š\nrender @project.documents.where(published: true) æ”¹ä¸º\nrender partial: \u0026#34;documents/document\u0026#34;, collection: @project.documents.where(published: true) æ˜¾å¼ä¾èµ– # æœ‰æ—¶ï¼Œæ¨¡æ¿ä¾èµ–æ¨å¯¼ä¸å‡ºæ¥ã€‚åœ¨è¾…åŠ©æ–¹æ³•ä¸­æ¸²æŸ“æ—¶ç»å¸¸æ˜¯è¿™æ ·\n\u0026lt;%= render_sortable_todolists @project.todolists %\u0026gt; æ­¤æ—¶ï¼Œè¦ä½¿ç”¨ä¸€ç§ç‰¹æ®Šçš„æ³¨é‡Šæ ¼å¼ï¼š\n\u0026lt;%# Template Dependency: todolists/todolist %\u0026gt; \u0026lt;%= render_sortable_todolists @project.todolists %\u0026gt; æŸäº›æƒ…å†µä¸‹ï¼Œä¾‹å¦‚è®¾ç½®å•è¡¨ç»§æ‰¿ï¼Œå¯èƒ½è¦æ˜¾å¼å®šä¹‰ä¸€å †ä¾èµ–ã€‚æ­¤æ—¶æ— éœ€å†™å‡ºæ¯ä¸ªæ¨¡æ¿ï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦åŒ¹é…ä¸€ä¸ªç›®å½•ä¸­çš„å…¨éƒ¨æ¨¡æ¿ï¼š\n\u0026lt;%# Template Dependency: events/* %\u0026gt; \u0026lt;%= render_categorizable_events @person.events %\u0026gt; å¯¹é›†åˆç¼“å­˜æ¥è¯´ï¼Œå¦‚æœå±€éƒ¨æ¨¡æ¿ä¸æ˜¯ä»¥å¹²å‡€çš„ç¼“å­˜è°ƒç”¨å¼€å¤´ï¼Œä¾ç„¶å¯ä»¥ä½¿ç”¨é›†åˆç¼“å­˜ï¼Œä¸è¿‡è¦åœ¨æ¨¡æ¿ä¸­çš„ä»»æ„ä½ç½®æ·»åŠ ä¸€ç§æ ¼å¼ç‰¹æ®Šçš„æ³¨é‡Šï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\u0026lt;%# Template Collection: notification %\u0026gt; \u0026lt;% my_helper_that_calls_cache(some_arg, notification) do %\u0026gt; \u0026lt;%= notification.name %\u0026gt; \u0026lt;% end %\u0026gt; å¤–éƒ¨ä¾èµ– # å¦‚æœåœ¨ç¼“å­˜çš„å—ä¸­ä½¿ç”¨è¾…åŠ©æ–¹æ³•ï¼Œè€Œåæ›´æ–°äº†è¾…åŠ©æ–¹æ³•ï¼Œè¿˜è¦æ›´æ–°ç¼“å­˜ã€‚å…·ä½“æ–¹æ³•ä¸é™ï¼Œåªè¦èƒ½æ”¹å˜æ¨¡æ¿æ–‡ä»¶çš„ MD5 å€¼å°±è¡Œã€‚æ¨èçš„æ–¹æ³•ä¹‹ä¸€æ˜¯æ·»åŠ ä¸€ä¸ªæ³¨é‡Šï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\u0026lt;%# Helper Dependency Updated: Jul 28, 2015 at 7pm %\u0026gt; \u0026lt;%= some_helper_method(person) %\u0026gt; ä½å±‚ç¼“å­˜ # æœ‰æ—¶éœ€è¦ç¼“å­˜ç‰¹å®šçš„å€¼æˆ–æŸ¥è¯¢ç»“æœï¼Œè€Œä¸æ˜¯ç¼“å­˜è§†å›¾ç‰‡æ®µã€‚Rails çš„ç¼“å­˜æœºåˆ¶èƒ½å­˜å‚¨ä»»ä½•ç±»å‹çš„ä¿¡æ¯ã€‚\nå®ç°ä½å±‚ç¼“å­˜æœ€æœ‰æ•ˆçš„æ–¹å¼æ˜¯ä½¿ç”¨ Rails.cache.fetch æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ—¢èƒ½è¯»å–ä¹Ÿèƒ½å†™å…¥ç¼“å­˜ã€‚ä¼ å…¥å•ä¸ªå‚æ•°æ—¶ï¼Œè·å–æŒ‡å®šçš„é”®ï¼Œè¿”å›ç¼“å­˜ä¸­çš„å€¼ã€‚å¦‚æœä¼ å…¥å—ï¼Œå—ä¸­çš„ä»£ç åœ¨ç¼“å­˜ç¼ºå¤±æ—¶æ‰§è¡Œã€‚å—è¿”å›çš„å€¼å°†å†™å…¥ç¼“å­˜ï¼Œå­˜åœ¨æŒ‡å®šé”®çš„åä¸‹ï¼Œç„¶åè¿”å›é‚£ä¸ªè¿”å›å€¼ã€‚å¦‚æœå‘½ä¸­ç¼“å­˜ï¼Œç›´æ¥è¿”å›ç¼“å­˜çš„å€¼ï¼Œè€Œä¸æ‰§è¡Œå—ä¸­çš„ä»£ç ã€‚\nä¸‹é¢ä¸¾ä¸ªä¾‹å­ã€‚åº”ç”¨ä¸­æœ‰ä¸ª Product æ¨¡å‹ï¼Œå®ƒæœ‰ä¸ªå®ä¾‹æ–¹æ³•ï¼Œåœ¨ç«äº‰ç½‘ç«™ä¸­æŸ¥æ‰¾å•†å“çš„ä»·æ ¼ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›çš„æ•°æ®ç‰¹åˆ«é€‚åˆä½¿ç”¨ä½å±‚ç¼“å­˜ï¼š\nclass Product \u0026lt; ApplicationRecord def competing_price Rails.cache.fetch(\u0026#34;#{cache_key}/competing_price\u0026#34;, expires_in: 12.hours) do Competitor::API.find_price(id) end end end æ³¨æ„ï¼Œè¿™ä¸ªç¤ºä¾‹ä½¿ç”¨äº† cache_key æ–¹æ³•ï¼Œå› æ­¤å¾—åˆ°çš„ç¼“å­˜é”®ç±»ä¼¼è¿™ç§ï¼šproducts/233-20140225082222765838000/competing_priceã€‚cache_key æ–¹æ³•æ ¹æ®æ¨¡å‹çš„ id å’Œ updated_at å±æ€§ç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚è¿™æ˜¯å¸¸è§çš„çº¦å®šï¼Œæœ‰ä¸ªå¥½å¤„æ˜¯ï¼Œå•†å“æ›´æ–°åç¼“å­˜è‡ªåŠ¨å¤±æ•ˆã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨ä½å±‚ç¼“å­˜ç¼“å­˜å®ä¾‹å±‚ä¿¡æ¯æ—¶ï¼Œéœ€è¦ç”Ÿæˆç¼“å­˜é”®ã€‚\nSQL ç¼“å­˜ # æŸ¥è¯¢ç¼“å­˜æ˜¯ Rails æä¾›çš„ä¸€ä¸ªåŠŸèƒ½ï¼ŒæŠŠå„ä¸ªæŸ¥è¯¢çš„ç»“æœé›†ç¼“å­˜èµ·æ¥ã€‚å¦‚æœåœ¨åŒä¸€ä¸ªè¯·æ±‚ä¸­é‡åˆ°äº†ç›¸åŒçš„æŸ¥è¯¢ï¼ŒRails ä¼šä½¿ç”¨ç¼“å­˜çš„ç»“æœé›†ï¼Œè€Œä¸å†æ¬¡åˆ°æ•°æ®åº“ä¸­è¿è¡ŒæŸ¥è¯¢ã€‚\nä¾‹å¦‚ï¼š\nclass ProductsController \u0026lt; ApplicationController def index # è¿è¡ŒæŸ¥æ‰¾æŸ¥è¯¢ @products = Product.all ... # å†æ¬¡è¿è¡Œç›¸åŒçš„æŸ¥è¯¢ @products = Product.all end end å†æ¬¡è¿è¡Œç›¸åŒçš„æŸ¥è¯¢æ—¶ï¼Œæ ¹æœ¬ä¸ä¼šå‘ç»™æ•°æ®åº“ã€‚é¦–æ¬¡è¿è¡ŒæŸ¥è¯¢å¾—åˆ°çš„ç»“æœå­˜å‚¨åœ¨æŸ¥è¯¢ç¼“å­˜ä¸­ï¼ˆå†…å­˜é‡Œï¼‰ï¼Œç¬¬äºŒæ¬¡æŸ¥è¯¢ä»å†…å­˜ä¸­è·å–ã€‚\nç„¶è€Œè¦çŸ¥é“ï¼ŒæŸ¥è¯¢ç¼“å­˜åœ¨åŠ¨ä½œå¼€å¤´åˆ›å»ºï¼Œåˆ°åŠ¨ä½œæœ«å°¾é”€æ¯ï¼Œåªåœ¨åŠ¨ä½œçš„å­˜ç»­æ—¶é—´å†…å­˜åœ¨ã€‚å¦‚æœæƒ³æŒä¹…åŒ–å­˜å‚¨æŸ¥è¯¢ç»“æœï¼Œä½¿ç”¨ä½å±‚ç¼“å­˜ä¹Ÿèƒ½å®ç°\n","date":"2018å¹´09æœˆ25æ—¥","externalUrl":null,"permalink":"/posts/rails%E7%89%87%E6%AE%B5%E7%BC%93%E5%AD%98%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BC%93%E5%AD%98/","section":"Posts","summary":"","title":"Railsç‰‡æ®µç¼“å­˜ä»¥åŠå…¶ä»–ç¼“å­˜","type":"posts"},{"content":" åŠ¨ä½œç¼“å­˜ # æœ‰å‰ç½®è¿‡æ»¤å™¨çš„åŠ¨ä½œä¸èƒ½ä½¿ç”¨é¡µé¢ç¼“å­˜ï¼Œä¾‹å¦‚éœ€è¦éªŒè¯èº«ä»½çš„é¡µé¢ã€‚æ­¤æ—¶ï¼Œåº”è¯¥ä½¿ç”¨åŠ¨ä½œç¼“å­˜ã€‚åŠ¨ä½œç¼“å­˜çš„å·¥ä½œåŸç†ä¸é¡µé¢ç¼“å­˜ç±»ä¼¼ï¼Œä¸è¿‡å…¥ç«™è¯·æ±‚ä¼šç»è¿‡ Rails æ ˆå¤„ç†ï¼Œä»¥ä¾¿è¿è¡Œå‰ç½®è¿‡æ»¤å™¨ï¼Œç„¶åå†ä¼ºæœç¼“å­˜ã€‚è¿™æ ·ï¼Œå¯ä»¥åšèº«ä»½éªŒè¯å’Œå…¶ä»–é™åˆ¶ï¼ŒåŒæ—¶è¿˜èƒ½ä»ç¼“å­˜çš„å‰¯æœ¬ä¸­ä¼ºæœç»“æœã€‚\nåŠ¨ä½œç¼“å­˜å·²ä»Rails 4ä¸­åˆ é™¤\nåŠ¨ä½œç¼“å­˜actionpack-action_cachingçš„åœ°å€ å®‰è£… # åœ¨Railsé¡¹ç›®ä¸­çš„Gemfileæ–‡ä»¶ä¸­æ·»åŠ \ngem \u0026#39;actionpack-action_caching\u0026#39; ç„¶åæ‰§è¡Œbundle installå‘½ä»¤å®‰è£…\nä½¿ç”¨ # è¯¦ç»†ä»‹ç»æŸ¥çœ‹åŠ¨ä½œç¼“å­˜actionpack-action_caching class ListsController \u0026lt; ApplicationController before_action :authenticate, except: :public caches_page :public caches_action :index, :show end class ListsController \u0026lt; ApplicationController before_action :authenticate, except: :public # simple fragment cache caches_action :current # expire cache after an hour caches_action :archived, expires_in: 1.hour # cache unless it\u0026#39;s a JSON request caches_action :index, unless: -\u0026gt; { request.format.json? } # custom cache path caches_action :show, cache_path: { project: 1 } # custom cache path with a proc caches_action :history, cache_path: -\u0026gt; { request.domain } # custom cache path with a symbol caches_action :feed, cache_path: :user_cache_path protected def user_cache_path if params[:user_id] user_list_url(params[:user_id], params[:id]) else list_url(params[:id]) end end end ","date":"2018å¹´09æœˆ24æ—¥","externalUrl":null,"permalink":"/posts/rails%E5%8A%A8%E4%BD%9C%E7%BC%93%E5%AD%98/","section":"Posts","summary":"","title":"RailsåŠ¨ä½œç¼“å­˜","type":"posts"},{"content":" é¡µé¢ç¼“å­˜ # é¡µé¢ç¼“å­˜æ˜¯ Rails æä¾›çš„ä¸€ç§ç¼“å­˜æœºåˆ¶ï¼Œè®© Web æœåŠ¡å™¨ï¼ˆå¦‚ Apache å’Œ NGINXï¼‰ç›´æ¥è®¿é—®é™æ€é¡µé¢ï¼Œè€Œä¸ç»ç”± Rails åŠ¨æ€ç”Ÿæˆã€‚è™½ç„¶è¿™ç§ç¼“å­˜çš„é€Ÿåº¦è¶…å¿«ï¼Œä½†æ˜¯ä¸é€‚ç”¨äºæ‰€æœ‰æƒ…å†µï¼ˆä¾‹å¦‚éœ€è¦éªŒè¯èº«ä»½çš„é¡µé¢ï¼‰ã€‚æ­¤å¤–ï¼Œå› ä¸º Web æœåŠ¡å™¨ç›´æ¥ä»æ–‡ä»¶ç³»ç»Ÿä¸­è®¿é—®æ–‡ä»¶ï¼Œæ‰€ä»¥è¦è‡ªè¡Œå®ç°ç¼“å­˜å¤±æ•ˆæœºåˆ¶\né¡µé¢ç¼“å­˜å·²ä»Rails 4ä¸­åˆ é™¤\né¡µé¢ç¼“å­˜actionpack-page_cachingçš„åœ°å€ å®‰è£… # åœ¨Railsé¡¹ç›®ä¸­çš„Gemfileæ–‡ä»¶ä¸­æ·»åŠ \ngem \u0026#39;actionpack-page_caching\u0026#39; ç„¶åæ‰§è¡Œbundle installå‘½ä»¤å®‰è£…\nè®¾ç½® # è®¾ç½®ç¼“å­˜æ–‡ä»¶å­˜æ”¾ä½ç½®page_cache_directory\nconfig.action_controller.page_cache_directory = \u0026#34;#{Rails.root}/public/cached_paâ€‹â€‹ges\u0026#34; ä¹Ÿå¯ä»¥ç»™Controllerå•ç‹¬è®¾ç½®ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸‰ç§æ–¹å¼\næŒ‡å‘ä¸€ä¸ªlambdaè¡¨è¾¾å¼ï¼Œè¿è¡Œæ—¶ä¼šè‡ªåŠ¨è°ƒç”¨lambdaçš„callæ–¹æ³•\nclass WeblogController \u0026lt; ApplicationController self.page_cache_directory = -\u0026gt; { Rails.root.join(\u0026#34;public\u0026#34;, request.domain) } end ä¹Ÿå¯æŒ‡å‘ä¸€ä¸ªæ–¹æ³•çš„symbolå\nclass WeblogController \u0026lt; ApplicationController self.page_cache_directory = :domain_cache_directory private def domain_cache_directory Rails.root.join(\u0026#34;public\u0026#34;, request.domain) end end ä¹Ÿå¯ä»¥æŒ‡å‘å®ç°callç±»æ–¹æ³•çš„å¯¹è±¡\nclass DomainCacheDirectory def self.call(request) Rails.root.join(\u0026#34;public\u0026#34;, request.domain) end end class WeblogController \u0026lt; ApplicationController self.page_cache_directory = DomainCacheDirectory end ä½¿ç”¨ # è®¾ç½® # class WeblogController \u0026lt; ActionController::Base caches_page :show, :new # è®¾ç½®newå’Œshowé¡µé¢ç¼“å­˜ # ç”Ÿæˆpublic/cached_paâ€‹â€‹ges/weblog/new.html def new @list = List.new end # ç”Ÿæˆpublic/cached_paâ€‹â€‹ges/weblog/:id.html def show @list = List.find(params[:id]) end end æ›´æ–°é¡µé¢ç¼“å­˜ # æ•°æ®æ›´æ–°åï¼Œå°†å·²ç”Ÿæˆçš„é¡µé¢ç¼“å­˜è¿‡æœŸ\nclass WeblogController \u0026lt; ActionController::Base def update List.update(params[:list][:id], params[:list]) # è®¾ç½®public/cached_paâ€‹â€‹ges/weblog/:id.htmlå·²è¿‡æœŸ expire_page action: \u0026#39;show\u0026#39;, id: params[:list][:id] # è·³è½¬åˆ°showï¼Œç”Ÿæˆæ–°çš„public/cached_paâ€‹â€‹ges/weblog/:id.html redirect_to action: \u0026#39;show\u0026#39;, id: params[:list][:id] end end Nginxé…ç½® # å¦‚æœé¡µé¢ç¼“å­˜æ–‡ä»¶å­˜åœ¨ï¼Œå°†é¡µé¢ç¼“å­˜ä½œä¸ºå“åº”å†…å®¹è¿”å›\n# Index HTML Files if (-f $document_root/cached_paâ€‹â€‹ges/$uri/index.html) { rewrite (.*) /cached_paâ€‹â€‹ges/$1/index.html break; } # Other HTML Files if (-f $document_root/cached_paâ€‹â€‹ges/$uri.html) { rewrite (.*) /cached_paâ€‹â€‹ges/$1.html break; } # All if (-f $document_root/cached_paâ€‹â€‹ges/$uri) { rewrite (.*) /cached_paâ€‹â€‹ges/$1 break; } ","date":"2018å¹´09æœˆ23æ—¥","externalUrl":null,"permalink":"/posts/rails%E9%A1%B5%E9%9D%A2%E7%BC%93%E5%AD%98/","section":"Posts","summary":"","title":"Railsé¡µé¢ç¼“å­˜","type":"posts"},{"content":"","date":"2018å¹´09æœˆ22æ—¥","externalUrl":null,"permalink":"/tags/gogs/","section":"Tags","summary":"","title":"Gogs","type":"tags"},{"content":"","date":"2018å¹´09æœˆ22æ—¥","externalUrl":null,"permalink":"/tags/%E9%83%A8%E7%BD%B2/","section":"Tags","summary":"","title":"éƒ¨ç½²","type":"tags"},{"content":" Gogs æ˜¯ä¸€æ¬¾ææ˜“æ­å»ºçš„è‡ªåŠ© Git æœåŠ¡ã€‚\nä¸ºä»€ä¹ˆé€‰æ‹©Gogs # æˆ‘ä¹‹å‰ä¹Ÿéƒ¨ç½²è¿‡Gitlabï¼Œä½†æ˜¯å¤ªåƒèµ„æºäº†ï¼ŒGogsç›¸æ¯”å°±å¾ˆè½»é‡ï¼Œæ­£å¥½åˆé€‚æ­å»ºç§äººGitæœåŠ¡å™¨ã€‚\nå®‰è£…Nginxå’Œæ•°æ®åº“ # è¦éƒ¨ç½²Gogsï¼Œéœ€è¦å®‰è£…Nginxå’Œæ•°æ®åº“\nå®‰è£…Nginx\nsudo apt-get update sudo apt-get install nginx å®‰è£…å’Œåˆå§‹åŒ–æ•°æ®åº“ # Gogsæ”¯æŒMySQLï¼ŒPostgreSQLï¼ŒSQLite3ï¼ŒMSSQLå’ŒTiDBï¼Œè¿™é‡Œæˆ‘é€‰æ‹©PostgreSQL\nsudo apt-get update sudo apt-get install postgresql å‘½ä»¤æ‰§è¡Œå®Œæ¯•åï¼Œé…ç½®æ•°æ®åº“\nè®¾ç½®å¯†ç  # å®‰è£…å®Œæ¯•åéœ€è¦æ›´æ”¹postgresç”¨æˆ·çš„å¯†ç ï¼Œå¦åˆ™å°±æ²¡æ³•ä½¿ç”¨è¿™ä¸ªæ•°æ®åº“æœåŠ¡å™¨ã€‚ä»¥postgresè¿™ä¸ªç³»ç»Ÿç”¨æˆ·çš„èº«ä»½è¿è¡Œpsqlå‘½ä»¤\nsudo -u postgres psql è¿›å…¥psqlå‘½ä»¤æ¥å£\nALTER USER postgres WITH PASSWORD \u0026#39;è¿™é‡Œå†™postgresç”¨æˆ·çš„æ–°å¯†ç \u0026#39;; æ‰§è¡Œå®Œæ¯•åï¼Œ\\qé€€å‡º\nåˆ›å»ºPostgreSQLçš„æ–°ç”¨æˆ·å’Œæ•°æ®åº“ # # -D æ²¡æœ‰åˆ›å»ºæ•°æ®åº“çš„æƒé™ # -A æ²¡æœ‰æ–°å»ºç”¨æˆ·çš„æƒé™ # -P ä¸ºæ–°ç”¨æˆ·è®¾ç½®å¯†ç  sudo -u postgres createuser -D -A -P gogs # åˆ›å»ºç”¨æˆ·æ—¶ä¼šæç¤ºä½ è¾“å…¥å¯†ç  # åˆ›å»ºä¸€ä¸ªæ•°æ®åº“gogs-dbï¼Œä»¥ gogs ä½œä¸ºå®ƒçš„æ‰€æœ‰è€… sudo -u postgres createdb -O gogs gogs-db å®‰è£…Gogs # åˆ›å»ºæ–°ç”¨æˆ· # ä¸ºä»€ä¹ˆåˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·å‘¢ï¼Ÿä¹‹å‰æˆ‘ä¹Ÿä¸€ç›´åœ¨çº ç»“ã€‚åæ¥ï¼Œå‘ç”Ÿäº†å¯†é’¥å†²çªï¼Œè¿™ä¸ªå°±æ˜¯å› ä¸ºç®¡ç†å‘˜å¯†é’¥æœˆGogsè¿è¡Œåº”ç”¨çš„ç”¨æˆ·å¯†é’¥ä¸€æ ·æ‰€å¯¼è‡´çš„ï¼Œå¦‚æœGogsè¿è¡Œåº”ç”¨çš„ç”¨æˆ·ä¸æ˜¯ç®¡ç†å‘˜ä¹Ÿå°±ä¸ä¼šæœ‰è¿™ä¸ªæƒ…å†µäº†\nuseradd -m git # åˆ‡æ¢åˆ°gitç”¨æˆ· sudo su git # åˆ‡æ¢åˆ°gitç”¨æˆ·çš„HOMEç›®å½• cd ~ ä¸‹é¢æ“ä½œéƒ½æ˜¯åœ¨gitç”¨æˆ·ä¸‹æ“ä½œ\nä¸‹è½½Gogsç¨‹åº # æˆ‘ä½¿ç”¨çš„æ˜¯GogsäºŒè¿›åˆ¶å®‰è£…åŒ… ï¼Œä¸‹è½½çš„æ˜¯Linuxï¼Œ64ä½ï¼ŒTAR.GZï¼Œå¯ä»¥ç”¨curlæˆ–è€…wgetä¸‹è½½æ–‡ä»¶\nç¤ºä¾‹\n# ä½¿ç”¨curl curl -O https://dl.gogs.io/0.11.66/gogs_0.11.66_linux_amd64.tar.gz # ä½¿ç”¨ wget wget https://dl.gogs.io/0.11.66/gogs_0.11.66_linux_amd64.tar.gz è§£å‹\ntar -zxvf gogs_0.11.66_linux_amd64.tar.gz å¯åŠ¨GogsæœåŠ¡ # cd gogs ./gogs web ç„¶åå†æµè§ˆå™¨è¾“å…¥IP:3000ï¼Œç«¯å£å·é»˜è®¤æ˜¯3000ï¼Œè¿™ä¸ªæ—¶å€™è¿›å…¥åº”è¯¥è¿›å…¥çš„æ˜¯/installï¼Œå…·ä½“å°±æ˜¯ä¸€äº›Gogsç¨‹åºçš„åŸºæœ¬è®¾ç½®ï¼Œå¡«å®Œæäº¤åï¼Œè¿›å…¥å‘½ä»¤è¡ŒæŒ‰ctl+cç»“æŸç¨‹åºï¼Œå°±å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥äº†\nGogså®ˆæŠ¤è¿›ç¨‹ # è¿™éƒ¨åˆ†ä¸»è¦ä¿®æ”¹Gogsé¡¹ç›®ä¸­çš„scriptsé‡Œçš„æ–‡ä»¶ï¼Œä»¥ä¸‹æ–‡ä»¶è¯·æ ¹æ®å®é™…æƒ…å†µåšä¿®æ”¹\nvim scripts/init/debian/gogs #! /bin/sh ### BEGIN INIT INFO # Provides: gogs # Required-Start: $syslog $network # Required-Stop: $syslog # Should-Start: mysql postgresql # Should-Stop: mysql postgresql # Default-Start: 2 3 4 5 # Default-Stop: 0 1 6 # Short-Description: A self-hosted Git service written in Go. # Description: A self-hosted Git service written in Go. ### END INIT INFO # Author: Danny Boisvert # Do NOT \u0026#34;set -e\u0026#34; # PATH should only include /usr/* if it runs after the mountnfs.sh script PATH=/sbin:/usr/sbin:/bin:/usr/bin DESC=\u0026#34;Gogs\u0026#34; NAME=gogs SERVICEVERBOSE=yes PIDFILE=/var/run/$NAME.pid SCRIPTNAME=/etc/init.d/$NAME WORKINGDIR=/home/git/gogs # è¿™æ˜¯Gogsè¿è¡Œåº”ç”¨çš„é¡¹ç›®è·¯å¾„ DAEMON=$WORKINGDIR/$NAME DAEMON_ARGS=\u0026#34;web\u0026#34; USER=git # è¿™æ˜¯Gogsè¿è¡Œåº”ç”¨çš„ç”¨æˆ· # ä»¥ä¸‹ä¸åšä¿®æ”¹ ç„¶åé€€å‡ºï¼Œæ¥ç€ä¿®æ”¹ä¸‹ä¸€ä¸ªæ–‡ä»¶\nvim scripts/systemd/gogs.service [Unit] Description=Gogs After=syslog.target After=network.target # ä¿®æ”¹è¿™é‡Œï¼Œå¦‚æœç”¨åˆ°å…¶ä»–æœåŠ¡çš„è¯ # After=mariadb.service mysqld.service postgresql.service memcached.service redis.service # æˆ‘è¿™åªç”¨åˆ°äº†postgresql After=postgresql.service [Service] Type=simple User=git # è¿™æ˜¯Gogsè¿è¡Œåº”ç”¨çš„ç”¨æˆ· Group=git # è¯¥ç”¨æˆ·çš„ç»„ WorkingDirectory=/home/git/gogs # è¿™æ˜¯Gogsè¿è¡Œåº”ç”¨çš„é¡¹ç›®è·¯å¾„ # /home/git/gogs/gogsè¿™æ˜¯Gogsè¿è¡Œåº”ç”¨ç¨‹åºçš„ä½ç½® ExecStart=/home/git/gogs/gogs web Restart=always # Environment=USERåæ˜¯Gogsè¿è¡Œåº”ç”¨çš„ç”¨æˆ· # HOMEæ˜¯è¯¥ç”¨æˆ·çš„HOMEè·¯å¾„ Environment=USER=git HOME=/home/git # ä»¥ä¸‹ä¸åšä¿®æ”¹ ä¿®æ”¹å®Œä¹‹åï¼Œè½¯è¿æ¥æ–‡ä»¶åˆ°ç›¸åº”ä½ç½®\n# é€€å‡ºgitç”¨æˆ·ï¼Œåˆ‡åˆ°ç®¡ç†å‘˜ exit sudo ln -s /home/git/gogs/scripts/init/debian/gogs /etc/init.d/gogs sudo ln -s /home/git/gogs/scripts/systemd/gogs.service /etc/systemd/system/gogs.service ç„¶åå°±å¯ä»¥ä½¿ç”¨serviceå‘½ä»¤æ¥ç®¡ç†Gogsçš„æœåŠ¡çŠ¶æ€äº†\n# ä¾‹å¦‚ï¼Œå¯åŠ¨gogsæœåŠ¡ sudo service gogs start Nginxåå‘ä»£ç†GogsæœåŠ¡ # åªéœ€è¦åœ¨Nginxé…ç½®é‡Œæ–°å¼•å…¥ä¸€ä¸ªserverå°±å¯ä»¥äº†\nserver { listen 80; # ç«¯å£å· server_name gogs.example.com; # åŸŸå location / { proxy_pass http://localhost:3000; # Gogs æœåŠ¡åœ°å€ } } æ·»åŠ å®Œåï¼Œæ‰§è¡Œsudo nginx -tæŸ¥çœ‹æ˜¯å¦æœ‰è¯¯ï¼Œç„¶åä½¿ç”¨sudo nginx -s reloadé‡è½½Nginxï¼Œå°±å¯ä»¥äº†\n","date":"2018å¹´09æœˆ22æ—¥","externalUrl":null,"permalink":"/posts/%E5%9C%A8ubuntu%E4%B8%8A%E9%83%A8%E7%BD%B2gogs/","section":"Posts","summary":"","title":"åœ¨Ubuntuä¸Šéƒ¨ç½²Gogs","type":"posts"},{"content":" é”™è¯¯æè¿°ï¼šfatal: 'XX/XX.git' does not appear to be a git repository\né—®é¢˜ # éƒ¨ç½²å®ŒGogsåï¼Œåœ¨Webé¡µé¢åˆ›å»ºå¥½ä»“åº“åï¼Œæœ¬åœ°å‘è¿œç¨‹æ¨é€å‡ºç°æ— æ³•è¯»å–è¿œç¨‹ä»“åº“çš„é—®é¢˜ï¼Œå¯èƒ½åŸå› ï¼š~/.ssh/authorized_keys æ–‡ä»¶ä¸­å­˜åœ¨é‡å¤çš„ SSH å¯†é’¥ï¼Œæ‰€ä»¥å…¬é’¥ä½¿ç”¨å†²çª äº†\nè§£å†³æ–¹æ¡ˆ # åˆ é™¤~/.ssh/authorized_keysæ–‡ä»¶é‡Œé™¤äº†å±äº Gogs è‡ªåŠ¨æ·»åŠ ä»¥å¤–çš„é‡å¤å¯†é’¥ï¼Œè¿™æ ·å°±å¯ä»¥æ­£å¸¸äº†\næ–°çš„é—®é¢˜ # ä½†æ˜¯è¿™æ ·åˆå‡ºç°äº†ä¸ªæ–°çš„é—®é¢˜ï¼Œå°±æ˜¯æˆ‘ç”¨sshç™»ä¸ä¸Šæˆ‘çš„è¿œç¨‹æœåŠ¡å™¨äº†ï¼ŒåŸæ¥åˆšåˆšåˆ é™¤çš„é‚£ä¸ªç§˜é’¥æ˜¯sshè¿œç¨‹ç™»å½•å¯†é’¥ï¼Œè¿™æ ·å¯ä¸è¡Œçš„å‘€\næ–°çš„æ–¹æ¡ˆ # é¢å¤–å†ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯†é’¥id_rsa_gogs\nssh-keygen -t rsa -C \u0026#39;é‚®ç®±æˆ–è€…å…¶ä»–æ ‡è¯†\u0026#39; -f ~/.ssh/id_rsa_gogs å†åœ¨æœ¬åœ°æ–°å»ºï¼ˆå¦‚æœå­˜åœ¨å°±ä¿®æ”¹ï¼‰~/.ssh/configæ·»åŠ ä»¥ä¸‹å†…å®¹\nHost gogs HostName example.com # IPåœ°å€æˆ–è€…åŸŸå Port 222 # sshç«¯å£å· User git # è¿œç¨‹æœåŠ¡å™¨çš„ç”¨æˆ·å IdentityFile ~/.ssh/id_rsa_gogs # åˆšæ‰ç”Ÿæˆçš„å¯†é’¥çš„è·¯å¾„ IdentitiesOnly Yes # åªä½¿ç”¨è¿™é‡Œè®¾ç½®çš„key ç„¶åå°±å¯ä»¥ä½¿ç”¨gogsè¿™ä¸ªåˆ«åæ¥ä»£æ›¿user@host:222äº†\n# ä»¥å‰ä»“åº“åœ°å€ä¸º user@host:222/repositories-path/xxx.git # æ”¹ä¸ºç°åœ¨çš„åœ°å€ gogs:/repositories-path/xxx.git è¿™æ ·å°±OKäº†ï¼Œçœ‹çœ‹å…¶ä»–æ–¹æ¡ˆ ","date":"2018å¹´09æœˆ21æ—¥","externalUrl":null,"permalink":"/posts/gogs%E6%97%A0%E6%B3%95%E8%AF%BB%E5%8F%96%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93fatal-xx-xx-git-does-not-appear-to-be-a-git-repository/","section":"Posts","summary":"","title":"Gogsæ— æ³•è¯»å–è¿œç¨‹ä»“åº“ï¼ˆfatal: XX/XX.git does not appear to be a git repositoryï¼‰","type":"posts"},{"content":"","date":"2018å¹´09æœˆ20æ—¥","externalUrl":null,"permalink":"/tags/git/","section":"Tags","summary":"","title":"Git","type":"tags"},{"content":"åŸåœ°å€åœ¨è¿™é‡Œï¼šè‡ªå®šä¹‰-Git-Git-é’©å­ Gité’©å­ # Git èƒ½åœ¨ç‰¹å®šçš„é‡è¦åŠ¨ä½œå‘ç”Ÿæ—¶è§¦å‘è‡ªå®šä¹‰è„šæœ¬ã€‚ æœ‰ä¸¤ç»„è¿™æ ·çš„é’©å­ï¼šå®¢æˆ·ç«¯çš„å’ŒæœåŠ¡å™¨ç«¯çš„ã€‚ å®¢æˆ·ç«¯é’©å­ç”±è¯¸å¦‚æäº¤å’Œåˆå¹¶è¿™æ ·çš„æ“ä½œæ‰€è°ƒç”¨ï¼Œè€ŒæœåŠ¡å™¨ç«¯é’©å­ä½œç”¨äºè¯¸å¦‚æ¥æ”¶è¢«æ¨é€çš„æäº¤è¿™æ ·çš„è”ç½‘æ“ä½œ\nGité’©å­åœ¨å“ª? # é’©å­éƒ½è¢«å­˜å‚¨åœ¨ Git ç›®å½•ä¸‹çš„ hooks å­ç›®å½•ä¸­ã€‚ ä¹Ÿå³ç»å¤§éƒ¨åˆ†é¡¹ç›®ä¸­çš„ .git/hooks ã€‚ å½“ä½ ç”¨ git init åˆå§‹åŒ–ä¸€ä¸ªæ–°ç‰ˆæœ¬åº“æ—¶ï¼ŒGit é»˜è®¤ä¼šåœ¨è¿™ä¸ªç›®å½•ä¸­æ”¾ç½®ä¸€äº›ç¤ºä¾‹è„šæœ¬ã€‚è¿™äº›è„šæœ¬é™¤äº†æœ¬èº«å¯ä»¥è¢«è°ƒç”¨å¤–ï¼Œå®ƒä»¬è¿˜é€éœ²äº†è¢«è§¦å‘æ—¶æ‰€ä¼ å…¥çš„å‚æ•°ã€‚ æ‰€æœ‰çš„ç¤ºä¾‹éƒ½æ˜¯ shell è„šæœ¬ï¼Œå…¶ä¸­ä¸€äº›è¿˜æ··æ‚äº† Perl ä»£ç ï¼Œä¸è¿‡ï¼Œä»»ä½•æ­£ç¡®å‘½åçš„å¯æ‰§è¡Œè„šæœ¬éƒ½å¯ä»¥æ­£å¸¸ä½¿ç”¨ â€”â€” ä½ å¯ä»¥ç”¨ Ruby æˆ– Pythonï¼Œæˆ–å…¶å®ƒè¯­è¨€ç¼–å†™å®ƒä»¬ã€‚ è¿™äº›ç¤ºä¾‹çš„åå­—éƒ½æ˜¯ä»¥ .sample ç»“å°¾ï¼Œå¦‚æœä½ æƒ³å¯ç”¨å®ƒä»¬ï¼Œå¾—å…ˆç§»é™¤è¿™ä¸ªåç¼€ã€‚\næŠŠä¸€ä¸ªæ­£ç¡®å‘½åä¸”å¯æ‰§è¡Œçš„æ–‡ä»¶æ”¾å…¥ Git ç›®å½•ä¸‹çš„ hooks å­ç›®å½•ä¸­ï¼Œå³å¯æ¿€æ´»è¯¥é’©å­è„šæœ¬ã€‚ è¿™æ ·ä¸€æ¥ï¼Œå®ƒå°±èƒ½è¢« Git è°ƒç”¨\nå®¢æˆ·ç«¯é’©å­ # æäº¤å·¥ä½œæµé’©å­ã€ç”µå­é‚®ä»¶å·¥ä½œæµé’©å­å’Œå…¶å®ƒé’©å­\npre-commit # é’©å­åœ¨é”®å…¥æäº¤ä¿¡æ¯å‰è¿è¡Œã€‚ å®ƒç”¨äºæ£€æŸ¥å³å°†æäº¤çš„å¿«ç…§ï¼Œä¾‹å¦‚ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ‰€é—æ¼ï¼Œç¡®ä¿æµ‹è¯•è¿è¡Œï¼Œä»¥åŠæ ¸æŸ¥ä»£ç ã€‚ å¦‚æœè¯¥é’©å­ä»¥éé›¶å€¼é€€å‡ºï¼ŒGit å°†æ”¾å¼ƒæ­¤æ¬¡æäº¤ï¼Œä¸è¿‡ä½ å¯ä»¥ç”¨ git commit \u0026ndash;no-verify æ¥ç»•è¿‡è¿™ä¸ªç¯èŠ‚ã€‚ ä½ å¯ä»¥åˆ©ç”¨è¯¥é’©å­ï¼Œæ¥æ£€æŸ¥ä»£ç é£æ ¼æ˜¯å¦ä¸€è‡´ï¼ˆè¿è¡Œç±»ä¼¼ lint çš„ç¨‹åºï¼‰ã€å°¾éšç©ºç™½å­—ç¬¦æ˜¯å¦å­˜åœ¨ï¼ˆè‡ªå¸¦çš„é’©å­å°±æ˜¯è¿™ä¹ˆåšçš„ï¼‰ï¼Œæˆ–æ–°æ–¹æ³•çš„æ–‡æ¡£æ˜¯å¦é€‚å½“ã€‚\nprepare-commit-msg # prepare-commit-msg é’©å­åœ¨å¯åŠ¨æäº¤ä¿¡æ¯ç¼–è¾‘å™¨ä¹‹å‰ï¼Œé»˜è®¤ä¿¡æ¯è¢«åˆ›å»ºä¹‹åè¿è¡Œã€‚ å®ƒå…è®¸ä½ ç¼–è¾‘æäº¤è€…æ‰€çœ‹åˆ°çš„é»˜è®¤ä¿¡æ¯ã€‚ è¯¥é’©å­æ¥æ”¶ä¸€äº›é€‰é¡¹ï¼šå­˜æœ‰å½“å‰æäº¤ä¿¡æ¯çš„æ–‡ä»¶çš„è·¯å¾„ã€æäº¤ç±»å‹å’Œä¿®è¡¥æäº¤çš„æäº¤çš„ SHA-1 æ ¡éªŒã€‚ å®ƒå¯¹ä¸€èˆ¬çš„æäº¤æ¥è¯´å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ï¼›ç„¶è€Œå¯¹é‚£äº›ä¼šè‡ªåŠ¨äº§ç”Ÿé»˜è®¤ä¿¡æ¯çš„æäº¤ï¼Œå¦‚æäº¤ä¿¡æ¯æ¨¡æ¿ã€åˆå¹¶æäº¤ã€å‹ç¼©æäº¤å’Œä¿®è®¢æäº¤ç­‰éå¸¸å®ç”¨ã€‚ ä½ å¯ä»¥ç»“åˆæäº¤æ¨¡æ¿æ¥ä½¿ç”¨å®ƒï¼ŒåŠ¨æ€åœ°æ’å…¥ä¿¡æ¯ã€‚\ncommit-msg # commit-msg é’©å­æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œæ­¤å‚æ•°å³ä¸Šæ–‡æåˆ°çš„ï¼Œå­˜æœ‰å½“å‰æäº¤ä¿¡æ¯çš„ä¸´æ—¶æ–‡ä»¶çš„è·¯å¾„ã€‚ å¦‚æœè¯¥é’©å­è„šæœ¬ä»¥éé›¶å€¼é€€å‡ºï¼ŒGit å°†æ”¾å¼ƒæäº¤ï¼Œå› æ­¤ï¼Œå¯ä»¥ç”¨æ¥åœ¨æäº¤é€šè¿‡å‰éªŒè¯é¡¹ç›®çŠ¶æ€æˆ–æäº¤ä¿¡æ¯ã€‚ åœ¨æœ¬ç« çš„æœ€åä¸€èŠ‚ï¼Œæˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨è¯¥é’©å­æ¥æ ¸å¯¹æäº¤ä¿¡æ¯æ˜¯å¦éµå¾ªæŒ‡å®šçš„æ¨¡æ¿ã€‚\npost-commit # post-commit é’©å­åœ¨æ•´ä¸ªæäº¤è¿‡ç¨‹å®Œæˆåè¿è¡Œã€‚ å®ƒä¸æ¥æ”¶ä»»ä½•å‚æ•°ï¼Œä½†ä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°é€šè¿‡è¿è¡Œ git log -1 HEAD æ¥è·å¾—æœ€åä¸€æ¬¡çš„æäº¤ä¿¡æ¯ã€‚ è¯¥é’©å­ä¸€èˆ¬ç”¨äºé€šçŸ¥ä¹‹ç±»çš„äº‹æƒ…\nç”µå­é‚®ä»¶å·¥ä½œæµé’©å­ # ä½ å¯ä»¥ç»™ç”µå­é‚®ä»¶å·¥ä½œæµè®¾ç½®ä¸‰ä¸ªå®¢æˆ·ç«¯é’©å­ã€‚ å®ƒä»¬éƒ½æ˜¯ç”± git am å‘½ä»¤è°ƒç”¨çš„ï¼Œå› æ­¤å¦‚æœä½ æ²¡æœ‰åœ¨ä½ çš„å·¥ä½œæµä¸­ç”¨åˆ°è¿™ä¸ªå‘½ä»¤ï¼Œå¯ä»¥è·³åˆ°ä¸‹ä¸€èŠ‚ã€‚ å¦‚æœä½ éœ€è¦é€šè¿‡ç”µå­é‚®ä»¶æ¥æ”¶ç”± git format-patch äº§ç”Ÿçš„è¡¥ä¸ï¼Œè¿™äº›é’©å­ä¹Ÿè®¸ç”¨å¾—ä¸Šã€‚\napplypatch-msg # ç¬¬ä¸€ä¸ªè¿è¡Œçš„é’©å­æ˜¯ applypatch-msg ã€‚ å®ƒæ¥æ”¶å•ä¸ªå‚æ•°ï¼šåŒ…å«è¯·æ±‚åˆå¹¶ä¿¡æ¯çš„ä¸´æ—¶æ–‡ä»¶çš„åå­—ã€‚ å¦‚æœè„šæœ¬è¿”å›éé›¶å€¼ï¼ŒGit å°†æ”¾å¼ƒè¯¥è¡¥ä¸ã€‚ ä½ å¯ä»¥ç”¨è¯¥è„šæœ¬æ¥ç¡®ä¿æäº¤ä¿¡æ¯ç¬¦åˆæ ¼å¼ï¼Œæˆ–ç›´æ¥ç”¨è„šæœ¬ä¿®æ­£æ ¼å¼é”™è¯¯ã€‚\npre-applypatch # ä¸‹ä¸€ä¸ªåœ¨ git am è¿è¡ŒæœŸé—´è¢«è°ƒç”¨çš„æ˜¯ pre-applypatch ã€‚ æœ‰äº›éš¾ä»¥ç†è§£çš„æ˜¯ï¼Œå®ƒæ­£å¥½è¿è¡Œäºåº”ç”¨è¡¥ä¸ ä¹‹åï¼Œäº§ç”Ÿæäº¤ä¹‹å‰ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç”¨å®ƒåœ¨æäº¤å‰æ£€æŸ¥å¿«ç…§ã€‚ ä½ å¯ä»¥ç”¨è¿™ä¸ªè„šæœ¬è¿è¡Œæµ‹è¯•æˆ–æ£€æŸ¥å·¥ä½œåŒºã€‚ å¦‚æœæœ‰ä»€ä¹ˆé—æ¼ï¼Œæˆ–æµ‹è¯•æœªèƒ½é€šè¿‡ï¼Œè„šæœ¬ä¼šä»¥éé›¶å€¼é€€å‡ºï¼Œä¸­æ–­ git am çš„è¿è¡Œï¼Œè¿™æ ·è¡¥ä¸å°±ä¸ä¼šè¢«æäº¤ã€‚\npost-applypatch # post-applypatch è¿è¡Œäºæäº¤äº§ç”Ÿä¹‹åï¼Œæ˜¯åœ¨ git am è¿è¡ŒæœŸé—´æœ€åè¢«è°ƒç”¨çš„é’©å­ã€‚ ä½ å¯ä»¥ç”¨å®ƒæŠŠç»“æœé€šçŸ¥ç»™ä¸€ä¸ªå°ç»„æˆ–æ‰€æ‹‰å–çš„è¡¥ä¸çš„ä½œè€…ã€‚ ä½†ä½ æ²¡åŠæ³•ç”¨å®ƒåœæ­¢æ‰“è¡¥ä¸çš„è¿‡ç¨‹\næœåŠ¡å™¨ç«¯é’©å­ # é™¤äº†å®¢æˆ·ç«¯é’©å­ï¼Œä½œä¸ºç³»ç»Ÿç®¡ç†å‘˜ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨è‹¥å¹²æœåŠ¡å™¨ç«¯çš„é’©å­å¯¹é¡¹ç›®å¼ºåˆ¶æ‰§è¡Œå„ç§ç±»å‹çš„ç­–ç•¥ã€‚ è¿™äº›é’©å­è„šæœ¬åœ¨æ¨é€åˆ°æœåŠ¡å™¨ä¹‹å‰å’Œä¹‹åè¿è¡Œã€‚ æ¨é€åˆ°æœåŠ¡å™¨å‰è¿è¡Œçš„é’©å­å¯ä»¥åœ¨ä»»ä½•æ—¶å€™ä»¥éé›¶å€¼é€€å‡ºï¼Œæ‹’ç»æ¨é€å¹¶ç»™å®¢æˆ·ç«¯è¿”å›é”™è¯¯æ¶ˆæ¯ï¼Œè¿˜å¯ä»¥ä¾ä½ æ‰€æƒ³è®¾ç½®è¶³å¤Ÿå¤æ‚çš„æ¨é€ç­–ç•¥ã€‚\npre-receive # å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„æ¨é€æ“ä½œæ—¶ï¼Œæœ€å…ˆè¢«è°ƒç”¨çš„è„šæœ¬æ˜¯ pre-receiveã€‚ å®ƒä»æ ‡å‡†è¾“å…¥è·å–ä¸€ç³»åˆ—è¢«æ¨é€çš„å¼•ç”¨ã€‚å¦‚æœå®ƒä»¥éé›¶å€¼é€€å‡ºï¼Œæ‰€æœ‰çš„æ¨é€å†…å®¹éƒ½ä¸ä¼šè¢«æ¥å—ã€‚ ä½ å¯ä»¥ç”¨è¿™ä¸ªé’©å­é˜»æ­¢å¯¹å¼•ç”¨è¿›è¡Œéå¿«è¿›ï¼ˆnon-fast-forwardï¼‰çš„æ›´æ–°ï¼Œæˆ–è€…å¯¹è¯¥æ¨é€æ‰€ä¿®æ”¹çš„æ‰€æœ‰å¼•ç”¨å’Œæ–‡ä»¶è¿›è¡Œè®¿é—®æ§åˆ¶ã€‚\nupdate # update è„šæœ¬å’Œ pre-receive è„šæœ¬ååˆ†ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒä¼šä¸ºæ¯ä¸€ä¸ªå‡†å¤‡æ›´æ–°çš„åˆ†æ”¯å„è¿è¡Œä¸€æ¬¡ã€‚ å‡å¦‚æ¨é€è€…åŒæ—¶å‘å¤šä¸ªåˆ†æ”¯æ¨é€å†…å®¹ï¼Œpre-receive åªè¿è¡Œä¸€æ¬¡ï¼Œç›¸æ¯”ä¹‹ä¸‹ update åˆ™ä¼šä¸ºæ¯ä¸€ä¸ªè¢«æ¨é€çš„åˆ†æ”¯å„è¿è¡Œä¸€æ¬¡ã€‚ å®ƒä¸ä¼šä»æ ‡å‡†è¾“å…¥è¯»å–å†…å®¹ï¼Œè€Œæ˜¯æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šå¼•ç”¨çš„åå­—ï¼ˆåˆ†æ”¯ï¼‰ï¼Œæ¨é€å‰çš„å¼•ç”¨æŒ‡å‘çš„å†…å®¹çš„ SHA-1 å€¼ï¼Œä»¥åŠç”¨æˆ·å‡†å¤‡æ¨é€çš„å†…å®¹çš„ SHA-1 å€¼ã€‚ å¦‚æœ update è„šæœ¬ä»¥éé›¶å€¼é€€å‡ºï¼Œåªæœ‰ç›¸åº”çš„é‚£ä¸€ä¸ªå¼•ç”¨ä¼šè¢«æ‹’ç»ï¼›å…¶ä½™çš„ä¾ç„¶ä¼šè¢«æ›´æ–°ã€‚\npost-receive # post-receive æŒ‚é’©åœ¨æ•´ä¸ªè¿‡ç¨‹å®Œç»“ä»¥åè¿è¡Œï¼Œå¯ä»¥ç”¨æ¥æ›´æ–°å…¶ä»–ç³»ç»ŸæœåŠ¡æˆ–è€…é€šçŸ¥ç”¨æˆ·ã€‚ å®ƒæ¥å—ä¸ pre-receive ç›¸åŒçš„æ ‡å‡†è¾“å…¥æ•°æ®ã€‚ å®ƒçš„ç”¨é€”åŒ…æ‹¬ç»™æŸä¸ªé‚®ä»¶åˆ—è¡¨å‘ä¿¡ï¼Œé€šçŸ¥æŒç»­é›†æˆï¼ˆcontinous integrationï¼‰çš„æœåŠ¡å™¨ï¼Œæˆ–è€…æ›´æ–°é—®é¢˜è¿½è¸ªç³»ç»Ÿï¼ˆticket-tracking systemï¼‰ â€”â€” ç”šè‡³å¯ä»¥é€šè¿‡åˆ†ææäº¤ä¿¡æ¯æ¥å†³å®šæŸä¸ªé—®é¢˜ï¼ˆticketï¼‰æ˜¯å¦åº”è¯¥è¢«å¼€å¯ï¼Œä¿®æ”¹æˆ–è€…å…³é—­ã€‚ è¯¥è„šæœ¬æ— æ³•ç»ˆæ­¢æ¨é€è¿›ç¨‹ï¼Œä¸è¿‡å®¢æˆ·ç«¯åœ¨å®ƒç»“æŸè¿è¡Œä¹‹å‰å°†ä¿æŒè¿æ¥çŠ¶æ€ï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³åšå…¶ä»–æ“ä½œéœ€è°¨æ…ä½¿ç”¨å®ƒï¼Œå› ä¸ºå®ƒå°†è€—è´¹ä½ å¾ˆé•¿çš„ä¸€æ®µæ—¶é—´\n","date":"2018å¹´09æœˆ20æ—¥","externalUrl":null,"permalink":"/posts/git%E9%92%A9%E5%AD%90/","section":"Posts","summary":"","title":"Gité’©å­","type":"posts"},{"content":"","date":"2018å¹´09æœˆ20æ—¥","externalUrl":null,"permalink":"/tags/%E9%92%A9%E5%AD%90/","section":"Tags","summary":"","title":"é’©å­","type":"tags"},{"content":" GogsæœåŠ¡åŒåšå®¢é™æ€æœåŠ¡åœ¨åŒä¸€æœåŠ¡å™¨ï¼Œæˆ‘æƒ³æ¯æ¬¡pushåï¼ŒGogsæ¥å—æˆåŠŸåä¼šè‡ªåŠ¨æ›´æ–°è¿œç¨‹æœåŠ¡å™¨çš„èµ„æº\nç”¨Hexoæ¡†æ¶å†™å®Œåšå®¢åï¼Œä½¿ç”¨hexo d -gä¼šå°†ç”Ÿæˆå¥½çš„é™æ€èµ„æºæ¨é€åˆ°è‡ªå·±çš„è¿œç¨‹ä»“åº“ï¼Œè¿œç¨‹æœåŠ¡å™¨æ¯æ¬¡éƒ½è¦ç™»ä¸Šå»æ‰‹åŠ¨git pullï¼Œè€Œå†™ä¸ªcrontabæœ‰åˆè§‰å¾—ä¸æ€ä¹ˆå¥½ï¼Œç„¶åå°±æ‰¾åˆ°äº†Git æœåŠ¡ç«¯é’©å­ post-receiveæ­¤æŒ‚é’©åœ¨æ•´ä¸ªè¿‡ç¨‹å®Œç»“ä»¥åè¿è¡Œï¼Œå¯ä»¥ç”¨æ¥æ›´æ–°å…¶ä»–ç³»ç»ŸæœåŠ¡æˆ–è€…é€šçŸ¥ç”¨æˆ·\nè¿™ä¸ªé’©å­åœ¨Gogsçš„gogs-repositoriesç›®å½•ä¸‹ï¼Œæ¯ä¸€ä¸ªä»“åº“ç›®å½•ä¸‹éƒ½æœ‰hooks/post-receiveè¿™ä¸ªé’©å­ï¼Œå°†ä»¥ä¸‹æ”¹å¥½åæ·»åŠ åˆ°æ–‡ä»¶å†…å³å¯\nunset GIT_DIR NowPath=`pwd` DeployPath=\u0026#34;/var/www/blog\u0026#34; # è¦å°†è¿™é‡Œçš„è·¯å¾„ä¿®æ”¹ä¸ºè¿œç¨‹æœåŠ¡å™¨ä¸Šå­˜æ”¾åšå®¢é™æ€èµ„æºçš„ç›®å½• cd $DeployPath git pull origin master cd $NowPath exit 0 ","date":"2018å¹´09æœˆ20æ—¥","externalUrl":null,"permalink":"/posts/%E5%90%91gogs%E4%BB%93%E5%BA%93%E6%8E%A8%E9%80%81%E4%BB%A3%E7%A0%81%E5%90%8E%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E7%9A%84%E4%BB%A3%E7%A0%81/","section":"Posts","summary":"","title":"å‘Gogsä»“åº“æ¨é€ä»£ç åï¼Œè‡ªåŠ¨æ›´æ–°è¿œç¨‹ä»“åº“çš„ä»£ç ","type":"posts"},{"content":"","date":"2018å¹´09æœˆ20æ—¥","externalUrl":null,"permalink":"/tags/%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/","section":"Tags","summary":"","title":"è‡ªåŠ¨éƒ¨ç½²","type":"tags"},{"content":" è¿™é‡Œåˆ—å‡ºäº†ã€ŠRuby å…ƒç¼–ç¨‹ã€‹ä»‹ç»çš„æ‰€ç”¨æ³•æœ¯\nç¯ç»•åˆ«å Around Alias # ä»ä¸€ä¸ªé‡æ–°å®šä¹‰çš„æ–¹æ³•ä¸­è°ƒç”¨åŸå§‹çš„ã€è¢«é‡å‘½åçš„ç‰ˆæœ¬\nclass String alias_method :old_reverse, :reverse def reverse \u0026#34;x#{old_reverse}x\u0026#34; end end \u0026#39;abc\u0026#39;.reverse # =\u0026gt; \u0026#39;xcbax\u0026#39; ç™½æ¿ç±» Blank Slate # ç§»é™¤ä¸€ä¸ªå¯¹è±¡ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼Œä»¥ä¾¿å§ä»–ä»¬è½¬æ¢æˆå¹½çµæ–¹æ³•\nclass C def method_missing(name, *args) \u0026#34;#{name} is a ghost method\u0026#34; end end obj = C.new obj.to_s # =\u0026gt; \u0026#34;#\u0026lt;C:...\u0026gt;\u0026#34; class B \u0026lt; BasicObject def method_missing(name, *args) \u0026#34;#{name} is a ghost method\u0026#34; end end blank_slate = B.new blank_slate.to_s # =\u0026gt; \u0026#34;to_s is a ghost method\u0026#34; ç±»æ‰©å±• Class Extension # é€šè¿‡å‘ç±»çš„å•ä»¶ç±»ä¸­åŠ å…¥æ¨¡å—æ¥å®šä¹‰ç±»æ–¹æ³•ï¼Œæ˜¯å¯¹è±¡æ‰©å±•çš„ä¸€ä¸ªç‰¹ä¾‹\nclass C end module M def a_method \u0026#39;a method\u0026#39; end end class \u0026lt;\u0026lt; C include M end C.a_method # =\u0026gt; \u0026#39;a method\u0026#39; ç±»å®ä¾‹å˜é‡ Class Instance Variable # åœ¨ä¸€ä¸ªClasså¯¹è±¡çš„å®ä¾‹å˜é‡ä¸­å­˜å‚¨ç±»çº§åˆ«çš„çŠ¶æ€\nclass C @my_class_instance_variable = \u0026#39;some value\u0026#39; def self.class_attribute @my_class_instance_variable end end C.class_attribute # =\u0026gt; \u0026#39;some value\u0026#39; ç±»å® Class Macro # åœ¨ç±»å®šä¹‰ä¸­ä½¿ç”¨æ–¹æ³•\nclass C end class \u0026lt;\u0026lt; C def a_method(arg) \u0026#34;a_method(#{arg} called)\u0026#34; end end class C a_method :x # =\u0026gt; \u0026#34;a_method(x) called\u0026#34; end æ´å‡€å®¤ Clean Room # ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡ä½œä¸ºæ‰§è¡Œä¸€ä¸ªä»£ç å—çš„ç¯å¢ƒ\nclass CleanRoom def a_userful_method x x * 2 end end CleanRoom.new.instance_eval { a_userful_method(3) } # =\u0026gt; 6 ä»£ç å¤„ç†å™¨ Code Processor # å¤„ç†ä»å¤–éƒ¨æ´»çš„çš„ä»£ç å­—ç¬¦ä¸²\nFile.readlines(\u0026#39;a_file_containing_lines_of_ruby.txt\u0026#39;).each do |line| puts \u0026#34;#{line.chomp} ==\u0026gt; #{eval(line)}\u0026#34; end # =\u0026gt; 1 + 1 ==\u0026gt; 2 # =\u0026gt; Math.log10(100) ==\u0026gt; 2.0 ä¸Šä¸‹æ–‡æ¢é’ˆ Context Probe # æ‰§è¡Œä¸€ä¸ªä»£ç å—æ¥è·å–ä¸€ä¸ªå¯¹è±¡ä¸Šä¸‹æ–‡ä¸­çš„ä¿¡æ¯\nclass C def initialize @x = \u0026#39;a private instance variable\u0026#39; end end obj = C.new obj.instance_eval { @x } # =\u0026gt; \u0026#39;a private instance variable\u0026#39; å»¶è¿Ÿæ‰§è¡Œ Deferred Evaluation # åœ¨ proc æˆ– lambda ä¸­å­˜å‚¨ä¸€æ®µä»£ç åŠå…¶ä¸Šä¸‹æ–‡ï¼Œç”¨äºä»¥åæ‰§è¡Œ\nclass C def store(\u0026amp;block) @my_code_capsule = block end def execute(*args) @my_code_capsule.call(*args) end end obj = C.new obj.store { $X = 1 } $X = 0 obj.execute $X # =\u0026gt; 1 åŠ¨æ€æ´¾å‘ Dynamic Dispatch # åœ¨è¿è¡Œæ˜¯å†³å®šè°ƒç”¨å“ªä¸ªæ–¹æ³•\nmethod_to_call = :reverse obj = \u0026#39;abc\u0026#39; obj.send(method_to_call) # =\u0026gt; \u0026#39;reverse\u0026#39; åŠ¨æ€æ–¹æ³• Dynamic Method # åœ¨è¿è¡Œæ˜¯å†³å®šæ€æ ·å®šä¹‰ä¸€ä¸ªæ–¹æ³•\nclass C end C.class_eval do define_method :a_method do \u0026#39;a dynamic method\u0026#39; end end obj = C.new c.a_method # =\u0026gt; \u0026#39;a dynamic method\u0026#39; åŠ¨æ€ä»£ç† Dynamic Proxy # æŠŠä¸èƒ½å¯¹åº”æŸä¸ªæ–¹æ³•åçš„æ¶ˆæ¯è½¬å‘ç»™å¦å¤–ä¸€ä¸ªå¯¹è±¡\nclass MyDynamicProxy def initialize(target) @target = target end def method_missing(name, *args, \u0026amp;block) \u0026#34;result: #{@target.send(name, *args, \u0026amp;block)}\u0026#34; end end obj = MyDynamicProxy.new(\u0026#39;a string\u0026#39;) obj.reverse # =\u0026gt; \u0026#39;result: gnirts a\u0026#39; æ‰å¹³ä½œç”¨åŸŸ Flat Scope # ä½¿ç”¨é—­åŒ…åœ¨ä¸¤ä¸ªä½œç”¨åŸŸä¹‹é—´å…±äº«å˜é‡\nclass C def an_attribute @attr end end obj = C.new a_variable = 100 obj.instance_eval do @attr = a_variable end obj.an_attribute # =\u0026gt; 100 å¹½çµæ–¹æ³• Ghost Method # å“åº”ä¸€ä¸ªæ²¡æœ‰å…³è”æ–¹æ³•çš„æ¶ˆæ¯\nclass C def method_missing(name, *args) name.to_s.reverse end end obj = C.new obj.my_ghost_method # =\u0026gt; \u0026#39;dohtem_tsohg_ym\u0026#39; é’©å­æ–¹æ³• Hook Method # å¤å†™ä¸€ä¸ªæ–¹æ³•æ¥æˆªè·å¯¹è±¡æ¨¡å‹äº‹ä»¶\n$INHERITORS = [] class C def self.inherited(subclass) $INHERITORS \u0026lt;\u0026lt; subclass end end class D \u0026lt; C end class E \u0026lt; D end class F \u0026lt; E end $INHERITORS # =\u0026gt; [D, E ,F] å†…æ ¸æ–¹æ³• Kernel Method # åœ¨Kernelæ¨¡å—ä¸­å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œä½¿å¾—æ‰€æœ‰å¯¹è±¡éƒ½å¯ä½¿ç”¨\nmodule Kernel def a_method \u0026#39;a kernel method\u0026#39; end end a_method # =\u0026gt; \u0026#39;a kernel method\u0026#39; æƒ°æ€§å®ä¾‹å˜é‡ Lazy Instance Variable # ç­‰ç¬¬ä¸€æ¬¡è®¿é—®ä¸€ä¸ªå®ä¾‹å˜é‡æ—¶æ‰å¯¹å®ƒè¿›è¡Œåˆå§‹åŒ–\nclass C def attribute @attribute = @attribute || \u0026#39;some value\u0026#39; end end obj = C.new obj.attribute # =\u0026gt; \u0026#39;some value\u0026#39; æ‹Ÿæ€æ–¹æ³• Mimic Method # æŠŠä¸€ä¸ªæ–¹æ³•ä¼ªè£…æˆå¦å¤–ä¸€ç§è¯­è¨€æ„ä»¶\ndef BaseClass name name == \u0026#39;string\u0026#39; ? String : Object end class C \u0026lt; BaseClass \u0026#39;string\u0026#39; # ä¸€ä¸ªçœ‹èµ·åƒç±»çš„æ–¹æ³• attr_accessor :an_attribute # ä¸€ä¸ªçœ‹èµ·åƒå…³é”®å­—çš„æ–¹æ³• end obj = C.new obj.an_attribute = 1 # ä¸€ä¸ªçœ‹èµ·åƒå±æ€§çš„æ–¹æ³• çŒ´å­æ‰“è¡¥ä¸ Monkeypatch # ä¿®æ”¹å·²æœ‰ç±»çš„ç‰¹æ€§\n\u0026#39;abc\u0026#39;.reverse # =\u0026gt; \u0026#39;cba\u0026#39; class String def reverse \u0026#39;override\u0026#39; end end \u0026#39;abc\u0026#39;.reverse # =\u0026gt; \u0026#39;override\u0026#39; å‘½åç©ºé—´ Namespace # åœ¨ä¸€ä¸ªæ¨¡å—ä¸­å®šä¹‰å¸¸é‡ï¼Œä»¥é˜²æ­¢å‘½åå†²çª\nmodule MyNamespace class Array def to_s \u0026#39;to_a method in array of the my namespace\u0026#39; end end end Array.new.to_s # =\u0026gt; [] MyNamespace::Array.new.to_s # =\u0026gt; \u0026#39;to_a method in array of the my namespace\u0026#39; ç©ºæŒ‡é’ˆä¿æŠ¤ Nil Guard # ç”¨\u0026rsquo;||\u0026lsquo;æ“ä½œç¬¦è¦†å†™ä¸€ä¸ªç©ºå¼•ç”¨\nx = nil y = x || \u0026#39;a value\u0026#39; # =\u0026gt; \u0026#39;a value\u0026#39; å¯¹è±¡æ‰©å±• Object Extension # é€šè¿‡ä¸€ä¸ªå¯¹è±¡çš„å•ä»¶ç±»æ··å…¥æ¨¡å—æ¥å®šä¹‰å•ä»¶æ–¹æ³•\nobj = Object.new module M def a_method \u0026#39;a singleton method in M\u0026#39; end end class \u0026lt;\u0026lt; obj include M end obj.a_method # =\u0026gt; \u0026#39;a singleton method\u0026#39; æ‰“å¼€ç±» Open Class # ä¿®æ”¹å·²æœ‰çš„ç±»\nclass String def a_method \u0026#39;a method\u0026#39; end end \u0026#39;abc\u0026#39;.a_method # =\u0026gt; \u0026#39;a method\u0026#39; ä¸‹åŒ…å«åŒ…è£…å™¨ Prepended Wrapper # è°ƒç”¨ä¸€ä¸ªç”¨ prepend æ–¹å¼è¦†å†™çš„æ–¹æ³•\nmodule M def reverse \u0026#34;x#{super}x\u0026#34; end end String.class_eval do prepend M end \u0026#39;abc\u0026#39;.reverse # =\u0026gt; \u0026#39;xcbax\u0026#39; ç»†åŒ– Refinement # ä¸ºç±»æ‰“è¡¥ä¸ï¼Œä½œç”¨èŒƒå›´ä»…åˆ°æ–‡ä»¶ç»“æŸï¼Œæˆ–ä»…é™äºåŒ…å«æ¨¡å—çš„ä½œç”¨åŸŸä¸­\nmodule MyRefinement refine String do def reverse \u0026#39;refinement reverse\u0026#39; end end end \u0026#39;abc\u0026#39;.reverse # =\u0026gt; \u0026#39;cba\u0026#39; using MyRefinement \u0026#39;abc\u0026#39;.reverse # =\u0026gt; \u0026#39;refine reverse\u0026#39; ç»†åŒ–å°è£…å™¨ Refinement Wrapper # åœ¨ç»†åŒ–ä¸­è°ƒç”¨éç»†åŒ–çš„æ–¹æ³•\nmodule StringRefinement refine String do def reverse \u0026#34;x#{super}x\u0026#34; end end end using StringRefinement \u0026#39;abc\u0026#39;.reverse # =\u0026gt; \u0026#39;xcbax\u0026#39; æ²™ç›’ Sandbox # åœ¨ä¸€ä¸ªå®‰å…¨çš„ç¯å¢ƒä¸­æ‰§è¡Œæœªæˆæƒçš„ä»£ç \ndef sandbox \u0026amp;code proc do $SAFE = 2 yield end.call end begin sandbox { File.delete \u0026#39;a_file\u0026#39; } rescue Exception =\u0026gt; ex ex # =\u0026gt; end ä½œç”¨åŸŸé—¨ Scope Gate # ç”¨class, module æˆ– def å…³é”®å­—æ¥éš”ç¦»ä½œç”¨åŸŸ\na = 1 defined? a # =\u0026gt; \u0026#39;local-variable\u0026#39; module MModule b = 1 defined? a # =\u0026gt; nil defined? b # =\u0026gt; \u0026#39;local-variable\u0026#39; end defined? a # =\u0026gt; \u0026#39;local-variable\u0026#39; defined? b # =\u0026gt; nil Self Yield # æŠŠselfä¼ ç»™å½“å‰ä»£ç å—\nclass Person attr_accessor :name, :surname def initialize yield self end end joe = Person.new do |person| person.name = \u0026#39;Joe\u0026#39; person.surname = \u0026#39;Smith\u0026#39; end å…±äº«ä½œç”¨åŸŸ Shared Scope # åœ¨åŒä¸€ä¸ªæ‰å¹³ä½œç”¨åŸŸçš„å¤šä¸ªä¸Šä¸‹æ–‡ä¸­å…±äº«å˜é‡\nlambda do shared = 10 self.class_eval do defined_method :counter do shared end defined_method :down do shared -= 1 end end end.call counter # =\u0026gt; 10 3.times { down } counter # =\u0026gt; 7 å•ä»¶æ–¹æ³• Singleton Method # åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šå®šä¹‰ä¸€ä¸ªæ–¹æ³•\nobj = \u0026#39;abc\u0026#39; class \u0026lt;\u0026lt; obj def obj_singleton_method \u0026#39;x\u0026#39; end end obj.obj_singleton_method # =\u0026gt; \u0026#39;x\u0026#39; ä»£ç å­—ç¬¦ä¸² String of Code # æ‰§è¡Œä¸€æ®µè¡¨ç¤ºrubyä»£ç çš„å­—ç¬¦ä¸²\nstring_of_code = \u0026#39;1 + 1\u0026#39; eval(string_of_code) # =\u0026gt; 2 ç¬¦å·åˆ°Proc Symbol To Proc # æŠŠä¸€ä¸ªè°ƒç”¨å•ä¸ªæ–¹çš„å—è½¬æ¢ä¸ºä¸€ä¸ªç¬¦å·\n(1..6).map(\u0026amp;:even?) # =\u0026gt; [false, true, false, true, false, true] ","date":"2018å¹´09æœˆ20æ—¥","externalUrl":null,"permalink":"/posts/ruby%E5%85%83%E7%BC%96%E7%A8%8B%E6%89%8B%E5%86%8C/","section":"Posts","summary":"","title":"Rubyå…ƒç¼–ç¨‹æ‰‹å†Œ","type":"posts"},{"content":"","date":"2018å¹´09æœˆ20æ—¥","externalUrl":null,"permalink":"/tags/%E5%85%83%E7%BC%96%E7%A8%8B/","section":"Tags","summary":"","title":"å…ƒç¼–ç¨‹","type":"tags"},{"content":" Jekyll æ˜¯ä¸€ä¸ªç®€å•çš„åšå®¢å½¢æ€çš„é™æ€ç«™ç‚¹ç”Ÿäº§æœºå™¨\nå‡†å¤‡å·¥ä½œ # åœ¨æœ¬åœ°ä½¿ç”¨Jekyllæ¡†æ¶ï¼Œéœ€è¦ç”µè„‘ä¸­å·²å®‰è£…Git ã€Ruby å®‰è£…Git # Windowsï¼šä¸‹è½½å¹¶å®‰è£… Git Macï¼šä½¿ç”¨ Homebrew ï¼šbrew install git --with-gettext Linux (Ubuntu, Debian)ï¼šsudo apt-get install git-core Linux (Fedora, Red Hat, CentOS)ï¼šsudo yum install git-core å®‰è£…Ruby # Ruby æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œå»ºè®®ä½¿ç”¨rvm (Ruby Version Manager) æ¥ç®¡ç†Rubyçš„ç‰ˆæœ¬ã€‚å¯¹äºwindowså°ä¼™ä¼´æ¥è¯´ï¼Œå»ºè®®ä½¿ç”¨Rubyå®‰è£…ç¨‹åº è¿›è¡Œå®‰è£…\nå®‰è£…Ruby\n# å®‰è£… Jekyll éœ€è¦ Ruby ç‰ˆæœ¬ \u0026gt;= 2.1.0 rvm install 2.5.1 ä½¿ç”¨ruby-chinaçš„æºé•œåƒ # æ›¿æ¢ rvm çš„é…ç½®ä¿¡æ¯ echo \u0026#34;ruby_url=https://cache.ruby-china.com/pub/ruby\u0026#34; \u0026gt; ~/.rvm/user/db å®‰è£…Jekyll # gem install bundler jekyll å›½å†…å°ä¼™ä¼´å»ºè®®å…ˆä½¿ç”¨ruby-chinaçš„Gemé•œåƒ # æ›¿æ¢Gemæº gem sources --add https://gems.ruby-china.com/ --remove https://rubygems.org/ # æ›¿æ¢ Bundler çš„ Gem æºä»£ç é•œåƒå‘½ä»¤ bundle config mirror.https://rubygems.org https://gems.ruby-china.com ä½¿ç”¨Jekyll # åˆå§‹åŒ– # Jekyll new åšå®¢æ–‡ä»¶å¤¹ # è¿›å…¥åšå®¢ç›®å½• cd åšå®¢æ–‡ä»¶å¤¹ # å®‰è£…ä¾èµ– bundle install æŸ¥çœ‹jekyll newæ›´å¤šå¸®åŠ©\njekyll new -h æœ¬åœ°å¯åŠ¨ # # s æ˜¯ server jekyll s ç„¶ååœ¨å¯ä»¥æœ¬åœ°æµè§ˆå™¨æ‰“å¼€http://localhost:4000ï¼Œå°±å¯ä»¥è®¿é—®å¯åŠ¨å¥½çš„åšå®¢å•¦\næŸ¥çœ‹jekyll serveræ›´å¤šå¸®åŠ©\njekyll s -h ä½¿ç”¨Nextä¸»é¢˜ # æˆ‘ä½¿ç”¨çš„Next ä¸»é¢˜\ngit clone https://github.com/Simpleyyt/jekyll-theme-next cd jekyll-theme-next bundle install jekyll s # å¯åŠ¨ æ­¤æ—¶é¡¹ç›®ç›®å½•å°±æ˜¯jekyll-theme-nextï¼Œä¿®æ”¹é¡¹ç›®ç›®å½•ä¸‹çš„_config.ymlæ–‡ä»¶, å¿…é¡»é‡å¯Hexoæœ¬åœ°æœåŠ¡ï¼Œå³å¯åœ¨æœ¬åœ°çœ‹åˆ°æ–°çš„ä¸»é¢˜æ ·å¼\né…ç½® # Jekyllå¤§éƒ¨ä»½çš„çš„é…ç½®åœ¨é¡¹ç›®ç›®å½•ä¸‹çš„_config.ymlä¸­ï¼Œæ ¹æ®Jekyllå®˜æ–¹æ–‡æ¡£ ï¼ŒJekyllä¸­æ–‡æ–‡æ¡£ å’ŒNextæ–‡æ¡£ æŒ‰ç…§è‡ªå·±éœ€è¦æ”¹åŠ¨å³å¯\nå†™æ–‡ç«  # éœ€è¦åœ¨_postsæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œæ–‡ä»¶æ ¼å¼ä¸ºå¹´-æœˆ-æ—¥-æ ‡é¢˜.mdï¼Œå¹´æ˜¯å››ä½æ•°å­—ï¼Œæœˆå’Œæ—¥éƒ½æ˜¯ä¸¤ä½\næ›´å¤šè¯´æ˜ï¼Œå‚è€ƒJekyll å†™ä½œ éƒ¨ç½² # éƒ¨ç½²çš„åŸºæœ¬åŸç†åŒHexoçš„éƒ¨ç½² , ä½†æ˜¯Jekyllæ²¡æœ‰ç±»ä¸Hexoçš„hexo-deployer-gitï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨æŠŠè¿™é™æ€èµ„æºçš„ç›®å½•_siteçš„ä¸­å†…å®¹æäº¤åˆ°è¿œç¨‹å°±å¯ä»¥äº†\n","date":"2018å¹´09æœˆ19æ—¥","externalUrl":null,"permalink":"/posts/jekyll%E7%9A%84%E7%AE%80%E5%8D%95%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E4%BB%A5%E5%8F%8A%E9%83%A8%E7%BD%B2/","section":"Posts","summary":"","title":"Jekyllçš„ç®€å•å®‰è£…é…ç½®ä»¥åŠéƒ¨ç½²","type":"posts"},{"content":"","date":"2018å¹´09æœˆ18æ—¥","externalUrl":null,"permalink":"/tags/%E9%9D%99%E6%80%81/","section":"Tags","summary":"","title":"é™æ€","type":"tags"},{"content":" Nginxï¼ˆå‘éŸ³åŒengine xï¼‰æ˜¯ä¸€ä¸ªå¼‚æ­¥æ¡†æ¶çš„ WebæœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ç”¨ä½œåå‘ä»£ç†ï¼Œè´Ÿè½½å¹³è¡¡å™¨ å’Œ HTTPç¼“å­˜\né…ç½®é™æ€ç½‘ç«™ # server { listen 80; # ç«¯å£å· server_name example.com; # åŸŸå location / { root /var/www/project_dir; # é™æ€é¡¹ç›®è·¯å¾„ index index.html; # ç½‘ç«™åˆå§‹é¡µ error_page 404 /index.html; # é™æ€é¡µé¢é‡å®šå‘æœåŠ¡å™¨é”™è¯¯é¡µé¢ } } å°†ä»¥ä¸Šé…ç½®å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œç„¶åç¼–è¾‘nginx.confï¼ˆä½¿ç”¨nginx -tå¯ä»¥çœ‹åˆ°å…·ä½“è·¯å¾„ï¼‰ï¼Œç”¨include é…ç½®æ–‡ä»¶çš„è·¯å¾„;å¼•å…¥åˆ°é…ç½®ä¸­ï¼Œé€€å‡ºç¼–è¾‘å™¨ï¼Œä½¿ç”¨nginx -tæ¥æµ‹è¯•é…ç½®æ˜¯å¦æœ‰è¯¯ï¼Œæœ‰é—®é¢˜çš„æ”¹å¥½åå†è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œä½¿ç”¨nginx -s reloadé‡æ–°åŠ è½½Nginxé…ç½®\n","date":"2018å¹´09æœˆ18æ—¥","externalUrl":null,"permalink":"/posts/%E4%BD%BF%E7%94%A8nginx%E9%83%A8%E7%BD%B2%E9%9D%99%E6%80%81%E7%BD%91%E7%AB%99/","section":"Posts","summary":"","title":"ä½¿ç”¨Nginxéƒ¨ç½²é™æ€ç½‘ç«™","type":"posts"},{"content":"","date":"2018å¹´09æœˆ17æ—¥","externalUrl":null,"permalink":"/tags/hexo/","section":"Tags","summary":"","title":"Hexo","type":"tags"},{"content":" Hexoæ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶\nå‡†å¤‡å·¥ä½œ # åœ¨æœ¬åœ°ä½¿ç”¨hexoæ¡†æ¶ï¼Œéœ€è¦ç”µè„‘ä¸­å·²å®‰è£…Git ã€Node.js å®‰è£…Git # Windowsï¼šä¸‹è½½å¹¶å®‰è£… Git Macï¼šä½¿ç”¨ Homebrew ï¼šbrew install git --with-gettext Linux (Ubuntu, Debian)ï¼šsudo apt-get install git-core Linux (Fedora, Red Hat, CentOS)ï¼šsudo yum install git-core å®‰è£…Node.js # Node.js æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œå»ºè®®ä½¿ç”¨nvm (Node Version Manager) æ¥ç®¡ç†nodeçš„ç‰ˆæœ¬ã€‚å¯¹äºwindowså°ä¼™ä¼´æ¥è¯´ï¼Œå»ºè®®ä½¿ç”¨Node.jså®‰è£…ç¨‹åº è¿›è¡Œå®‰è£…ï¼Œå–œæ¬¢æŠ˜è…¾çš„å°ä¼™ä¼´å¯ä»¥è¯•è¯•nvm-windows å®‰è£…Node.js\nnvm install stable ä½¿ç”¨æ·˜å®çš„ Node.js é•œåƒ # nvm ä½¿ç”¨é•œåƒå®‰è£… NVM_NODEJS_ORG_MIRROR=https://npm.taobao.org/mirrors/node nvm install stable # windowså°ä¼™ä¼´å¦‚æœä½¿ç”¨ nvm-windowsï¼Œè®¾ç½®é•œåƒ nvm node_mirror https://npm.taobao.org/mirrors/node/ å®‰è£…Hexo # npm install -g hexo-cli å›½å†…å°ä¼™ä¼´å»ºè®®ä½¿ç”¨æ·˜å® NPM é•œåƒ # å®‰è£…cnpm npm install -g cnpm --registry=https://registry.npm.taobao.org # ä½¿ç”¨cnpmå®‰è£…hexo cnpm install -g hexo-cli # windowså°ä¼™ä¼´å¦‚æœä½¿ç”¨ nvm-windowsï¼Œè®¾ç½®npmé•œåƒ nvm npm_mirror https://npm.taobao.org/mirrors/npm/ ä½¿ç”¨hexo # åˆå§‹åŒ– # # --no-install æ˜¯ä½¿ç”¨åˆå§‹\båŒ–åè·³è¿‡npm install hexo init é¡¹ç›®æ–‡ä»¶å¤¹ --no-install # è¿›å…¥é¡¹ç›®ç›®å½• cd é¡¹ç›®æ–‡ä»¶å¤¹ # å®‰è£…ä¾èµ– cnpm install æŸ¥çœ‹hexo initæ›´å¤šå¸®åŠ©\nhexo init -h æœ¬åœ°å¯åŠ¨ # # s æ˜¯ server hexo s ç„¶åä¼šè¾“å‡ºä»¥ä¸‹ä¿¡æ¯\nINFO Start processing INFO Hexo is running at http://localhost:4000 . Press Ctrl+C to stop. ç„¶ååœ¨å¯ä»¥æœ¬åœ°æµè§ˆå™¨æ‰“å¼€http://localhost:4000ï¼Œå°±å¯ä»¥è®¿é—®å¯åŠ¨å¥½çš„åšå®¢å•¦\næŸ¥çœ‹hexo serveræ›´å¤šå¸®åŠ©ï¼Œä¹Ÿå¯å‚è€ƒHexo æœåŠ¡å™¨ hexo s -h å®‰è£…Nextä¸»é¢˜ # æˆ‘ä½¿ç”¨çš„Next ä¸»é¢˜\ncd é¡¹ç›®æ–‡ä»¶å¤¹ git clone https://github.com/theme-next/hexo-theme-next themes/next å°†é¡¹ç›®ç›®å½•ä¸‹çš„_config.ymlé…ç½®æ–‡ä»¶ä¸­çš„theme: landscapeæ”¹ä¸ºtheme: next, ç„¶åé‡å¯Hexoæœ¬åœ°æœåŠ¡ï¼Œå³å¯åœ¨æœ¬åœ°çœ‹åˆ°æ–°çš„ä¸»é¢˜æ ·å¼\nå¦‚æœæƒ³æ”¹ä¸ºå…¶ä»–ä¸»é¢˜ï¼Œè¯·å‰å¾€Hexo Themes ï¼Œè‡ªè¡Œé€‰å–åï¼ŒæŒ‰ç…§è¯´æ˜æ–‡æ¡£è¦æ±‚è‡ªè¡Œä¿®æ”¹é…ç½®\né…ç½® # Hexoå¤§éƒ¨ä»½çš„çš„é…ç½®åœ¨é¡¹ç›®ç›®å½•ä¸‹çš„_config.ymlä¸­ï¼Œæ ¹æ®Hexoå®˜æ–¹æ–‡æ¡£ æŒ‰ç…§è‡ªå·±éœ€è¦æ”¹åŠ¨å³å¯\nè‡ªå·±æƒ³ä¸ªæ€§åŒ–é…ç½®ï¼Œä¾‹å¦‚åœ¨æ–‡ç« åº•éƒ¨å¢åŠ ç‰ˆæƒä¿¡æ¯ï¼Œç½‘ç«™åº•éƒ¨å­—æ•°ç»Ÿè®¡ç­‰æ›´å¤šï¼Œå¯ä»¥å‚è€ƒHexoçš„Nextä¸»é¢˜ä¸ªæ€§åŒ–é…ç½®æ•™ç¨‹ ï¼Œå½“ç„¶è¿™ä¸ªå‚è€ƒå¤§éƒ¨åˆ†éƒ½æ˜¯next 5.xç‰ˆæœ¬ï¼Œæ–°çš„ç‰ˆæœ¬è¿˜æ˜¯å»ºè®®å‚è€ƒtheme-next ä¸­çš„é…ç½®\nå†™æ–‡ç«  # åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ç« \nhexo new æ–‡ç« å æ›´å¤šè¯´æ˜ï¼Œå‚è€ƒHexo å†™ä½œ éƒ¨ç½² # å®‰è£…hexo-deployer-git # é¦–å…ˆå®‰è£…hexo-deployer-git cnpm install hexo-deployer-git --save åˆ›å»ºä»“åº“ # ä¸‹é¢è¦ç”¨åˆ°gitä»“åº“ï¼Œåˆ›å»ºgithub.ioä»“åº“\nç‚¹å‡»New repository è¾“å…¥Repository nameï¼Œå¿…éœ€ä¸ºç”¨æˆ·å.github.ioæ ¼å¼ ç‚¹å‡»æŒ‰é’®Create repository è¿›å…¥ä»“åº“ç”¨æˆ·å.github.ioï¼Œç‚¹å‡»Settingsï¼Œæ‰¾åˆ°GitHub Pagesæ¨¡å— ç‚¹å‡»Choose a themeé€‰æ‹©ä¸€ä¸ªé¡µé¢ä¸»é¢˜ ç„¶åè¿™ä¸ªé™æ€èµ„æºå­˜æ”¾çš„è¿œç¨‹ä»“åº“åœ°å€å°±åˆ›å»ºäº† æŒ‡å®šä»“åº“ä½ç½® # ä¸‹é¢å°†ç”Ÿæˆå¥½çš„é™æ€èµ„æºæ¨åˆ°è¿œç¨‹ä»“åº“ï¼Œå…ˆä¿®æ”¹åšå®¢é¡¹ç›®ç›®å½•ä¸‹çš„_config.yml\ndeploy: type: git repo: ç”Ÿæˆå¥½çš„é™æ€èµ„æºå­˜æ”¾çš„è¿œç¨‹ä»“åº“åœ°å€ branch: [åˆ†æ”¯åç§°] éƒ¨ç½² # å…ˆç”Ÿæˆæ–‡ä»¶åï¼Œå†å°†é™æ€èµ„æºæäº¤åˆ°è¿œç¨‹ä»“åº“\n# d æ˜¯ deploy # g æ˜¯ generate hexo g -d # æˆ–è€… hexo d -g ç­‰ä¸ªä¸€ä¼šå„¿åï¼Œåœ¨æµè§ˆå™¨æ‰“å¼€https://ç”¨æˆ·å.github.ioå°±å¯ä»¥è®¿é—®åšå®¢ç½‘ç«™äº†\n","date":"2018å¹´09æœˆ17æ—¥","externalUrl":null,"permalink":"/posts/hexo%E7%9A%84%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E4%BB%A5%E5%8F%8A%E9%83%A8%E7%BD%B2/","section":"Posts","summary":"","title":"Hexoçš„å®‰è£…é…ç½®ä»¥åŠéƒ¨ç½²","type":"posts"},{"content":"","externalUrl":null,"permalink":"/authors/","section":"Authors","summary":"","title":"Authors","type":"authors"},{"content":"","externalUrl":null,"permalink":"/series/","section":"Series","summary":"","title":"Series","type":"series"}]